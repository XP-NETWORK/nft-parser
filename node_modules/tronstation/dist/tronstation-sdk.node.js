module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=8)}([function(t,e){t.exports=require("@babel/runtime/regenerator")},function(t,e){t.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(t,e){t.exports=require("@babel/runtime/helpers/classCallCheck")},function(t,e){t.exports=require("@babel/runtime/helpers/createClass")},function(t,e){t.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(t,e){t.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(t,e){t.exports=require("@babel/runtime/helpers/inherits")},function(t,e){t.exports=require("lodash")},function(t,e,r){"use strict";r.r(e);var n=r(2),a=r.n(n),i=r(3),s=r.n(i),o=r(0),u=r.n(o),c=r(1),h=r.n(c),l=r(4),f=r.n(l),d=r(5),p=r.n(d),v=r(6),g=r.n(v),b=function(){function t(e){a()(this,t),this.tronWeb=e.tronWeb,this.utils=this.tronWeb.utils}return s()(t,[{key:"validateNumber",value:function(t,e,r){if(!t.v||"number"!=typeof t.v)throw new Error("Invalid ".concat(t.n," provided."));switch(e){case">=":if(t.v<r)throw new Error("Provided ".concat(t.n," should be ").concat(e," ").concat(r,"."))}}},{key:"validateAddress",value:function(t){if(!this.tronWeb.isAddress(t))throw new Error("Invalid address provided.")}}]),t}(),y=r(7),m=function(){function t(e){a()(this,t),this.tronWeb=e.tronWeb,this.utils=this.tronWeb.utils}return s()(t,[{key:"toTrx",value:function(t){return parseFloat(t)/1e6}},{key:"fromTrx",value:function(t){return 1e6*t}},{key:"filterData",value:function(t){return void 0===t?0:t}},{key:"hexStringToBytes",value:function(t){var e=0,r=t.length;if(r%2!=0)return null;r/=2;for(var n=[],a=0;a<r;a++){var i=t.substr(e,2),s=parseInt(i,16);n.push(s),e+=2}return n}},{key:"byteToString",value:function(t){if("string"==typeof t)return t;for(var e="",r=t,n=0;n<r.length;n++){var a=r[n].toString(2),i=a.match(/^1+?(?=0)/);if(i&&8===a.length){for(var s=i[0].length,o=r[n].toString(2).slice(7-s),u=1;u<s;u++)o+=r[u+n].toString(2).slice(2);e+=String.fromCharCode(parseInt(o,2)),n+=s-1}else e+=String.fromCharCode(r[n])}return e}},{key:"getResourceByName",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=a.length>1&&void 0!==a[1]?a[1]:this.tronWeb.defaultAddress.hex,t.t0=e,t.next="EnergyWeight"===t.t0?4:"BandwidthWeight"===t.t0?6:"BandwidthLimit"===t.t0?8:10;break;case 4:return e="TotalEnergyWeight",t.abrupt("break",11);case 6:return e="TotalNetWeight",t.abrupt("break",11);case 8:return e="TotalNetLimit",t.abrupt("break",11);case 10:throw new Error("Invalid resource type provided.");case 11:return t.next=14,this.getResourcesByName([e],r);case 14:if((n=t.sent)&&0!==Object.keys(n).length){t.next=17;break}throw new Error("Get resource failed.");case 17:return t.abrupt("return",n[e]);case 18:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getResourcesByName",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i,s=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:this.tronWeb.defaultAddress.hex,this.tronWeb.isAddress(r)){t.next=3;break}throw new Error("Invalid address provides.");case 3:return t.next=5,this.tronWeb.trx.getAccountResources(r);case 5:if(n=t.sent){t.next=8;break}throw new Error("Get resource failed.");case 8:for(a={},i=0;i<e.length;i++)a[e[i]]=n[e[i]];return t.abrupt("return",a);case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getChainParameterByName",value:function(){var t=h()(u.a.mark(function t(e){var r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChainParametersByName([e]);case 2:if(r=t.sent){t.next=5;break}throw new Error("Get chain parameter failed.");case 5:return t.abrupt("return",r[e]);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getChainParametersByName",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.tronWeb.trx.getChainParameters();case 2:for(r=t.sent,n={},a=0;a<e.length;a++)(i=y.filter(r,["key",e[a]])[0])&&(n[e[a]]=i.value);return t.abrupt("return",n);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),w=function t(e){if(a()(this,t),!(e&&e instanceof N))throw new Error("Expected instance of TronStation");this.tronStation=e,this.tronWeb=e.tronWeb,this.apis=new m(this.tronStation),this.validator=new b(this.tronStation),this.utils=this.tronWeb.utils},x=function(t){function e(t){var r;return a()(this,e),(r=f()(this,p()(e).call(this,t))).defaultTotalEnergyLimit=1e11,r}return g()(e,t),s()(e,[{key:"trx2FrozenEnergy",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},this.validator.validateNumber({n:"amount",v:e},">=",0),"sun"===r.unit&&(e=this.apis.toTrx(e)),t.next=5,this.apis.getResourceByName("EnergyWeight");case 5:return n=t.sent,t.next=8,this.apis.getChainParameterByName("getTotalEnergyLimit");case 8:return a=t.sent,t.abrupt("return",e*(a||this.defaultTotalEnergyLimit)/n);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"frozenEnergy2Trx",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i,s=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},this.validator.validateNumber({n:"energy",v:e},">=",0),t.next=4,this.apis.getResourceByName("EnergyWeight");case 4:return n=t.sent,t.next=7,this.apis.getChainParameterByName("getTotalEnergyLimit");case 7:return a=t.sent,i=e*n/(a||this.defaultTotalEnergyLimit),"sun"===r.unit&&(i=this.apis.fromTrx(i)),t.abrupt("return",i);case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"trx2BurnedEnergy",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},this.validator.validateNumber({n:"amount",v:e},">=",0),"sun"===r.unit&&(e=this.apis.toTrx(e)),t.next=5,this.apis.getChainParameterByName("getEnergyFee");case 5:return n=t.sent,t.abrupt("return",this.apis.fromTrx(e)/n);case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"burnedEnergy2Trx",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},this.validator.validateNumber({n:"energy",v:e},">=",0),t.next=4,this.apis.getChainParameterByName("getEnergyFee");case 4:return n=t.sent,a=e*this.apis.toTrx(n),"sun"===r.unit&&(a=this.apis.fromTrx(a)),t.abrupt("return",a);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getMaxEnergyLimit",value:function(){var t=h()(u.a.mark(function t(e,r){var n,a,i,s,o,c,h,l,f,d,p,v,g,b,y=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=y.length>2&&void 0!==y[2]?y[2]:{},this.validator.validateAddress(e),this.validator.validateNumber({n:"feeLimit",v:r},">=",0),"sun"===n.unit&&this.apis.toTrx(r),!(r>1e3)){t.next=6;break}throw new Error("Max fee limit has a max limit of 1000 trx.");case 6:return t.next=8,this.tronWeb.trx.getAccount(e);case 8:if((a=t.sent)&&0!==Object.keys(a).length){t.next=11;break}throw new Error("Account not exists or not activated.");case 11:return void 0===a.balance&&(a.balance=0),t.next=14,this.apis.getChainParametersByName(["getTotalEnergyLimit","getEnergyFee"]);case 14:return i=t.sent,s=this.apis.filterData(i.getTotalEnergyLimit),o=this.apis.filterData(i.getEnergyFee),t.next=19,this.apis.getResourcesByName(["EnergyLimit","EnergyUsed","TotalEnergyWeight"],e);case 19:return c=t.sent,h=this.apis.filterData(c.EnergyLimit),l=this.apis.filterData(c.EnergyUsed),f=this.apis.filterData(c.TotalEnergyWeight),d=s/f,p=a.balance/o,v=h+p-l,b=h>(g=r*d)?Math.min(v,g):v,t.abrupt("return",{accountEnergy:h,accountEnergyUsed:l,accountTrxEnergy:p,accountTotalEnergy:v,feeLimit:r,feeLimitEnergy:g,maxEnergyLimit:b});case 29:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}]),e}(w),k=function(t){function e(t){return a()(this,e),f()(this,p()(e).call(this,t))}return g()(e,t),s()(e,[{key:"trx2FrozenBandwidth",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i,s=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},this.validator.validateNumber({n:"amount",v:e},">=",0),"sun"===r.unit&&(e=this.apis.toTrx(e)),t.next=5,this.apis.getResourcesByName(["TotalNetLimit","TotalNetWeight"]);case 5:return n=t.sent,a=this.apis.filterData(n.TotalNetLimit),i=n.TotalNetWeight,t.abrupt("return",e*a/i);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"frozenBandwidth2Trx",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i,s,o=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},this.validator.validateNumber({n:"bandwidth",v:e},">=",0),t.next=4,this.apis.getResourcesByName(["TotalNetLimit","TotalNetWeight"]);case 4:return n=t.sent,a=this.apis.filterData(n.TotalNetLimit),i=n.TotalNetWeight,s=e*i/a,"sun"===r.unit&&(s=this.apis.fromTrx(s)),t.abrupt("return",s);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getAccountBandwidth",value:function(){var t=h()(u.a.mark(function t(e){var r,n,a,i,s,o,c,h,l,f=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.length>1&&void 0!==f[1]?f[1]:{},this.validator.validateAddress(e),t.next=4,this.tronWeb.trx.getAccount(e);case 4:return void 0===(r=t.sent).balance&&(r.balance=0),n=["freeNetLimit","freeNetUsed","NetLimit","NetUsed"],t.next=9,this.apis.getResourcesByName(n,e);case 9:return a=t.sent,i=this.apis.filterData(r.balance),s=this.apis.filterData(a.freeNetLimit),o=this.apis.filterData(a.freeNetUsed),c=this.apis.filterData(a.NetLimit),h=this.apis.filterData(a.NetUsed),l=s+c-o-h,t.abrupt("return",{balance:i,freebp:s,freebpUsed:o,accountbp:c,accountbpUsed:h,totalbp:l});case 17:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),e}(w),E=r(7),T=function(t){function e(t){return a()(this,e),f()(this,p()(e).call(this,t))}return g()(e,t),s()(e,[{key:"getSrVoteRewardList",value:function(){var t=h()(u.a.mark(function t(){var e,r,n,a,i,s,o=this;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.tronWeb.trx.listSuperRepresentatives();case 2:return e=t.sent,r=[],n=[],a=E.sumBy(e,function(t){return t.voteCount}),460800,921600,i="https://api.trongrid.io"===this.tronWeb.fullNode.host,s=i?27:e.length,t.next=12,Promise.all(e.map(function(){var t=h()(u.a.mark(function t(e){var n,i;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.next=3,o.tronWeb.trx.getAccount(e.address);case 3:i=t.sent,n.rank=0,void 0!==i.account_name?n.name=o.tronWeb.utils.bytes.bytesToString(o.apis.hexStringToBytes(i.account_name)):n.name=e.url,n.url=e.url,n.address=e.address,n.votes=o.apis.filterData(e.voteCount),n.percentage=n.votes/a*100,n.role="",n.voteReward=Math.ceil(n.votes/a*460800),n.blockReward=Math.ceil(921600/s),n.totalReward=n.voteReward+n.blockReward,r.push(n);case 15:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()));case 12:return(r=E.sortBy(r,function(t){return-1*t.votes})).map(function(t,e){e<27?(t.rank=e+1,t.role="sr",n.push(t)):(t.blockReward=0,t.totalReward=t.voteReward,t.rank=e+1,t.role="candidate",n.push(t))}),t.abrupt("return",{totalVotes:a,rewardList:n});case 15:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"calculateSrReward",value:function(){var t=h()(u.a.mark(function t(e,r){var n,a,i,s,o,c,h,l,f,d,p,v,g,b,y,m;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validator.validateNumber({n:"addedVotes",v:e},">=",0),r&&this.validator.validateAddress(r),n="https://api.trongrid.io"===this.tronWeb.fullNode.host,r=this.tronWeb.address.toHex(r),t.next=6,this.getSrVoteRewardList();case 6:if(a=t.sent,(i=a.rewardList)&&0!==i.length){t.next=10;break}throw new Error("Error getting reward list");case 10:return(s=E.filter(i,function(t){return t.address===r}))&&1===s.length&&(o=s[0]),c=(o?o.votes:0)+e,h=E.reverse(i),l=E.sortedIndexBy(h,{votes:c},function(t){return t.votes}),f=0===e?i.length-l:i.length-l+1,d=o?o.name:f<=27?"New SR":"New Candidate",p=a.totalVotes+e,v=100*c/p,g=Math.ceil(c/p*460800),b=n?27:i.length,y=f<=b?Math.ceil(921600/b):0,m=y+g,t.abrupt("return",{rank:f,sr:d,votes:c,totalVotes:p,percentage:v,voteReward:g,blockReward:y,totalReward:m});case 24:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}]),e}(w);r.d(e,"default",function(){return N});var N=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(a()(this,t),!e)throw new Error("Expected instance of TronWeb");if(!e.defaultAddress)throw new Error("Expected default account set up in TronWeb");this.tronWeb=e,this.energy=new x(this),this.defaultAddress=e.defaultAddress,this.bp=new k(this),this.witness=new T(this),this.apis=new m(this)}return s()(t,[{key:"setTronWeb",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t)throw new Error("Expected instance of TronWeb");if(!t.defaultAddress)throw new Error("Expected default account set up in TronWeb");this.tronWeb=t,this.defaultAddress=t.defaultAddress,this.energy=new x(this),this.defaultAddress=t.defaultAddress,this.bp=new k(this),this.witness=new T(this),this.apis=new m(this)}}]),t}()}]).default;
//# sourceMappingURL=tronstation-sdk.node.js.map