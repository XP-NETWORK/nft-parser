{"version":3,"file":"taquito.umd.js","sources":["../src/forger/rpc-forger.ts","../src/injector/rpc-injector.ts","../src/signer/noop.ts","../src/constants.ts","../src/format.ts","../src/contract/errors.ts","../src/contract/prepare.ts","../src/operations/types.ts","../src/operations/operation-errors.ts","../src/operations/operations.ts","../src/operations/batch-operation.ts","../src/operations/operation-emitter.ts","../src/batch/rpc-batch-provider.ts","../src/wallet/receipt.ts","../src/wallet/operation.ts","../src/wallet/batch-operation.ts","../src/wallet/delegation-operation.ts","../src/wallet/origination-operation.ts","../src/wallet/transaction-operation.ts","../src/wallet/operation-factory.ts","../src/tz/rpc-tz-provider.ts","../src/contract/estimate.ts","../src/contract/rpc-estimate-provider.ts","../src/operations/delegate-operation.ts","../src/operations/origination-operation.ts","../src/operations/register-global-constant-operation.ts","../src/operations/reveal-operation.ts","../src/operations/transaction-operation.ts","../src/contract/manager-lambda.ts","../src/contract/view_lambda.ts","../src/contract/compose.ts","../src/contract/contract-methods/contract-method-flat-param.ts","../src/wallet/wallet.ts","../src/wallet/legacy.ts","../src/contract/contract-methods/contract-method-object-param.ts","../src/contract/contract-methods/contract-on-chain-view.ts","../src/contract/contract-methods/contract-method-factory.ts","../src/contract/lambda-view.ts","../src/contract/contract.ts","../src/contract/big-map.ts","../src/contract/sapling-state-abstraction.ts","../src/contract/semantic.ts","../src/contract/rpc-contract-provider.ts","../src/parser/michel-codec-parser.ts","../src/packer/rpc-packer.ts","../src/global-constants/error.ts","../src/global-constants/noop-global-constants-provider.ts","../src/context.ts","../src/subscribe/filters.ts","../src/subscribe/observable-subscription.ts","../src/subscribe/polling-provider.ts","../src/version.ts","../src/forger/composite-forger.ts","../src/parser/noop-parser.ts","../src/packer/michel-codec-packer.ts","../src/global-constants/default-global-constants-provider.ts","../src/taquito.ts"],"sourcesContent":["import { Forger, ForgeParams, ForgeResponse } from './interface';\nimport { Context } from '../context';\n\nexport class RpcForger implements Forger {\n  constructor(private context: Context) {}\n\n  forge({ branch, contents }: ForgeParams): Promise<ForgeResponse> {\n    return this.context.rpc.forgeOperations({ branch, contents });\n  }\n}\n","import { Injector } from './interface';\nimport { Context } from '../context';\n\nexport class RpcInjector implements Injector {\n  constructor(private context: Context) {}\n  inject(signedOperationBytes: string): Promise<string> {\n    return this.context.rpc.injectOperation(signedOperationBytes);\n  }\n}\n","import { Signer } from './interface';\n\nexport class UnconfiguredSignerError extends Error {\n  name = 'UnconfiguredSignerError';\n\n  constructor() {\n    super(\n      'No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance.'\n    );\n  }\n}\n\n/**\n * @description Default signer implementation which does nothing and produce invalid signature\n */\nexport class NoopSigner implements Signer {\n  async publicKey(): Promise<string> {\n    throw new UnconfiguredSignerError();\n  }\n  async publicKeyHash(): Promise<string> {\n    throw new UnconfiguredSignerError();\n  }\n  async secretKey(): Promise<string> {\n    throw new UnconfiguredSignerError();\n  }\n  async sign(_bytes: string, _watermark?: Uint8Array): Promise<any> {\n    throw new UnconfiguredSignerError();\n  }\n}\n","export enum DEFAULT_GAS_LIMIT {\n  DELEGATION = 10600,\n  ORIGINATION = 10600,\n  TRANSFER = 10600,\n  REVEAL = 1100,\n}\nexport enum DEFAULT_FEE {\n  DELEGATION = 1257,\n  ORIGINATION = 10000,\n  TRANSFER = 10000,\n  REVEAL = 374,\n}\nexport enum DEFAULT_STORAGE_LIMIT {\n  DELEGATION = 0,\n  ORIGINATION = 257,\n  TRANSFER = 257,\n  REVEAL = 0,\n}\n\nexport enum Protocols {\n  Pt24m4xi = 'Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd',\n  PsBABY5H = 'PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU',\n  PsBabyM1 = 'PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS',\n  PsCARTHA = 'PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb',\n  PsDELPH1 = 'PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo',\n  PtEdo2Zk = 'PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA',\n  PsFLorena = 'PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i',\n  PtGRANADs = 'PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV',\n  PtHangz2 = 'PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx',\n  PsiThaCa = 'PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP',\n  Psithaca2 = 'Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A',\n  ProtoALpha = 'ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK', // temporary protocol hash\n}\n\nexport const protocols = {\n  '004': [Protocols.Pt24m4xi],\n  '005': [Protocols.PsBABY5H, Protocols.PsBabyM1],\n  '006': [Protocols.PsCARTHA],\n  '007': [Protocols.PsDELPH1],\n  '008': [Protocols.PtEdo2Zk], // edonet v2\n  '009': [Protocols.PsFLorena],\n  '010': [Protocols.PtGRANADs],\n  '011': [Protocols.PtHangz2], // hangzhou v2,\n  '012': [Protocols.PsiThaCa], //Ithaca\n  '013': [Protocols.Psithaca2], //Ithaca2\n  '014': [Protocols.ProtoALpha],\n};\n\nexport enum DefaultLambdaAddresses {\n  MAINNET = 'KT1CPuTzwC7h7uLXd5WQmpMFso1HxrLBUtpE',\n  CARTHAGENET = 'KT1VAy1o1FGiXYfD3YT7x7k5eF5HSHhmc1u6',\n  DELPHINET = 'KT19abMFs3haqyKYwqdLjK9GbtofryZLvpiK',\n  EDONET = 'KT1A64nVZDccAHGAsf1ZyVajXZcbiwjV3SnN',\n  FLORENCENET = 'KT1KCe3YqGnudsiCWb5twbe2DH5T3EMdLpSE',\n  GRANADANET = 'KT1BCun2vsA4GBQvsKAuGD5x873MfW2jsN9z',\n  HANGZHOUNET = 'KT1PWtBAr1hjK9M9s9oZNZFbfzPdkkD6PSJR',\n  ITHACANET = 'KT1CsEGfRHWeuUQFh9LfVFLVMbm7DFBuHPPU',\n  ITHACANET2 = 'KT1H2a5vGkMLFGBPMs6oRRJshCvYeXSBSadn',\n}\n\nexport enum ChainIds {\n  MAINNET = 'NetXdQprcVkpaWU',\n  CARTHAGENET = 'NetXjD3HPJJjmcd',\n  DELPHINET = 'NetXm8tYqnMWky1',\n  EDONET = 'NetXSgo1ZT2DRUG',\n  FLORENCENET = 'NetXxkAx4woPLyu',\n  GRANADANET = 'NetXz969SFaFn8k',\n  HANGZHOUNET = 'NetXZSsxBpMQeAT',\n  ITHACANET = 'NetXbhmtAbMukLc',\n  ITHACANET2 = 'NetXnHfVqm9iesp',\n}\n","import BigNumber from 'bignumber.js';\n\nconst TZ_DECIMALS = 6;\nconst MTZ_DECIMALS = 3;\n\ntype Format = 'tz' | 'mtz' | 'mutez';\n\nfunction getDecimal(format: Format) {\n  switch (format) {\n    case 'tz':\n      return TZ_DECIMALS;\n    case 'mtz':\n      return MTZ_DECIMALS;\n    case 'mutez':\n    default:\n      return 0;\n  }\n}\n\nexport function format(\n  from: Format = 'mutez',\n  to: Format = 'mutez',\n  amount: number | string | BigNumber\n) {\n  const bigNum = new BigNumber(amount);\n  if (bigNum.isNaN()) {\n    return amount;\n  }\n\n  return bigNum\n    .multipliedBy(Math.pow(10, getDecimal(from)))\n    .dividedBy(Math.pow(10, getDecimal(to)));\n}\n","import { HttpResponseError } from '@taquito/http-utils';\nimport { MichelsonV1Expression } from '@taquito/rpc';\n\nexport class InvalidParameterError extends Error {\n  name = 'Invalid parameters error';\n  constructor(public smartContractMethodName: string, public sigs: any[], public args: any[]) {\n    super(\n      `${smartContractMethodName} Received ${\n        args.length\n      } arguments while expecting one of the following signatures (${JSON.stringify(sigs)})`\n    );\n  }\n}\n\nexport class UndefinedLambdaContractError extends Error {\n  name = 'Undefined LambdaContract error';\n  constructor() {\n    super(\n      'This might happen if you are using a sandbox. Please provide the address of a lambda contract as a parameter of the read method.'\n    );\n  }\n}\nexport class InvalidDelegationSource extends Error {\n  name = 'Invalid delegation source error';\n\n  constructor(public source: string) {\n    super(\n      `Since Babylon delegation source can no longer be a contract address ${source}. Please use the smart contract abstraction to set your delegate.`\n    );\n  }\n}\n\nexport class InvalidCodeParameter extends Error {\n  public name = 'InvalidCodeParameter';\n  constructor(public message: string, public readonly data: any) {\n    super(message);\n  }\n}\n\nexport class InvalidInitParameter extends Error {\n  public name = 'InvalidInitParameter';\n  constructor(public message: string, public readonly data: any) {\n    super(message);\n  }\n}\n\nexport class InvalidViewParameterError extends Error {\n  name = 'Invalid view parameters error';\n  cause: any;\n  constructor(\n    public smartContractViewName: string,\n    public sigs: any,\n    public args: any,\n    public originalError: any\n  ) {\n    super(\n      `Unable to encode the parameter of the view: ${smartContractViewName}. Received ${args} as parameter while expecting one of the following signatures (${JSON.stringify(\n        sigs\n      )})`\n    );\n    this.cause = originalError;\n  }\n}\n\nexport class ViewSimulationError extends Error {\n  name = 'ViewSimulationError';\n  constructor(\n    public message: string,\n    public viewName: string,\n    public failWith?: MichelsonV1Expression,\n    public originalError?: any\n  ) {\n    super(message);\n  }\n}\n\nexport const validateAndExtractFailwith = (\n  error: HttpResponseError\n): MichelsonV1Expression | undefined => {\n  if (isJsonString(error.body)) {\n    const parsedError = JSON.parse(error.body);\n    if (Array.isArray(parsedError) && 'with' in parsedError[parsedError.length - 1]) {\n      return parsedError[parsedError.length - 1].with;\n    }\n  }\n};\n\nconst isJsonString = (str: string) => {\n  try {\n    JSON.parse(str);\n  } catch (e) {\n    return false;\n  }\n  return true;\n};\n\nexport class InvalidViewSimulationContext extends Error {\n  public name = 'InvalidViewSimulationContext';\n  constructor(public info: string) {\n    super(`${info} Please configure the context of the view execution in the executeView method.`);\n  }\n}\n","import { Schema } from '@taquito/michelson-encoder';\nimport { OpKind, MichelsonV1Expression } from '@taquito/rpc';\nimport { Prim, Expr } from '@taquito/michel-codec';\nimport {\n  OriginateParams,\n  RPCOriginationOperation,\n  TransferParams,\n  RPCTransferOperation,\n  DelegateParams,\n  RPCDelegateOperation,\n  RegisterDelegateParams,\n  RPCRevealOperation,\n  RevealParams,\n  RegisterGlobalConstantParams,\n  RPCRegisterGlobalConstantOperation,\n} from '../operations/types';\nimport { DEFAULT_FEE, DEFAULT_GAS_LIMIT, DEFAULT_STORAGE_LIMIT } from '../constants';\nimport { format } from '../format';\nimport { InvalidCodeParameter, InvalidInitParameter } from './errors';\n\nexport const createOriginationOperation = async ({\n  code,\n  init,\n  balance = '0',\n  delegate,\n  storage,\n  fee = DEFAULT_FEE.ORIGINATION,\n  gasLimit = DEFAULT_GAS_LIMIT.ORIGINATION,\n  storageLimit = DEFAULT_STORAGE_LIMIT.ORIGINATION,\n  mutez = false,\n}: OriginateParams) => {\n  if (storage !== undefined && init !== undefined) {\n    throw new Error(\n      'Storage and Init cannot be set a the same time. Please either use storage or init but not both.'\n    );\n  }\n\n  if (!Array.isArray(code)) {\n    throw new InvalidCodeParameter('Wrong code parameter type, expected an array', code);\n  }\n\n  let contractStorage: Expr | undefined;\n  if (storage !== undefined) {\n    const storageType = (code as Expr[]).find(\n      (p): p is Prim => 'prim' in p && p.prim === 'storage'\n    );\n    if (storageType?.args === undefined) {\n      throw new InvalidCodeParameter('The storage section is missing from the script', code);\n    }\n    const schema = new Schema(storageType.args[0] as MichelsonV1Expression); // TODO\n    contractStorage = schema.Encode(storage);\n  } else if (init !== undefined && typeof init === 'object') {\n    contractStorage = init as Expr;\n  } else {\n    throw new InvalidInitParameter('Wrong init parameter type, expected JSON Michelson', init);\n  }\n\n  const script = {\n    code,\n    storage: contractStorage,\n  };\n\n  const operation: RPCOriginationOperation = {\n    kind: OpKind.ORIGINATION,\n    fee,\n    gas_limit: gasLimit,\n    storage_limit: storageLimit,\n    balance: mutez ? balance.toString() : format('tz', 'mutez', balance).toString(),\n    script,\n  };\n\n  if (delegate) {\n    operation.delegate = delegate;\n  }\n  return operation;\n};\n\nexport const createTransferOperation = async ({\n  to,\n  amount,\n  parameter,\n  fee = DEFAULT_FEE.TRANSFER,\n  gasLimit = DEFAULT_GAS_LIMIT.TRANSFER,\n  storageLimit = DEFAULT_STORAGE_LIMIT.TRANSFER,\n  mutez = false,\n}: TransferParams) => {\n  const operation: RPCTransferOperation = {\n    kind: OpKind.TRANSACTION,\n    fee,\n    gas_limit: gasLimit,\n    storage_limit: storageLimit,\n    amount: mutez ? amount.toString() : format('tz', 'mutez', amount).toString(),\n    destination: to,\n    parameters: parameter,\n  };\n  return operation;\n};\n\nexport const createSetDelegateOperation = async ({\n  delegate,\n  source,\n  fee = DEFAULT_FEE.DELEGATION,\n  gasLimit = DEFAULT_GAS_LIMIT.DELEGATION,\n  storageLimit = DEFAULT_STORAGE_LIMIT.DELEGATION,\n}: DelegateParams) => {\n  const operation: RPCDelegateOperation = {\n    kind: OpKind.DELEGATION,\n    source,\n    fee,\n    gas_limit: gasLimit,\n    storage_limit: storageLimit,\n    delegate,\n  };\n  return operation;\n};\n\nexport const createRegisterDelegateOperation = async (\n  {\n    fee = DEFAULT_FEE.DELEGATION,\n    gasLimit = DEFAULT_GAS_LIMIT.DELEGATION,\n    storageLimit = DEFAULT_STORAGE_LIMIT.DELEGATION,\n  }: RegisterDelegateParams,\n  source: string\n) => {\n  return {\n    kind: OpKind.DELEGATION,\n    fee,\n    gas_limit: gasLimit,\n    storage_limit: storageLimit,\n    delegate: source,\n  } as RPCDelegateOperation;\n};\n\nexport const createRevealOperation = async (\n  {\n    fee = DEFAULT_FEE.REVEAL,\n    gasLimit = DEFAULT_GAS_LIMIT.REVEAL,\n    storageLimit = DEFAULT_STORAGE_LIMIT.REVEAL,\n  }: RevealParams,\n  source: string,\n  publicKey: string\n) => {\n  return {\n    kind: OpKind.REVEAL,\n    fee,\n    public_key: publicKey,\n    source,\n    gas_limit: gasLimit,\n    storage_limit: storageLimit,\n  } as RPCRevealOperation;\n};\n\nexport const createRegisterGlobalConstantOperation = async ({\n  value,\n  source,\n  fee,\n  gasLimit,\n  storageLimit,\n}: RegisterGlobalConstantParams) => {\n  return {\n    kind: OpKind.REGISTER_GLOBAL_CONSTANT,\n    value,\n    fee,\n    gas_limit: gasLimit,\n    storage_limit: storageLimit,\n    source,\n  } as RPCRegisterGlobalConstantOperation;\n};\n","import {\n  OperationObject,\n  InternalOperationResultKindEnum,\n  OpKind,\n  TransactionOperationParameter,\n  MichelsonV1Expression,\n} from '@taquito/rpc';\n\nexport { OpKind } from '@taquito/rpc';\n\nexport type withKind<T, K extends OpKind> = T & { kind: K };\n\nexport type ParamsWithKind =\n  | withKind<OriginateParams, OpKind.ORIGINATION>\n  | withKind<DelegateParams, OpKind.DELEGATION>\n  | withKind<TransferParams, OpKind.TRANSACTION>\n  | withKind<ActivationParams, OpKind.ACTIVATION>\n  | withKind<RegisterGlobalConstantParams, OpKind.REGISTER_GLOBAL_CONSTANT>;\n\nexport type ParamsWithKindExtended =\n  | ParamsWithKind\n  | withKind<RevealParams, OpKind.REVEAL>\n\nexport const attachKind = <T, K extends OpKind>(op: T, kind: K) => {\n  return { ...op, kind } as withKind<T, K>;\n};\n\nexport const findWithKind = <T extends { kind: OpKind }, K extends OpKind>(\n  arr: T[],\n  kind: K\n): (T & { kind: K }) | undefined => {\n  if (Array.isArray(arr)) {\n    const found = arr.find(op => op.kind === kind);\n\n    if (found && isKind(found, kind)) {\n      return found;\n    }\n  }\n};\n\nexport const isKind = <T extends { kind: OpKind }, K extends OpKind>(\n  op: T,\n  kind: K\n): op is withKind<T, K> => {\n  return op.kind === kind;\n};\n\nexport type RPCOpWithFee =\n  | RPCTransferOperation\n  | RPCOriginationOperation\n  | RPCDelegateOperation\n  | RPCRevealOperation\n  | RPCRegisterGlobalConstantOperation;\nexport type RPCOpWithSource =\n  | RPCTransferOperation\n  | RPCOriginationOperation\n  | RPCDelegateOperation\n  | RPCRevealOperation\n  | RPCRegisterGlobalConstantOperation;\n\nexport const isOpWithFee = <T extends { kind: OpKind }>(\n  op: T\n): op is withKind<T, InternalOperationResultKindEnum> => {\n  return ['transaction', 'delegation', 'origination', 'reveal', 'register_global_constant'].indexOf(op.kind) !== -1;\n};\n\nexport const isOpRequireReveal = <T extends { kind: OpKind }>(\n  op: T\n): op is withKind<T, Exclude<InternalOperationResultKindEnum, OpKind.REVEAL>> => {\n  return ['transaction', 'delegation', 'origination', 'register_global_constant'].indexOf(op.kind) !== -1;\n};\n\nexport type SourceKinds = InternalOperationResultKindEnum;\n\nexport const isSourceOp = <T extends { kind: OpKind }>(op: T): op is withKind<T, SourceKinds> => {\n  return ['transaction', 'delegation', 'origination', 'reveal', 'ballot'].indexOf(op.kind) !== -1;\n};\n\nexport const hasMetadata = <T extends { kind: OpKind }, K>(\n  op: T\n): op is T & {\n  metadata: K;\n} => {\n  return 'metadata' in op;\n};\n\nexport const hasMetadataWithResult = <T extends { kind: OpKind }, K>(\n  op: T\n): op is T & {\n  metadata: {\n    operation_result: K;\n  };\n} => {\n  return hasMetadata<T, any>(op) && 'operation_result' in op.metadata;\n};\n\nexport const hasMetadataWithInternalOperationResult = <T extends { kind: OpKind }, K>(\n  op: T\n): op is T & {\n  metadata: {\n    internal_operation_results?: K;\n  };\n} => {\n  return hasMetadata<T, any>(op) && 'internal_operation_results' in op.metadata;\n};\n\nexport interface GasConsumingOperation {\n  consumedGas?: string;\n  gasLimit: number;\n}\n\nexport interface StorageConsumingOperation {\n  storageDiff?: string;\n  storageSize?: string;\n  storageLimit: number;\n}\n\nexport interface FeeConsumingOperation {\n  fee: number;\n}\n\nexport type OriginateParamsBase = {\n  balance?: string;\n  code: string | object[];\n  delegate?: string;\n  fee?: number;\n  gasLimit?: number;\n  storageLimit?: number;\n  mutez?: boolean;\n};\n\n/**\n * @description Parameters for originate method\n */\nexport type OriginateParams<TStorage = any> = OriginateParamsBase &\n  (\n    | {\n      init?: never;\n      /** JS representation of a storage object */\n      storage: TStorage;\n    }\n    | {\n      /** Initial storage object value. Either Micheline or JSON encoded */\n      init: string | object;\n      storage?: never;\n    }\n  );\n\nexport interface ActivationParams {\n  pkh: string;\n  secret: string;\n}\n\n/**\n * @description RPC origination operation\n */\nexport interface RPCOriginationOperation {\n  kind: OpKind.ORIGINATION;\n  fee: number;\n  gas_limit: number;\n  storage_limit: number;\n  balance: string;\n  delegate?: string;\n  source?: string;\n  script: {\n    code: any;\n    storage: any;\n  };\n}\n\n/**\n * @description RPC reveal operation\n */\nexport interface RPCRevealOperation {\n  kind: OpKind.REVEAL;\n  fee: number;\n  public_key: string;\n  source?: string;\n  gas_limit: number;\n  storage_limit: number;\n}\n\nexport interface RevealParams {\n  fee?: number;\n  gasLimit?: number;\n  storageLimit?: number;\n}\n\n\n/**\n * @description Result of a forge operation contains the operation plus its encoded version\n */\nexport interface ForgedBytes {\n  opbytes: string;\n  opOb: OperationObject;\n  counter: number;\n}\n\n/**\n * @description Parameters for setDelegate method\n */\nexport interface DelegateParams {\n  source: string;\n  delegate?: string;\n  fee?: number;\n  gasLimit?: number;\n  storageLimit?: number;\n}\n\n/**\n * @description Parameters for registerDelegate method\n */\nexport interface RegisterDelegateParams {\n  fee?: number;\n  gasLimit?: number;\n  storageLimit?: number;\n}\n\n/**\n * @description RPC delegation operation\n */\nexport interface RPCDelegateOperation {\n  kind: OpKind.DELEGATION;\n  source?: string;\n  fee: number;\n  gas_limit: number;\n  storage_limit: number;\n  delegate?: string;\n}\n\n/**\n * @description Parameters for transfer method\n */\nexport interface TransferParams {\n  to: string;\n  source?: string;\n  amount: number;\n  fee?: number;\n  parameter?: TransactionOperationParameter;\n  gasLimit?: number;\n  storageLimit?: number;\n  mutez?: boolean;\n}\n\n/**\n * @description RPC register global constant operation\n */\n export interface RPCRegisterGlobalConstantOperation {\n  kind: OpKind.REGISTER_GLOBAL_CONSTANT;\n  fee: number;\n  gas_limit: number;\n  storage_limit: number;\n  source: string;\n  value: MichelsonV1Expression;\n}\n\n/**\n * @description Parameters for the `registerGlobalConstant` method\n */\nexport interface RegisterGlobalConstantParams {\n  value: MichelsonV1Expression;\n  source?: string;\n  fee?: number;\n  gasLimit?: number;\n  storageLimit?: number;\n}\n\n/**\n * @description RPC transfer operation\n */\nexport interface RPCTransferOperation {\n  kind: OpKind.TRANSACTION;\n  fee: number;\n  gas_limit: number;\n  storage_limit: number;\n  amount: string;\n  source?: string;\n  destination: string;\n  parameters?: TransactionOperationParameter;\n}\n\n/**\n * @description RPC activate account operation\n */\nexport interface RPCActivateOperation {\n  kind: OpKind.ACTIVATION;\n  pkh: string;\n  secret: string;\n}\n\nexport type RPCOperation =\n  | RPCOriginationOperation\n  | RPCTransferOperation\n  | RPCDelegateOperation\n  | RPCRevealOperation\n  | RPCActivateOperation\n  | RPCRegisterGlobalConstantOperation;\n\nexport type PrepareOperationParams = {\n  operation: RPCOperation | RPCOperation[];\n  source?: string;\n};\n","import {\n  MichelsonV1ExpressionBase,\n  OperationResultDelegation,\n  OperationResultOrigination,\n  OperationResultRegisterGlobalConstant,\n  OperationResultReveal,\n  OperationResultTransaction,\n  PreapplyResponse,\n  TezosGenericOperationError,\n} from '@taquito/rpc';\nimport {\n  hasMetadata,\n  hasMetadataWithInternalOperationResult,\n  hasMetadataWithResult,\n} from './types';\n\nexport interface TezosOperationErrorWithMessage extends TezosGenericOperationError {\n  with: MichelsonV1ExpressionBase;\n}\n\nconst isErrorWithMessage = (error: any): error is TezosOperationErrorWithMessage => {\n  return 'with' in error;\n};\n\nexport class TezosOperationError extends Error {\n  name = 'TezosOperationError';\n  id: string;\n  kind: string;\n\n  constructor(public errors: TezosGenericOperationError[]) {\n    super();\n    // Last error is 'often' the one with more detail\n    const lastError = errors[errors.length - 1];\n\n    this.id = lastError.id;\n    this.kind = lastError.kind;\n\n    this.message = `(${this.kind}) ${this.id}`;\n\n    if (isErrorWithMessage(lastError) && lastError.with.string) {\n      this.message = lastError.with.string;\n    }\n  }\n}\n\nexport class TezosPreapplyFailureError extends Error {\n  name = 'TezosPreapplyFailureError';\n\n  constructor(public result: any) {\n    super('Preapply returned an unexpected result');\n  }\n}\n\nexport type MergedOperationResult = OperationResultDelegation &\n  OperationResultOrigination &\n  OperationResultTransaction &\n  OperationResultRegisterGlobalConstant &\n  OperationResultReveal & {\n    fee?: string;\n  };\n\n// Flatten all operation content results and internal operation results into a single array\n// Some cases where we can have multiple operation results or internal operation results are:\n// - When an operation includes a reveal operation\n// - When an operation is made using the batch API\n// - Smart contract call can contains internal operation results when they call other smart contract internally or originate contracts\nexport const flattenOperationResult = (response: PreapplyResponse | PreapplyResponse[]) => {\n  const results = Array.isArray(response) ? response : [response];\n\n  const returnedResults: MergedOperationResult[] = [];\n  for (let i = 0; i < results.length; i++) {\n    for (let j = 0; j < results[i].contents.length; j++) {\n      const content = results[i].contents[j];\n      if (hasMetadataWithResult(content)) {\n        returnedResults.push({\n          fee: content.fee,\n          ...content.metadata.operation_result,\n        });\n\n        if (Array.isArray(content.metadata.internal_operation_results)) {\n          content.metadata.internal_operation_results.forEach((x) =>\n            returnedResults.push(x.result)\n          );\n        }\n      }\n    }\n  }\n\n  return returnedResults;\n};\n\n/***\n * @description Flatten all error from preapply response (including internal error)\n */\nexport const flattenErrors = (\n  response: PreapplyResponse | PreapplyResponse[],\n  status = 'failed'\n) => {\n  const results = Array.isArray(response) ? response : [response];\n\n  let errors: TezosGenericOperationError[] = [];\n  // Transaction that do not fail will be backtracked in case one failure occur\n  for (let i = 0; i < results.length; i++) {\n    for (let j = 0; j < results[i].contents.length; j++) {\n      const content = results[i].contents[j];\n      if (hasMetadata(content)) {\n        if (hasMetadataWithResult(content) && content.metadata.operation_result.status === status) {\n          errors = errors.concat(content.metadata.operation_result.errors || []);\n        }\n        if (\n          hasMetadataWithInternalOperationResult(content) &&\n          Array.isArray(content.metadata.internal_operation_results)\n        ) {\n          for (const internalResult of content.metadata.internal_operation_results) {\n            if ('result' in internalResult && internalResult.result.status === status) {\n              errors = errors.concat(internalResult.result.errors || []);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return errors;\n};\n","import {\n  BlockResponse,\n  OperationContentsAndResult,\n  OperationContentsAndResultReveal,\n} from '@taquito/rpc';\nimport { defer, EMPTY, from, of, ReplaySubject, timer } from 'rxjs';\nimport {\n  catchError,\n  filter,\n  first,\n  map,\n  mapTo,\n  shareReplay,\n  switchMap,\n  switchMapTo,\n  tap,\n} from 'rxjs/operators';\nimport { Context } from '../context';\nimport { ForgedBytes, hasMetadataWithResult } from './types';\nimport { validateOperation, ValidationResult, InvalidOperationHashError } from '@taquito/utils';\n\ninterface PollingConfig {\n  timeout: number;\n  interval: number;\n}\n\n/**\n * @description Utility class to interact with Tezos operations\n */\nexport class Operation {\n  private _pollingConfig$ = new ReplaySubject<PollingConfig>(1);\n\n  private _currentHeadPromise: Promise<BlockResponse> | undefined = undefined;\n\n  // Caching the current head for one second\n  private currentHead$ = defer(() => {\n    if (!this._currentHeadPromise) {\n      this._currentHeadPromise = this.context.rpc.getBlock();\n      timer(1000)\n        .pipe(first())\n        .subscribe(() => {\n          this._currentHeadPromise = undefined;\n        });\n    }\n    return from(this._currentHeadPromise);\n  });\n\n  // Polling observable that emit until timeout is reached\n  private polling$ = defer(() =>\n    this._pollingConfig$.pipe(\n      tap(({ timeout, interval }) => {\n        if (timeout <= 0) {\n          throw new Error('Timeout must be more than 0');\n        }\n\n        if (interval <= 0) {\n          throw new Error('Interval must be more than 0');\n        }\n      }),\n      map((config) => ({\n        ...config,\n        timeoutAt: Math.ceil(config.timeout / config.interval) + 1,\n        count: 0,\n      })),\n      switchMap((config) => timer(0, config.interval * 1000).pipe(mapTo(config))),\n      tap((config) => {\n        config.count++;\n        if (config.count > config.timeoutAt) {\n          throw new Error(`Confirmation polling timed out`);\n        }\n      })\n    )\n  );\n\n  // Observable that emit once operation is seen in a block\n  private confirmed$ = this.polling$.pipe(\n    switchMapTo(this.currentHead$),\n    map((head) => {\n      for (let i = 3; i >= 0; i--) {\n        head.operations[i].forEach((op) => {\n          if (op.hash === this.hash) {\n            this._foundAt = head.header.level;\n          }\n        });\n      }\n\n      if (head.header.level - this._foundAt >= 0) {\n        return this._foundAt;\n      }\n    }),\n    filter((x) => x !== undefined),\n    first(),\n    shareReplay()\n  );\n\n  protected _foundAt = Number.POSITIVE_INFINITY;\n  get includedInBlock() {\n    return this._foundAt;\n  }\n  /**\n   *\n   * @param hash Operation hash\n   * @param raw Raw operation that was injected\n   * @param context Taquito context allowing access to rpc and signer\n   */\n  constructor(\n    public readonly hash: string,\n    public readonly raw: ForgedBytes,\n    public readonly results: OperationContentsAndResult[],\n    protected readonly context: Context\n  ) {\n    if (validateOperation(this.hash) !== ValidationResult.VALID) {\n      throw new InvalidOperationHashError(`Invalid Operation Hash: ${this.hash}`);\n    }\n\n    this.confirmed$.pipe(first(),\n      catchError(() => {\n        return of(EMPTY)\n      })\n    ).subscribe();\n  }\n\n  get revealOperation() {\n    return (\n      Array.isArray(this.results) &&\n      (this.results.find((op) => op.kind === 'reveal') as\n        | OperationContentsAndResultReveal\n        | undefined)\n    );\n  }\n\n  public get revealStatus() {\n    if (this.revealOperation) {\n      return this.revealOperation.metadata.operation_result.status;\n    } else {\n      return 'unknown';\n    }\n  }\n\n  public get status() {\n    return (\n      this.results.map((result) => {\n        if (hasMetadataWithResult(result)) {\n          return result.metadata.operation_result.status;\n        } else {\n          return 'unknown';\n        }\n      })[0] || 'unknown'\n    );\n  }\n\n  /**\n   *\n   * @param confirmations [0] Number of confirmation to wait for\n   * @param interval [10] Polling interval\n   * @param timeout [180] Timeout\n   */\n  async confirmation(confirmations?: number, interval?: number, timeout?: number) {\n    if (typeof confirmations !== 'undefined' && confirmations < 1) {\n      throw new Error('Confirmation count must be at least 1');\n    }\n\n    const confirmationPollingIntervalSecond =\n      this.context.config.confirmationPollingIntervalSecond !== undefined\n        ? this.context.config.confirmationPollingIntervalSecond\n        : await this.context.getConfirmationPollingInterval();\n\n    const { defaultConfirmationCount, confirmationPollingTimeoutSecond } = this.context.config;\n    this._pollingConfig$.next({\n      interval: interval || confirmationPollingIntervalSecond,\n      timeout: timeout || confirmationPollingTimeoutSecond,\n    } as Required<PollingConfig>);\n\n    const conf = confirmations !== undefined ? confirmations : defaultConfirmationCount;\n\n    return new Promise<number>((resolve, reject) => {\n      this.confirmed$\n        .pipe(\n          switchMap(() => this.polling$),\n          switchMap(() => this.currentHead$),\n          filter((head) => head.header.level - this._foundAt >= conf - 1),\n          first()\n        )\n        .subscribe((_) => {\n          resolve(this._foundAt + (conf - 1));\n        }, reject);\n    });\n  }\n}\n","import { OperationContentsAndResult } from '@taquito/rpc';\nimport { BATCH_KINDS } from '../batch/rpc-batch-provider';\nimport { Context } from '../context';\nimport { flattenErrors, flattenOperationResult } from './operation-errors';\nimport { Operation } from './operations';\nimport {\n  FeeConsumingOperation,\n  ForgedBytes,\n  GasConsumingOperation,\n  RPCOperation,\n  StorageConsumingOperation,\n  hasMetadataWithResult,\n} from './types';\n\nexport class BatchOperation\n  extends Operation\n  implements GasConsumingOperation, StorageConsumingOperation, FeeConsumingOperation\n{\n  constructor(\n    hash: string,\n    private readonly params: RPCOperation[],\n    public readonly source: string,\n    raw: ForgedBytes,\n    results: OperationContentsAndResult[],\n    context: Context\n  ) {\n    super(hash, raw, results, context);\n  }\n\n  private sumProp(arr: any[], prop: string) {\n    return arr.reduce((prev, current) => {\n      return prop in current ? Number(current[prop]) + prev : prev;\n    }, 0);\n  }\n\n  public get status() {\n    return (\n      this.results\n        .filter((result) => BATCH_KINDS.indexOf(result.kind) !== -1)\n        .map((result) => {\n          if (hasMetadataWithResult(result)) {\n            return result.metadata.operation_result.status;\n          } else {\n            return 'unknown';\n          }\n        })[0] || 'unknown'\n    );\n  }\n\n  get fee() {\n    return this.sumProp(this.params, 'fee');\n  }\n\n  get gasLimit() {\n    return this.sumProp(this.params, 'gas_limit');\n  }\n\n  get storageLimit() {\n    return this.sumProp(this.params, 'storage_limit');\n  }\n\n  get consumedGas() {\n    return String(this.sumProp(flattenOperationResult({ contents: this.results }), 'consumed_gas'));\n  }\n\n  get storageDiff() {\n    return String(\n      this.sumProp(flattenOperationResult({ contents: this.results }), 'paid_storage_size_diff')\n    );\n  }\n\n  get errors() {\n    return flattenErrors({ contents: this.results });\n  }\n}\n","import {\n  BlockHeaderResponse,\n  OperationContents,\n  OperationContentsAndResult,\n  OpKind,\n  RpcClientInterface,\n  RPCRunOperationParam,\n} from '@taquito/rpc';\nimport { Protocols } from '../constants';\nimport { Context } from '../context';\nimport { Estimate } from '../contract/estimate';\nimport { flattenErrors, TezosOperationError, TezosPreapplyFailureError } from './operation-errors';\nimport {\n  ForgedBytes,\n  isOpRequireReveal,\n  ParamsWithKind,\n  PrepareOperationParams,\n  RPCOperation,\n  RPCOpWithFee,\n  RPCOpWithSource,\n} from './types';\n\nexport interface PreparedOperation {\n  opOb: {\n    branch: string;\n    contents: OperationContents[];\n    protocol: string;\n  };\n  counter: number;\n}\n\nexport abstract class OperationEmitter {\n  get rpc(): RpcClientInterface {\n    return this.context.rpc;\n  }\n\n  get signer() {\n    return this.context.signer;\n  }\n\n  constructor(protected context: Context) {}\n\n  protected async isRevealOpNeeded(op: RPCOperation[] | ParamsWithKind[], pkh: string) {\n    return !(await this.isAccountRevealRequired(pkh)) || !this.isRevealRequiredForOpType(op)\n      ? false\n      : true;\n  }\n\n  protected async isAccountRevealRequired(publicKeyHash: string) {\n    const manager = await this.rpc.getManagerKey(publicKeyHash);\n    const haveManager = manager && typeof manager === 'object' ? !!manager.key : !!manager;\n    return !haveManager;\n  }\n\n  protected isRevealRequiredForOpType(op: RPCOperation[] | ParamsWithKind[]) {\n    let opRequireReveal = false;\n    for (const operation of op) {\n      if (isOpRequireReveal(operation)) {\n        opRequireReveal = true;\n      }\n    }\n    return opRequireReveal;\n  }\n\n  // Originally from sotez (Copyright (c) 2018 Andrew Kishino)\n  protected async prepareOperation({\n    operation,\n    source,\n  }: PrepareOperationParams): Promise<PreparedOperation> {\n    const counters: { [key: string]: number } = {};\n    let ops: RPCOperation[] = [];\n\n    const blockHeaderPromise = this.rpc.getBlockHeader({ block: 'head~2' });\n    const blockMetaPromise = this.rpc.getBlockMetadata();\n\n    if (Array.isArray(operation)) {\n      ops = [...operation];\n    } else {\n      ops = [operation];\n    }\n\n    // Implicit account who emit the operation\n    const publicKeyHash = await this.signer.publicKeyHash();\n    let counterPromise: Promise<string | undefined> = Promise.resolve(undefined);\n\n    for (let i = 0; i < ops.length; i++) {\n      if (isOpRequireReveal(ops[i]) || ops[i].kind === 'reveal') {\n        const { counter } = await this.rpc.getContract(publicKeyHash);\n        counterPromise = Promise.resolve(counter);\n        break;\n      }\n    }\n\n    const [header, metadata, headCounter] = await Promise.all([\n      blockHeaderPromise,\n      blockMetaPromise,\n      counterPromise,\n    ]);\n\n    if (!header) {\n      throw new Error('Unable to fetch latest block header');\n    }\n\n    if (!metadata) {\n      throw new Error('Unable to fetch latest metadata');\n    }\n\n    const head = header;\n\n    const counter = parseInt(headCounter || '0', 10);\n    if (!counters[publicKeyHash] || counters[publicKeyHash] < counter) {\n      counters[publicKeyHash] = counter;\n    }\n\n    const getFee = (op: RPCOpWithFee) => {\n      const opCounter = ++counters[publicKeyHash];\n      return {\n        counter: `${opCounter}`,\n        fee: typeof op.fee === 'undefined' ? '0' : `${op.fee}`,\n        gas_limit: typeof op.gas_limit === 'undefined' ? '0' : `${op.gas_limit}`,\n        storage_limit: typeof op.storage_limit === 'undefined' ? '0' : `${op.storage_limit}`,\n      };\n    };\n\n    const getSource = (op: RPCOpWithSource) => {\n      return {\n        source: typeof op.source === 'undefined' ? source || publicKeyHash : op.source,\n      };\n    };\n\n    const constructOps = (cOps: RPCOperation[]): OperationContents[] =>\n      cOps.map((op: RPCOperation) => {\n        switch (op.kind) {\n          case OpKind.ACTIVATION:\n            return {\n              ...op,\n            };\n          case OpKind.REVEAL:\n            return {\n              ...op,\n              ...getSource(op),\n              ...getFee(op),\n            };\n          case OpKind.ORIGINATION:\n            return {\n              ...op,\n              balance: typeof op.balance !== 'undefined' ? `${op.balance}` : '0',\n              ...getSource(op),\n              ...getFee(op),\n            };\n          case OpKind.TRANSACTION: {\n            const cops = {\n              ...op,\n              amount: typeof op.amount !== 'undefined' ? `${op.amount}` : '0',\n              ...getSource(op),\n              ...getFee(op),\n            };\n            if (cops.source.toLowerCase().startsWith('kt1')) {\n              throw new Error(\n                `KT1 addresses are not supported as source since ${Protocols.PsBabyM1}`\n              );\n            }\n            return cops;\n          }\n          case OpKind.DELEGATION:\n            return {\n              ...op,\n              ...getSource(op),\n              ...getFee(op),\n            };\n          case OpKind.REGISTER_GLOBAL_CONSTANT:\n            return {\n              ...op,\n              ...getSource(op),\n              ...getFee(op),\n            };\n          default:\n            throw new Error('Unsupported operation');\n        }\n      });\n\n    const branch = head.hash;\n    const contents = constructOps(ops);\n    const protocol = metadata.next_protocol;\n\n    return {\n      opOb: {\n        branch,\n        contents,\n        protocol,\n      },\n      counter,\n    };\n  }\n\n  protected async forge({ opOb: { branch, contents, protocol }, counter }: PreparedOperation) {\n    const forgedBytes = await this.context.forger.forge({ branch, contents });\n\n    return {\n      opbytes: forgedBytes,\n      opOb: {\n        branch,\n        contents,\n        protocol,\n      },\n      counter,\n    };\n  }\n\n  protected async simulate(op: RPCRunOperationParam) {\n    return {\n      opResponse: await this.rpc.runOperation(op),\n      op,\n      context: this.context.clone(),\n    };\n  }\n\n  protected async estimate<T extends { fee?: number; gasLimit?: number; storageLimit?: number }>(\n    { fee, gasLimit, storageLimit, ...rest }: T,\n    estimator: (param: T) => Promise<Estimate>\n  ) {\n    let calculatedFee = fee;\n    let calculatedGas = gasLimit;\n    let calculatedStorage = storageLimit;\n\n    if (fee === undefined || gasLimit === undefined || storageLimit === undefined) {\n      const estimation = await estimator({ fee, gasLimit, storageLimit, ...(rest as any) });\n\n      if (calculatedFee === undefined) {\n        calculatedFee = estimation.suggestedFeeMutez;\n      }\n\n      if (calculatedGas === undefined) {\n        calculatedGas = estimation.gasLimit;\n      }\n\n      if (calculatedStorage === undefined) {\n        calculatedStorage = estimation.storageLimit;\n      }\n    }\n\n    return {\n      fee: calculatedFee,\n      gasLimit: calculatedGas,\n      storageLimit: calculatedStorage,\n    };\n  }\n\n  protected async signAndInject(forgedBytes: ForgedBytes) {\n    const signed = await this.signer.sign(forgedBytes.opbytes, new Uint8Array([3]));\n    forgedBytes.opbytes = signed.sbytes;\n    forgedBytes.opOb.signature = signed.prefixSig;\n\n    const opResponse: OperationContentsAndResult[] = [];\n    const results = await this.rpc.preapplyOperations([forgedBytes.opOb]);\n\n    if (!Array.isArray(results)) {\n      throw new TezosPreapplyFailureError(results);\n    }\n\n    for (let i = 0; i < results.length; i++) {\n      for (let j = 0; j < results[i].contents.length; j++) {\n        opResponse.push(results[i].contents[j]);\n      }\n    }\n\n    const errors = flattenErrors(results);\n\n    if (errors.length) {\n      throw new TezosOperationError(errors);\n    }\n\n    return {\n      hash: await this.context.injector.inject(forgedBytes.opbytes),\n      forgedBytes,\n      opResponse,\n      context: this.context.clone(),\n    };\n  }\n}\n","import { Context } from '../context';\nimport { ContractStorageType, DefaultContractType } from '../contract/contract';\nimport { ContractMethod } from '../contract/contract-methods/contract-method-flat-param';\nimport { EstimationProvider, ContractProvider } from '../contract/interface';\nimport {\n  createOriginationOperation,\n  createRegisterGlobalConstantOperation,\n  createRevealOperation,\n  createSetDelegateOperation,\n  createTransferOperation,\n} from '../contract/prepare';\nimport { BatchOperation } from '../operations/batch-operation';\nimport { OperationEmitter } from '../operations/operation-emitter';\nimport {\n  ActivationParams,\n  DelegateParams,\n  OriginateParams,\n  RPCOperation,\n  TransferParams,\n  ParamsWithKind,\n  isOpWithFee,\n  withKind,\n  RevealParams,\n  RegisterGlobalConstantParams,\n} from '../operations/types';\nimport { OpKind } from '@taquito/rpc';\nimport { ContractMethodObject } from '../contract/contract-methods/contract-method-object-param';\nimport { \n  validateAddress, \n  validateKeyHash, \n  InvalidAddressError, \n  InvalidKeyHashError, \n  ValidationResult \n} from '@taquito/utils'\n\nexport const BATCH_KINDS = [\n  OpKind.ACTIVATION,\n  OpKind.ORIGINATION,\n  OpKind.TRANSACTION,\n  OpKind.DELEGATION,\n];\nexport type BatchKinds =\n  | OpKind.ACTIVATION\n  | OpKind.ORIGINATION\n  | OpKind.TRANSACTION\n  | OpKind.DELEGATION;\n\nexport class OperationBatch extends OperationEmitter {\n  private operations: ParamsWithKind[] = [];\n\n  constructor(context: Context, private estimator: EstimationProvider) {\n    super(context);\n  }\n\n  /**\n   *\n   * @description Add a transaction operation to the batch\n   *\n   * @param params Transfer operation parameter\n   */\n  withTransfer(params: TransferParams) {\n    if (validateAddress(params.to) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid 'to' address: ${params.to}`)\n    }\n    this.operations.push({ kind: OpKind.TRANSACTION, ...params });\n    return this;\n  }\n\n  /**\n   *\n   * @description Add a transaction operation to the batch\n   *\n   * @param params Transfer operation parameter\n   */\n  withContractCall(params: ContractMethod<ContractProvider> | ContractMethodObject<ContractProvider>) {\n    return this.withTransfer(params.toTransferParams());\n  }\n\n  /**\n   *\n   * @description Add a delegation operation to the batch\n   *\n   * @param params Delegation operation parameter\n   */\n  withDelegation(params: DelegateParams) {\n    if (params.source && validateAddress(params.source) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid source address: ${params.source}`);\n    }\n    if (params.delegate && validateAddress(params.delegate) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid delegate address: ${params.delegate}`);\n    }\n    this.operations.push({ kind: OpKind.DELEGATION, ...params });\n    return this;\n  }\n\n  /**\n   *\n   * @description Add an activation operation to the batch\n   *\n   * @param params Activation operation parameter\n   */\n  withActivation({ pkh, secret }: ActivationParams) {\n    if (validateKeyHash(pkh) !== ValidationResult.VALID) {\n      throw new InvalidKeyHashError(`Invalid Key Hash: ${pkh}`);\n    }\n    this.operations.push({ kind: OpKind.ACTIVATION, pkh, secret });\n    return this;\n  }\n\n  /**\n   *\n   * @description Add an origination operation to the batch\n   *\n   * @param params Origination operation parameter\n   */\n  withOrigination<TContract extends DefaultContractType = DefaultContractType>(params: OriginateParams<ContractStorageType<TContract>>) {\n    this.operations.push({ kind: OpKind.ORIGINATION, ...params });\n    return this;\n  }\n\n  /**\n   *\n   * @description Add an operation to register a global constant to the batch\n   *\n   * @param params RegisterGlobalConstant operation parameter\n   */\n   withRegisterGlobalConstant(params: RegisterGlobalConstantParams) {\n    this.operations.push({ kind: OpKind.REGISTER_GLOBAL_CONSTANT, ...params });\n    return this;\n  }\n\n  private async getRPCOp(param: ParamsWithKind) {\n    switch (param.kind) {\n      case OpKind.TRANSACTION:\n        return createTransferOperation({\n          ...param,\n        });\n      case OpKind.ORIGINATION:\n        return createOriginationOperation(\n          await this.context.parser.prepareCodeOrigination({\n          ...param,\n        }));\n      case OpKind.DELEGATION:\n        return createSetDelegateOperation({\n          ...param,\n        });\n      case OpKind.ACTIVATION:\n        return {\n          ...param,\n        };\n      case OpKind.REGISTER_GLOBAL_CONSTANT:\n        return createRegisterGlobalConstantOperation({\n          ...param,\n        });\n      default:\n        throw new Error(`Unsupported operation kind: ${(param as any).kind}`);\n    }\n  }\n\n  /**\n   *\n   * @description Add a group operation to the batch. Operation will be applied in the order they are in the params array\n   *\n   * @param params Operations parameter\n   */\n  with(params: ParamsWithKind[]) {\n    for (const param of params) {\n      switch (param.kind) {\n        case OpKind.TRANSACTION:\n          this.withTransfer(param);\n          break;\n        case OpKind.ORIGINATION:\n          this.withOrigination(param);\n          break;\n        case OpKind.DELEGATION:\n          this.withDelegation(param);\n          break;\n        case OpKind.ACTIVATION:\n          this.withActivation(param);\n          break;\n        case OpKind.REGISTER_GLOBAL_CONSTANT:\n          this.withRegisterGlobalConstant(param);\n          break;\n        default:\n          throw new Error(`Unsupported operation kind: ${(param as any).kind}`);\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   *\n   * @description Forge and Inject the operation batch\n   *\n   * @param params Optionally specify the source of the operation\n   */\n  async send(params?: { source?: string }) {\n    const publicKeyHash = await this.signer.publicKeyHash();\n    const publicKey = await this.signer.publicKey();\n    const estimates = await this.estimator.batch(this.operations);\n\n    const revealNeeded = await this.isRevealOpNeeded(this.operations, publicKeyHash);\n    let i = revealNeeded ? 1 : 0;\n\n    const ops: RPCOperation[] = [];\n    for (const op of this.operations) {\n      if (isOpWithFee(op)) {\n        const estimated = await this.estimate(op, async () => estimates[i]);\n        ops.push(await this.getRPCOp({ ...op, ...estimated }));\n      } else {\n        ops.push({ ...op });\n      }\n      i++;\n    }\n    if (revealNeeded) {\n      const reveal: withKind<RevealParams, OpKind.REVEAL> = { kind: OpKind.REVEAL }\n      const estimatedReveal = await this.estimate(reveal, async () => estimates[0]);\n      ops.unshift(await createRevealOperation({ ...estimatedReveal }, publicKeyHash, publicKey))\n    }\n\n    const source = (params && params.source) || publicKeyHash;\n    const prepared = await this.prepareOperation({\n      operation: ops,\n      source,\n    });\n    const opBytes = await this.forge(prepared);\n    const { hash, context, forgedBytes, opResponse } = await this.signAndInject(opBytes);\n    return new BatchOperation(hash, ops, source, forgedBytes, opResponse, context);\n  }\n}\n\nexport class RPCBatchProvider {\n  constructor(private context: Context, private estimator: EstimationProvider) { }\n\n  /***\n   *\n   * @description Batch a group of operation together. Operations will be applied in the order in which they are added to the batch\n   *\n   * @param params List of operation to batch together\n   */\n  batch(params?: ParamsWithKind[]) {\n    const batch = new OperationBatch(this.context, this.estimator);\n\n    if (Array.isArray(params)) {\n      batch.with(params);\n    }\n\n    return batch;\n  }\n}\n","import { OperationContentsAndResult } from '@taquito/rpc';\nimport BigNumber from 'bignumber.js';\nimport { flattenOperationResult } from '../operations/operation-errors';\n\nexport interface Receipt {\n  totalFee: BigNumber;\n  totalGas: BigNumber;\n  totalStorage: BigNumber;\n  totalAllocationBurn: BigNumber;\n  totalOriginationBurn: BigNumber;\n  totalPaidStorageDiff: BigNumber;\n  totalStorageBurn: BigNumber;\n}\n\nexport const receiptFromOperation = (\n  op: OperationContentsAndResult[],\n  { ALLOCATION_BURN, ORIGINATION_BURN } = {\n    ALLOCATION_BURN: 257,\n    ORIGINATION_BURN: 257,\n  }\n): Receipt => {\n  const operationResults = flattenOperationResult({ contents: op });\n  let totalGas = new BigNumber(0);\n  let totalStorage = new BigNumber(0);\n  let totalFee = new BigNumber(0);\n  let totalOriginationBurn = new BigNumber(0);\n  let totalAllocationBurn = new BigNumber(0);\n  let totalPaidStorageDiff = new BigNumber(0);\n  operationResults.forEach(result => {\n    totalFee = totalFee.plus(result.fee || 0);\n    totalOriginationBurn = totalOriginationBurn.plus(\n      Array.isArray(result.originated_contracts)\n        ? result.originated_contracts.length * ORIGINATION_BURN\n        : 0\n    );\n    totalAllocationBurn = totalAllocationBurn.plus(\n      'allocated_destination_contract' in result ? ALLOCATION_BURN : 0\n    );\n    totalGas = totalGas.plus(result.consumed_gas || 0);\n    totalPaidStorageDiff = totalPaidStorageDiff.plus(\n      'paid_storage_size_diff' in result ? Number(result.paid_storage_size_diff) || 0 : 0\n    );\n  });\n\n  totalStorage = totalStorage\n    .plus(totalAllocationBurn)\n    .plus(totalOriginationBurn)\n    .plus(totalPaidStorageDiff);\n\n  return {\n    totalFee,\n    totalGas,\n    totalStorage,\n    totalAllocationBurn,\n    totalOriginationBurn,\n    totalPaidStorageDiff,\n    totalStorageBurn: new BigNumber(totalStorage.multipliedBy(1000)),\n  };\n};\n","import { BlockResponse, OperationContentsAndResult, OperationResultStatusEnum } from '@taquito/rpc';\nimport { combineLatest, from, Observable, of, ReplaySubject } from 'rxjs';\nimport {\n  catchError,\n  distinctUntilChanged,\n  filter,\n  first,\n  map,\n  shareReplay,\n  takeWhile,\n  tap,\n} from 'rxjs/operators';\nimport { Context } from '../context';\nimport { Receipt, receiptFromOperation } from './receipt';\nimport { validateOperation, ValidationResult, InvalidOperationHashError } from '@taquito/utils';\n\nexport type OperationStatus = 'pending' | 'unknown' | OperationResultStatusEnum;\n\nexport class MissedBlockDuringConfirmationError extends Error {\n  name = 'MissedBlockDuringConfirmationError';\n\n  constructor() {\n    super(\n      'Taquito missed a block while waiting for operation confirmation and was not able to find the operation'\n    );\n  }\n}\n\nconst MAX_BRANCH_ANCESTORS = 60;\n\n/**\n * @description WalletOperation allows to monitor operation inclusion on chains and surface information related to the operation\n */\nexport class WalletOperation {\n  protected _operationResult = new ReplaySubject<OperationContentsAndResult[]>(1);\n  protected _includedInBlock = new ReplaySubject<BlockResponse>(1);\n  protected _included = false;\n\n  private lastHead: BlockResponse | undefined;\n  protected newHead$: Observable<BlockResponse> = this._newHead$.pipe(\n    tap((newHead) => {\n      if (\n        !this._included &&\n        this.lastHead &&\n        newHead.header.level - this.lastHead.header.level > 1\n      ) {\n        throw new MissedBlockDuringConfirmationError();\n      }\n\n      this.lastHead = newHead;\n    }),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n\n  // Observable that emit once operation is seen in a block\n  private confirmed$ = this.newHead$.pipe(\n    map((head) => {\n      for (const opGroup of head.operations) {\n        for (const op of opGroup) {\n          if (op.hash === this.opHash) {\n            this._included = true;\n            this._includedInBlock.next(head);\n            this._operationResult.next(op.contents as OperationContentsAndResult[]);\n\n            // Return the block where the operation was found\n            return head;\n          }\n        }\n      }\n    }),\n    filter<BlockResponse | undefined, BlockResponse>((x): x is BlockResponse => {\n      return typeof x !== 'undefined';\n    }),\n    first(),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n\n  async operationResults() {\n    return this._operationResult.pipe(first()).toPromise();\n  }\n\n  /**\n   * @description Receipt expose the total amount of tezos token burn and spent on fees\n   * The promise returned by receipt will resolve only once the transaction is included\n   */\n  async receipt(): Promise<Receipt> {\n    return receiptFromOperation(await this.operationResults());\n  }\n\n  /**\n   *\n   * @param opHash Operation hash\n   * @param raw Raw operation that was injected\n   * @param context Taquito context allowing access to rpc and signer\n   */\n  constructor(\n    public readonly opHash: string,\n    protected readonly context: Context,\n    private _newHead$: Observable<BlockResponse>\n  ) {\n    if (validateOperation(this.opHash) !== ValidationResult.VALID) {\n      throw new InvalidOperationHashError(`Invalid operation hash: ${this.opHash}`);\n    }\n    this.confirmed$\n      .pipe(\n        first(),\n        catchError(() => of(undefined))\n      )\n      .subscribe();\n  }\n\n  async getCurrentConfirmation() {\n    if (!this._included) {\n      return 0;\n    }\n\n    return combineLatest([this._includedInBlock, from(this.context.rpc.getBlock())])\n      .pipe(\n        map(([foundAtBlock, head]) => {\n          return head.header.level - foundAtBlock.header.level + 1;\n        }),\n        first()\n      )\n      .toPromise();\n  }\n\n  async isInCurrentBranch(tipBlockIdentifier = 'head') {\n    // By default it is assumed that the operation is in the current branch\n    if (!this._included) {\n      return true;\n    }\n\n    const tipBlockHeader = await this.context.rpc.getBlockHeader({ block: tipBlockIdentifier });\n    const inclusionBlock = await this._includedInBlock.pipe(first()).toPromise();\n\n    const levelDiff = tipBlockHeader.level - inclusionBlock.header.level;\n\n    // Block produced before the operation is included are assumed to be part of the current branch\n    if (levelDiff <= 0) {\n      return true;\n    }\n\n    const tipBlockLevel = Math.min(\n      inclusionBlock.header.level + levelDiff,\n      inclusionBlock.header.level + MAX_BRANCH_ANCESTORS\n    );\n\n    const blocks = new Set(await this.context.rpc.getLiveBlocks({ block: String(tipBlockLevel) }));\n    return blocks.has(inclusionBlock.hash);\n  }\n\n  confirmationObservable(confirmations?: number) {\n    if (typeof confirmations !== 'undefined' && confirmations < 1) {\n      throw new Error('Confirmation count must be at least 1');\n    }\n\n    const { defaultConfirmationCount } = this.context.config;\n\n    const conf = confirmations !== undefined ? confirmations : defaultConfirmationCount;\n\n    if (conf === undefined) {\n      throw new Error('Default confirmation count can not be undefined!');\n    }\n\n    return combineLatest([this._includedInBlock, this.newHead$]).pipe(\n      distinctUntilChanged(([, previousHead], [, newHead]) => {\n        return previousHead.hash === newHead.hash;\n      }),\n      map(([foundAtBlock, head]) => {\n        return {\n          block: head,\n          expectedConfirmation: conf,\n          currentConfirmation: head.header.level - foundAtBlock.header.level + 1,\n          completed: head.header.level - foundAtBlock.header.level >= conf - 1,\n          isInCurrentBranch: () => this.isInCurrentBranch(head.hash),\n        };\n      }),\n      takeWhile(({ completed }) => !completed, true)\n    );\n  }\n\n  /**\n   *\n   * @param confirmations [0] Number of confirmation to wait for\n   */\n  confirmation(confirmations?: number) {\n    return this.confirmationObservable(confirmations).toPromise();\n  }\n}\n","import { BlockResponse, OperationContentsAndResultReveal, OpKind } from '@taquito/rpc';\nimport { Observable } from 'rxjs';\nimport { BATCH_KINDS } from '../batch/rpc-batch-provider';\nimport { Context } from '../context';\nimport { hasMetadataWithResult } from '../operations/types';\nimport { WalletOperation, OperationStatus } from './operation';\n\nexport class BatchWalletOperation extends WalletOperation {\n  constructor(\n    public readonly opHash: string,\n    protected readonly context: Context,\n    newHead$: Observable<BlockResponse>\n  ) {\n    super(opHash, context, newHead$);\n  }\n\n  public async revealOperation() {\n    const operationResult = await this.operationResults();\n    return operationResult.find(x => x.kind === OpKind.REVEAL) as\n      | OperationContentsAndResultReveal\n      | undefined;\n  }\n\n  async status(): Promise<OperationStatus> {\n    if (!this._included) {\n      return 'pending';\n    }\n\n    const op = await this.operationResults();\n\n    return (\n      op\n        .filter((result) => BATCH_KINDS.indexOf(result.kind) !== -1)\n        .map((result) => {\n          if (hasMetadataWithResult(result)) {\n            return result.metadata.operation_result.status;\n          } else {\n            return 'unknown';\n          }\n        })[0] || 'unknown'\n    );\n  }\n}\n","import { BlockResponse, OperationContentsAndResultReveal, OpKind } from '@taquito/rpc';\nimport { Observable } from 'rxjs';\nimport { Context } from '../context';\nimport { WalletOperation, OperationStatus } from './operation';\n\nexport class DelegationWalletOperation extends WalletOperation {\n  constructor(\n    public readonly opHash: string,\n    protected readonly context: Context,\n    newHead$: Observable<BlockResponse>\n  ) {\n    super(opHash, context, newHead$);\n  }\n\n  public async revealOperation() {\n    const operationResult = await this.operationResults();\n    return operationResult.find(x => x.kind === OpKind.REVEAL) as\n      | OperationContentsAndResultReveal\n      | undefined;\n  }\n\n  public async delegationOperation() {\n    const operationResult = await this.operationResults();\n    return operationResult.find(x => x.kind === OpKind.DELEGATION) as\n      | OperationContentsAndResultReveal\n      | undefined;\n  }\n\n  public async status(): Promise<OperationStatus> {\n    if (!this._included) {\n      return 'pending';\n    }\n\n    const op = await this.delegationOperation();\n    if (!op) {\n      return 'unknown';\n    }\n\n    return op.metadata.operation_result.status;\n  }\n}\n","import {\n  BlockResponse,\n  OperationContentsAndResultOrigination,\n  OperationContentsAndResultReveal,\n  OpKind,\n} from '@taquito/rpc';\nimport { Observable } from 'rxjs';\nimport { Context } from '../context';\nimport { DefaultWalletType } from '../contract/contract';\nimport { findWithKind } from '../operations/types';\nimport { WalletOperation, OperationStatus } from './operation';\n\nexport class OriginationWalletOperation<TWallet extends DefaultWalletType = DefaultWalletType> extends WalletOperation {\n  constructor(\n    public readonly opHash: string,\n    protected readonly context: Context,\n    newHead$: Observable<BlockResponse>\n  ) {\n    super(opHash, context, newHead$);\n  }\n\n  public async originationOperation() {\n    const operationResult = await this.operationResults();\n    return findWithKind(operationResult, OpKind.ORIGINATION) as\n      | OperationContentsAndResultOrigination\n      | undefined;\n  }\n\n  public async revealOperation() {\n    const operationResult = await this.operationResults();\n    return findWithKind(operationResult, OpKind.REVEAL) as\n      | OperationContentsAndResultReveal\n      | undefined;\n  }\n\n  public async status(): Promise<OperationStatus> {\n    if (!this._included) {\n      return 'pending';\n    }\n\n    const op = await this.originationOperation();\n    if (!op) {\n      return 'unknown';\n    }\n\n    return op.metadata.operation_result.status;\n  }\n\n  public async contract() {\n    const op = await this.originationOperation();\n    const address = (op?.metadata.operation_result.originated_contracts || [])[0];\n    return this.context.wallet.at<TWallet>(address);\n  }\n}\n","import { WalletOperation, OperationStatus } from './operation';\nimport { Context } from '../context';\nimport { Observable } from 'rxjs';\nimport {\n  BlockResponse,\n  OpKind,\n  OperationContentsAndResultReveal,\n  OperationContentsAndResultTransaction,\n} from '@taquito/rpc';\n\nexport class TransactionWalletOperation extends WalletOperation {\n  constructor(\n    public readonly opHash: string,\n    protected readonly context: Context,\n    newHead$: Observable<BlockResponse>\n  ) {\n    super(opHash, context, newHead$);\n  }\n\n  public async revealOperation() {\n    const operationResult = await this.operationResults();\n    return operationResult.find(x => x.kind === OpKind.REVEAL) as\n      | OperationContentsAndResultReveal\n      | undefined;\n  }\n\n  public async transactionOperation() {\n    const operationResult = await this.operationResults();\n    return operationResult.find(x => x.kind === OpKind.TRANSACTION) as\n      | OperationContentsAndResultTransaction\n      | undefined;\n  }\n\n  public async status(): Promise<OperationStatus> {\n    if (!this._included) {\n      return 'pending';\n    }\n\n    const op = await this.transactionOperation();\n    if (!op) {\n      return 'unknown';\n    }\n\n    return op.metadata.operation_result.status;\n  }\n}\n","import { BlockResponse } from '@taquito/rpc';\nimport {\n  concat,\n  defer,\n  from,\n  MonoTypeOperatorFunction,\n  Observable,\n  of,\n  range,\n  ReplaySubject,\n  SchedulerLike,\n  throwError,\n  timer,\n} from 'rxjs';\nimport {\n  concatMap,\n  distinctUntilKeyChanged,\n  first,\n  shareReplay,\n  startWith,\n  switchMap,\n  timeoutWith,\n} from 'rxjs/operators';\nimport { Context } from '../context';\nimport { BatchWalletOperation } from './batch-operation';\nimport { DelegationWalletOperation } from './delegation-operation';\nimport { WalletOperation } from './operation';\nimport { OriginationWalletOperation } from './origination-operation';\nimport { TransactionWalletOperation } from './transaction-operation';\n\nexport const cacheUntil =\n  <T>(cacheUntilObs: Observable<any>): MonoTypeOperatorFunction<T> =>\n  (source) => {\n    let subject: ReplaySubject<T> | null = null;\n\n    return defer(() => {\n      if (!subject) {\n        subject = new ReplaySubject<T>();\n        source.pipe(first()).subscribe(subject);\n        cacheUntilObs.pipe(first()).subscribe(() => {\n          subject = null;\n        });\n      }\n\n      return subject;\n    });\n  };\n\nexport const createNewPollingBasedHeadObservable = (\n  pollingTimer: Observable<number>,\n  sharedHeadOb: Observable<BlockResponse>,\n  context: Context,\n  scheduler?: SchedulerLike\n): Observable<BlockResponse> => {\n  return pollingTimer.pipe(\n    switchMap(() => sharedHeadOb),\n    distinctUntilKeyChanged('hash'),\n    timeoutWith(\n      context.config.confirmationPollingTimeoutSecond * 1000,\n      throwError(new Error('Confirmation polling timed out')),\n      scheduler\n    ),\n    shareReplay({\n      refCount: true,\n      scheduler,\n    })\n  );\n};\n\nexport interface OperationFactoryConfig {\n  blockIdentifier?: string;\n}\n\nexport class OperationFactory {\n  constructor(private context: Context) {}\n\n  // Cache the last block for one second across all operations\n  private sharedHeadObs = defer(() => from(this.context.rpc.getBlock())).pipe(\n    cacheUntil(timer(0, 1000))\n  );\n\n  private async createNewHeadObservable() {\n    const confirmationPollingIntervalSecond =\n      this.context.config.confirmationPollingIntervalSecond !== undefined\n        ? this.context.config.confirmationPollingIntervalSecond\n        : await this.context.getConfirmationPollingInterval();\n    return createNewPollingBasedHeadObservable(\n      timer(0, confirmationPollingIntervalSecond * 1000),\n      this.sharedHeadObs,\n      this.context\n    );\n  }\n\n  private createPastBlockWalker(startBlock: string, count = 1) {\n    return from(this.context.rpc.getBlock({ block: startBlock })).pipe(\n      switchMap((block) => {\n        if (count === 1) {\n          return of(block);\n        }\n\n        return range(block.header.level, count - 1).pipe(\n          startWith(block),\n          concatMap(async (level) => {\n            return this.context.rpc.getBlock({ block: String(level) });\n          })\n        );\n      })\n    );\n  }\n\n  private async createHeadObservableFromConfig({ blockIdentifier }: OperationFactoryConfig) {\n    const observableSequence: Observable<BlockResponse>[] = [];\n\n    if (blockIdentifier) {\n      observableSequence.push(this.createPastBlockWalker(blockIdentifier));\n    }\n\n    observableSequence.push(await this.createNewHeadObservable());\n\n    return concat(...observableSequence);\n  }\n\n  async createOperation(\n    hash: string,\n    config: OperationFactoryConfig = {}\n  ): Promise<WalletOperation> {\n    return new WalletOperation(\n      hash,\n      this.context.clone(),\n      await this.createHeadObservableFromConfig(config)\n    );\n  }\n\n  async createBatchOperation(\n    hash: string,\n    config: OperationFactoryConfig = {}\n  ): Promise<BatchWalletOperation> {\n    return new BatchWalletOperation(\n      hash,\n      this.context.clone(),\n      await this.createHeadObservableFromConfig(config)\n    );\n  }\n\n  async createTransactionOperation(\n    hash: string,\n    config: OperationFactoryConfig = {}\n  ): Promise<TransactionWalletOperation> {\n    return new TransactionWalletOperation(\n      hash,\n      this.context.clone(),\n      await this.createHeadObservableFromConfig(config)\n    );\n  }\n\n  async createDelegationOperation(\n    hash: string,\n    config: OperationFactoryConfig = {}\n  ): Promise<DelegationWalletOperation> {\n    return new DelegationWalletOperation(\n      hash,\n      this.context.clone(),\n      await this.createHeadObservableFromConfig(config)\n    );\n  }\n\n  async createOriginationOperation(\n    hash: string,\n    config: OperationFactoryConfig = {}\n  ): Promise<OriginationWalletOperation> {\n    return new OriginationWalletOperation(\n      hash,\n      this.context.clone(),\n      await this.createHeadObservableFromConfig(config)\n    );\n  }\n}\n","import BigNumber from 'bignumber.js';\nimport { Context } from '../context';\nimport { OperationEmitter } from '../operations/operation-emitter';\nimport { Operation } from '../operations/operations';\nimport { RPCActivateOperation } from '../operations/types';\nimport { TzProvider } from './interface';\nimport { OpKind } from '@taquito/rpc';\nimport { validateAddress, ValidationResult, validateKeyHash, InvalidAddressError, InvalidKeyHashError } from '@taquito/utils';\n\nexport class RpcTzProvider extends OperationEmitter implements TzProvider {\n  constructor(context: Context) {\n    super(context);\n  }\n\n  async getBalance(address: string): Promise<BigNumber> {\n    if (validateAddress(address) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid address: ${address}`);\n    }\n    return this.rpc.getBalance(address);\n  }\n\n  async getDelegate(address: string): Promise<string | null> {\n    if (validateAddress(address) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid address: ${address}`);\n    }\n    return this.rpc.getDelegate(address);\n  }\n\n  async activate(pkh: string, secret: string) {\n    if (validateKeyHash(pkh) !== ValidationResult.VALID) {\n      throw new InvalidKeyHashError(`Invalid Public Key Hash: ${pkh}`);\n    }\n    const operation: RPCActivateOperation = {\n      kind: OpKind.ACTIVATION,\n      pkh,\n      secret,\n    };\n\n    const prepared = await this.prepareOperation({ operation: [operation], source: pkh });\n    const forgedBytes = await this.forge(prepared);\n    const bytes = `${forgedBytes.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;\n    return new Operation(\n      await this.rpc.injectOperation(bytes),\n      { ...forgedBytes, opbytes: bytes },\n      [],\n      this.context.clone()\n    );\n  }\n}\n","const MINIMAL_FEE_MUTEZ = 100;\nconst MINIMAL_FEE_PER_BYTE_MUTEZ = 1;\nconst MINIMAL_FEE_PER_GAS_MUTEZ = 0.1;\n\nconst GAS_BUFFER = 100;\n\nexport interface EstimateProperties {\n  milligasLimit: number,\n  storageLimit: number,\n  opSize: number,\n  minimalFeePerStorageByteMutez: number,\n  baseFeeMutez?: number\n}\n\n/**\n * Examples of use :\n *\n *  Estimate a transfer operation :\n * ```\n * // Assuming that provider and signer are already configured...\n *\n * const amount = 2;\n * const address = 'tz1h3rQ8wBxFd8L9B3d7Jhaawu6Z568XU3xY';\n *\n * // Estimate gasLimit, storageLimit and fees for a transfer operation\n * const est = await Tezos.estimate.transfer({ to: address, amount: amount })\n * console.log(est.burnFeeMutez, est.gasLimit, est.minimalFeeMutez, est.storageLimit,\n *  est.suggestedFeeMutez, est.totalCost, est.usingBaseFeeMutez)\n *\n * ```\n *\n * Estimate a contract origination :\n * ```\n * // generic.json is referring to a Michelson Smart Contract\n *\n * const genericMultisigJSON = require('./generic.json')\n * const est = await Tezos.estimate.originate({\n *   code: genericMultisigJSON,\n *   storage: {\n *     stored_counter: 0,\n *     threshold: 1,\n *     keys: ['edpkuLxx9PQD8fZ45eUzrK3BhfDZJHhBuK4Zi49DcEGANwd2rpX82t']\n *   }\n * })\n * console.log(est.burnFeeMutez, est.gasLimit, est.minimalFeeMutez, est.storageLimit,\n *   est.suggestedFeeMutez, est.totalCost, est.usingBaseFeeMutez)\n *\n * ```\n */\n\nexport class Estimate {\n  constructor(\n    private readonly _milligasLimit: number | string,\n    private readonly _storageLimit: number | string,\n    public readonly opSize: number | string,\n    private readonly minimalFeePerStorageByteMutez: number | string,\n    /**\n     * @description Base fee in mutez (1 mutez = 1e10−6 tez)\n     */\n    private readonly baseFeeMutez: number | string = MINIMAL_FEE_MUTEZ\n  ) {}\n\n  /**\n   * @description The number of Mutez that will be burned for the storage of the [operation](https://tezos.gitlab.io/user/glossary.html#operations). (Storage + Allocation fees)\n   */\n  get burnFeeMutez() {\n    return this.roundUp(Number(this.storageLimit) * Number(this.minimalFeePerStorageByteMutez));\n  }\n\n  /**\n   * @description  The limit on the amount of storage an [operation](https://tezos.gitlab.io/user/glossary.html#operations) can use.\n   */\n  get storageLimit() {\n    const limit = Math.max(Number(this._storageLimit), 0);\n    return limit > 0 ? limit : 0;\n  }\n\n  /**\n   * @description The limit on the amount of [gas](https://tezos.gitlab.io/user/glossary.html#gas) a given operation can consume.\n   */\n  get gasLimit() {\n    return this.roundUp(Number(this._milligasLimit)/1000 + GAS_BUFFER);\n  }\n\n  private get operationFeeMutez() {\n    return (\n      (Number(this._milligasLimit)/1000 + GAS_BUFFER) * MINIMAL_FEE_PER_GAS_MUTEZ + Number(this.opSize) * MINIMAL_FEE_PER_BYTE_MUTEZ\n      );\n  }\n\n  private roundUp(nanotez: number) {\n    return Math.ceil(Number(nanotez));\n  }\n\n  /**\n   * @description Minimum fees for the [operation](https://tezos.gitlab.io/user/glossary.html#operations) according to [baker](https://tezos.gitlab.io/user/glossary.html#baker) defaults.\n   */\n  get minimalFeeMutez() {\n    return this.roundUp(MINIMAL_FEE_MUTEZ + this.operationFeeMutez);\n  }\n\n  /**\n   * @description The suggested fee for the operation which includes minimal fees and a small buffer.\n   */\n  get suggestedFeeMutez() {\n    return this.roundUp(this.operationFeeMutez + MINIMAL_FEE_MUTEZ * 2);\n  }\n\n  /**\n   * @description Fees according to your specified base fee will ensure that at least minimum fees are used.\n   */\n  get usingBaseFeeMutez() {\n    return (\n      Math.max(Number(this.baseFeeMutez), MINIMAL_FEE_MUTEZ) + this.roundUp(this.operationFeeMutez)\n    );\n  }\n\n  /**\n   * @description The sum of `minimalFeeMutez` + `burnFeeMutez`.\n   */\n  get totalCost() {\n    return this.minimalFeeMutez + this.burnFeeMutez;\n  }\n\n  /**\n   * @description Since Delphinet, consumed gas is provided in milligas for more precision. \n   * This function returns an estimation of the gas that operation will consume in milligas. \n   */\n  get consumedMilligas() {\n    return Number(this._milligasLimit);\n  }\n\n  static createEstimateInstanceFromProperties(estimateProperties: EstimateProperties[]) {\n    let milligasLimit = 0;\n    let storageLimit = 0;\n    let opSize = 0;\n    let minimalFeePerStorageByteMutez = 0;\n    let baseFeeMutez: number | undefined;\n\n    estimateProperties.forEach(estimate => {\n      milligasLimit += estimate.milligasLimit;\n      storageLimit += estimate.storageLimit;\n      opSize += estimate.opSize;\n      minimalFeePerStorageByteMutez = Math.max(estimate.minimalFeePerStorageByteMutez, minimalFeePerStorageByteMutez);\n      if (estimate.baseFeeMutez) {\n        baseFeeMutez = baseFeeMutez ? baseFeeMutez + estimate.baseFeeMutez : estimate.baseFeeMutez;\n      }\n    })\n    return new Estimate(milligasLimit, storageLimit, opSize, minimalFeePerStorageByteMutez, baseFeeMutez);\n  }\n\n  static createArrayEstimateInstancesFromProperties(estimateProperties: EstimateProperties[]) {\n    return estimateProperties.map(x => new Estimate(x.milligasLimit, x.storageLimit, x.opSize, x.minimalFeePerStorageByteMutez, x.baseFeeMutez))\n  }\n}\n","import { PreapplyResponse, RPCRunOperationParam, OpKind, ConstantsResponse } from '@taquito/rpc';\nimport BigNumber from 'bignumber.js';\nimport { DEFAULT_FEE, DEFAULT_GAS_LIMIT, DEFAULT_STORAGE_LIMIT } from '../constants';\nimport { OperationEmitter } from '../operations/operation-emitter';\nimport {\n  flattenErrors,\n  flattenOperationResult,\n  TezosOperationError,\n} from '../operations/operation-errors';\nimport {\n  DelegateParams,\n  isOpWithFee,\n  OriginateParams,\n  ParamsWithKind,\n  PrepareOperationParams,\n  RegisterDelegateParams,\n  RPCOperation,\n  TransferParams,\n  RevealParams,\n  RegisterGlobalConstantParams,\n} from '../operations/types';\nimport { Estimate, EstimateProperties } from './estimate';\nimport { EstimationProvider } from './interface';\nimport {\n  createOriginationOperation,\n  createRegisterDelegateOperation,\n  createRevealOperation,\n  createSetDelegateOperation,\n  createTransferOperation,\n  createRegisterGlobalConstantOperation,\n} from './prepare';\nimport { validateAddress, InvalidAddressError, ValidationResult } from '@taquito/utils';\n\ninterface Limits {\n  fee?: number;\n  storageLimit?: number;\n  gasLimit?: number;\n}\n\nconst mergeLimits = (\n  userDefinedLimit: Limits,\n  defaultLimits: Required<Limits>\n): Required<Limits> => {\n  return {\n    fee: typeof userDefinedLimit.fee === 'undefined' ? defaultLimits.fee : userDefinedLimit.fee,\n    gasLimit:\n      typeof userDefinedLimit.gasLimit === 'undefined'\n        ? defaultLimits.gasLimit\n        : userDefinedLimit.gasLimit,\n    storageLimit:\n      typeof userDefinedLimit.storageLimit === 'undefined'\n        ? defaultLimits.storageLimit\n        : userDefinedLimit.storageLimit,\n  };\n};\n\n// RPC requires a signature but does not verify it\nconst SIGNATURE_STUB =\n  'edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg';\n\nexport class RPCEstimateProvider extends OperationEmitter implements EstimationProvider {\n  private readonly ALLOCATION_STORAGE = 257;\n  private readonly ORIGINATION_STORAGE = 257;\n  private readonly OP_SIZE_REVEAL = 128;\n\n  // Maximum values defined by the protocol\n  private async getAccountLimits(pkh: string, constants: ConstantsResponse, numberOfOps?: number) {\n    const balance = await this.rpc.getBalance(pkh);\n    const {\n      hard_gas_limit_per_operation,\n      hard_gas_limit_per_block,\n      hard_storage_limit_per_operation,\n      cost_per_byte,\n    } = constants;\n    return {\n      fee: 0,\n      gasLimit: numberOfOps\n        ? Math.floor(\n            this.ajustGasForBatchOperation(\n              hard_gas_limit_per_block,\n              hard_gas_limit_per_operation,\n              numberOfOps\n            ).toNumber()\n          )\n        : hard_gas_limit_per_operation.toNumber(),\n      storageLimit: Math.floor(\n        BigNumber.min(balance.dividedBy(cost_per_byte), hard_storage_limit_per_operation).toNumber()\n      ),\n    };\n  }\n\n  // Fix for Granada where the total gasLimit of a batch can not exceed the hard_gas_limit_per_block.\n  // If the total gasLimit of the batch is higher than the hard_gas_limit_per_block,\n  // the gasLimit is calculated by dividing the hard_gas_limit_per_block by the number of operation in the batch (numberOfOps).\n  // numberOfOps is incremented by 1 for safety in case a reveal operation is needed\n  private ajustGasForBatchOperation(\n    gasLimitBlock: BigNumber,\n    gaslimitOp: BigNumber,\n    numberOfOps: number\n  ) {\n    return BigNumber.min(gaslimitOp, gasLimitBlock.div(numberOfOps + 1));\n  }\n\n  private getEstimationPropertiesFromOperationContent(\n    content: PreapplyResponse['contents'][0],\n    size: number,\n    costPerByte: BigNumber\n  ): EstimateProperties {\n    const operationResults = flattenOperationResult({ contents: [content] });\n    let totalGas = 0;\n    let totalMilligas = 0;\n    let totalStorage = 0;\n    operationResults.forEach((result) => {\n      totalStorage +=\n        'originated_contracts' in result && typeof result.originated_contracts !== 'undefined'\n          ? result.originated_contracts.length * this.ORIGINATION_STORAGE\n          : 0;\n      totalStorage += 'allocated_destination_contract' in result ? this.ALLOCATION_STORAGE : 0;\n      totalGas += Number(result.consumed_gas) || 0;\n      totalMilligas += Number(result.consumed_milligas) || 0;\n      totalStorage +=\n        'paid_storage_size_diff' in result ? Number(result.paid_storage_size_diff) || 0 : 0;\n      totalStorage +=\n        'storage_size' in result && 'global_address' in result\n          ? Number(result.storage_size) || 0\n          : 0;\n    });\n\n    if (totalGas !== 0 && totalMilligas === 0) {\n      // This will convert gas to milligas for Carthagenet where result does not contain consumed gas in milligas.\n      totalMilligas = totalGas * 1000;\n    }\n\n    if (isOpWithFee(content)) {\n      return {\n        milligasLimit: totalMilligas || 0,\n        storageLimit: Number(totalStorage || 0),\n        opSize: size,\n        minimalFeePerStorageByteMutez: costPerByte.toNumber(),\n      };\n    } else {\n      return {\n        milligasLimit: 0,\n        storageLimit: 0,\n        opSize: size,\n        minimalFeePerStorageByteMutez: costPerByte.toNumber(),\n        baseFeeMutez: 0,\n      };\n    }\n  }\n\n  private async prepareEstimate(params: PrepareOperationParams, constants: ConstantsResponse) {\n    const prepared = await this.prepareOperation(params);\n    const {\n      opbytes,\n      opOb: { branch, contents },\n    } = await this.forge(prepared);\n    const operation: RPCRunOperationParam = {\n      operation: { branch, contents, signature: SIGNATURE_STUB },\n      chain_id: await this.rpc.getChainId(),\n    };\n\n    const { opResponse } = await this.simulate(operation);\n    const { cost_per_byte } = constants;\n    const errors = [...flattenErrors(opResponse, 'backtracked'), ...flattenErrors(opResponse)];\n\n    // Fail early in case of errors\n    if (errors.length) {\n      throw new TezosOperationError(errors);\n    }\n\n    let numberOfOps = 1;\n    if (Array.isArray(params.operation) && params.operation.length > 1) {\n      numberOfOps =\n        opResponse.contents[0].kind === 'reveal'\n          ? params.operation.length - 1\n          : params.operation.length;\n    }\n\n    return opResponse.contents.map((x) => {\n      return this.getEstimationPropertiesFromOperationContent(\n        x,\n        // TODO: Calculate a specific opSize for each operation.\n        x.kind === 'reveal' ? this.OP_SIZE_REVEAL / 2 : opbytes.length / 2 / numberOfOps,\n        cost_per_byte\n      );\n    });\n  }\n\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees for an origination operation\n   *\n   * @returns An estimation of gasLimit, storageLimit and fees for the operation\n   *\n   * @param OriginationOperation Originate operation parameter\n   */\n  async originate({ fee, storageLimit, gasLimit, ...rest }: OriginateParams) {\n    const pkh = await this.signer.publicKeyHash();\n    const protocolConstants = await this.rpc.getConstants();\n    const DEFAULT_PARAMS = await this.getAccountLimits(pkh, protocolConstants);\n    const op = await createOriginationOperation(\n      await this.context.parser.prepareCodeOrigination({\n        ...rest,\n        ...mergeLimits({ fee, storageLimit, gasLimit }, DEFAULT_PARAMS),\n      })\n    );\n    const isRevealNeeded = await this.isRevealOpNeeded([op], pkh);\n    const ops = isRevealNeeded ? await this.addRevealOp([op], pkh) : op;\n    const estimateProperties = await this.prepareEstimate(\n      { operation: ops, source: pkh },\n      protocolConstants\n    );\n    if (isRevealNeeded) {\n      estimateProperties.shift();\n    }\n    return Estimate.createEstimateInstanceFromProperties(estimateProperties);\n  }\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees for an transfer operation\n   *\n   * @returns An estimation of gasLimit, storageLimit and fees for the operation\n   *\n   * @param TransferOperation Originate operation parameter\n   */\n  async transfer({ fee, storageLimit, gasLimit, ...rest }: TransferParams) {\n    if (validateAddress(rest.to) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid 'to' address: ${rest.to}`);\n    }\n    if (rest.source && validateAddress(rest.source) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid 'source' address: ${rest.source}`);\n    }\n    const pkh = await this.signer.publicKeyHash();\n    const protocolConstants = await this.rpc.getConstants();\n    const DEFAULT_PARAMS = await this.getAccountLimits(pkh, protocolConstants);\n    const op = await createTransferOperation({\n      ...rest,\n      ...mergeLimits({ fee, storageLimit, gasLimit }, DEFAULT_PARAMS),\n    });\n    const isRevealNeeded = await this.isRevealOpNeeded([op], pkh);\n    const ops = isRevealNeeded ? await this.addRevealOp([op], pkh) : op;\n    const estimateProperties = await this.prepareEstimate(\n      { operation: ops, source: pkh },\n      protocolConstants\n    );\n    if (isRevealNeeded) {\n      estimateProperties.shift();\n    }\n    return Estimate.createEstimateInstanceFromProperties(estimateProperties);\n  }\n\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees for a delegate operation\n   *\n   * @returns An estimation of gasLimit, storageLimit and fees for the operation\n   *\n   * @param Estimate\n   */\n  async setDelegate({ fee, gasLimit, storageLimit, ...rest }: DelegateParams) {\n    if (rest.source && validateAddress(rest.source) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid source address: ${rest.source}`);\n    }\n    if (rest.delegate && validateAddress(rest.delegate) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid delegate address: ${rest.delegate}`);\n    }\n\n    const pkh = await this.signer.publicKeyHash();\n    const sourceOrDefault = rest.source || pkh;\n    const protocolConstants = await this.rpc.getConstants();\n    const DEFAULT_PARAMS = await this.getAccountLimits(sourceOrDefault, protocolConstants);\n    const op = await createSetDelegateOperation({\n      ...rest,\n      ...mergeLimits({ fee, storageLimit, gasLimit }, DEFAULT_PARAMS),\n    });\n    const isRevealNeeded = await this.isRevealOpNeeded([op], pkh);\n    const ops = isRevealNeeded ? await this.addRevealOp([op], pkh) : op;\n    const estimateProperties = await this.prepareEstimate(\n      { operation: ops, source: pkh },\n      protocolConstants\n    );\n    if (isRevealNeeded) {\n      estimateProperties.shift();\n    }\n    return Estimate.createEstimateInstanceFromProperties(estimateProperties);\n  }\n\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees for a each operation in the batch\n   *\n   * @returns An array of Estimate objects. If a reveal operation is needed, the first element of the array is the Estimate for the reveal operation.\n   */\n  async batch(params: ParamsWithKind[]) {\n    const pkh = await this.signer.publicKeyHash();\n    let operations: RPCOperation[] = [];\n    const protocolConstants = await this.rpc.getConstants();\n    const DEFAULT_PARAMS = await this.getAccountLimits(pkh, protocolConstants, params.length);\n    for (const param of params) {\n      switch (param.kind) {\n        case OpKind.TRANSACTION:\n          operations.push(\n            await createTransferOperation({\n              ...param,\n              ...mergeLimits(param, DEFAULT_PARAMS),\n            })\n          );\n          break;\n        case OpKind.ORIGINATION:\n          operations.push(\n            await createOriginationOperation(\n              await this.context.parser.prepareCodeOrigination({\n                ...param,\n                ...mergeLimits(param, DEFAULT_PARAMS),\n              })\n            )\n          );\n          break;\n        case OpKind.DELEGATION:\n          operations.push(\n            await createSetDelegateOperation({\n              ...param,\n              ...mergeLimits(param, DEFAULT_PARAMS),\n            })\n          );\n          break;\n        case OpKind.ACTIVATION:\n          operations.push({\n            ...param,\n            ...DEFAULT_PARAMS,\n          });\n          break;\n        case OpKind.REGISTER_GLOBAL_CONSTANT:\n          operations.push(\n            await createRegisterGlobalConstantOperation({\n              ...param,\n              ...mergeLimits(param, DEFAULT_PARAMS),\n            })\n          );\n          break;\n        default:\n          throw new Error(`Unsupported operation kind: ${(param as any).kind}`);\n      }\n    }\n    const isRevealNeeded = await this.isRevealOpNeeded(operations, pkh);\n    operations = isRevealNeeded ? await this.addRevealOp(operations, pkh) : operations;\n    const estimateProperties = await this.prepareEstimate(\n      { operation: operations, source: pkh },\n      protocolConstants\n    );\n\n    return Estimate.createArrayEstimateInstancesFromProperties(estimateProperties);\n  }\n\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees for a delegate operation\n   *\n   * @returns An estimation of gasLimit, storageLimit and fees for the operation\n   *\n   * @param Estimate\n   */\n  async registerDelegate(params: RegisterDelegateParams) {\n    const pkh = await this.signer.publicKeyHash();\n    const protocolConstants = await this.rpc.getConstants();\n    const DEFAULT_PARAMS = await this.getAccountLimits(pkh, protocolConstants);\n    const op = await createRegisterDelegateOperation({ ...params, ...DEFAULT_PARAMS }, pkh);\n    const isRevealNeeded = await this.isRevealOpNeeded([op], pkh);\n    const ops = isRevealNeeded ? await this.addRevealOp([op], pkh) : op;\n    const estimateProperties = await this.prepareEstimate(\n      { operation: ops, source: pkh },\n      protocolConstants\n    );\n    if (isRevealNeeded) {\n      estimateProperties.shift();\n    }\n    return Estimate.createEstimateInstanceFromProperties(estimateProperties);\n  }\n\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees to reveal the current account\n   *\n   * @returns An estimation of gasLimit, storageLimit and fees for the operation or undefined if the account is already revealed\n   *\n   * @param Estimate\n   */\n  async reveal(params?: RevealParams) {\n    const pkh = await this.signer.publicKeyHash();\n    if (await this.isAccountRevealRequired(pkh)) {\n      const protocolConstants = await this.rpc.getConstants();\n      const DEFAULT_PARAMS = await this.getAccountLimits(pkh, protocolConstants);\n      const op = await createRevealOperation(\n        {\n          ...params,\n          ...DEFAULT_PARAMS,\n        },\n        pkh,\n        await this.signer.publicKey()\n      );\n      const estimateProperties = await this.prepareEstimate(\n        { operation: op, source: pkh },\n        protocolConstants\n      );\n      return Estimate.createEstimateInstanceFromProperties(estimateProperties);\n    }\n  }\n\n  /**\n   *\n   * @description Estimate gasLimit, storageLimit and fees for an registerGlobalConstant operation\n   *\n   * @returns An estimation of gasLimit, storageLimit and fees for the operation\n   *\n   * @param params registerGlobalConstant operation parameter\n   */\n  async registerGlobalConstant({\n    fee,\n    storageLimit,\n    gasLimit,\n    ...rest\n  }: RegisterGlobalConstantParams) {\n    const pkh = await this.signer.publicKeyHash();\n    const protocolConstants = await this.rpc.getConstants();\n    const DEFAULT_PARAMS = await this.getAccountLimits(pkh, protocolConstants);\n    const op = await createRegisterGlobalConstantOperation({\n      ...rest,\n      ...mergeLimits({ fee, storageLimit, gasLimit }, DEFAULT_PARAMS),\n    });\n    const isRevealNeeded = await this.isRevealOpNeeded([op], pkh);\n    const ops = isRevealNeeded ? await this.addRevealOp([op], pkh) : op;\n    const estimateProperties = await this.prepareEstimate(\n      { operation: ops, source: pkh },\n      protocolConstants\n    );\n    if (isRevealNeeded) {\n      estimateProperties.shift();\n    }\n    return Estimate.createEstimateInstanceFromProperties(estimateProperties);\n  }\n\n  private async addRevealOp(op: RPCOperation[], pkh: string) {\n    op.unshift(\n      await createRevealOperation(\n        {\n          ...{\n            fee: DEFAULT_FEE.REVEAL,\n            gasLimit: DEFAULT_GAS_LIMIT.REVEAL,\n            storageLimit: DEFAULT_STORAGE_LIMIT.REVEAL,\n          },\n        },\n        pkh,\n        await this.signer.publicKey()\n      )\n    );\n    return op;\n  }\n}\n","import { OperationContentsAndResult, OperationContentsAndResultDelegation } from '@taquito/rpc';\nimport { Context } from '../context';\nimport { Operation } from './operations';\nimport {\n  FeeConsumingOperation,\n  ForgedBytes,\n  GasConsumingOperation,\n  RPCDelegateOperation,\n  StorageConsumingOperation,\n} from './types';\n\n/**\n * @description Delegation operation provide utility function to fetch newly issued delegation\n *\n * @warn Currently support only one delegation per operation\n */\nexport class DelegateOperation extends Operation\n  implements GasConsumingOperation, StorageConsumingOperation, FeeConsumingOperation {\n  constructor(\n    hash: string,\n    private readonly params: RPCDelegateOperation,\n    public readonly source: string,\n    raw: ForgedBytes,\n    results: OperationContentsAndResult[],\n    context: Context\n  ) {\n    super(hash, raw, results, context);\n  }\n\n  get operationResults() {\n    const delegationOp =\n      Array.isArray(this.results) &&\n      (this.results.find(op => op.kind === 'delegation') as OperationContentsAndResultDelegation);\n    const result = delegationOp && delegationOp.metadata && delegationOp.metadata.operation_result;\n    return result ? result : undefined;\n  }\n\n  get status() {\n    const operationResults = this.operationResults;\n    if (operationResults) {\n      return operationResults.status;\n    } else {\n      return 'unknown';\n    }\n  }\n\n  get delegate(): string {\n    return this.delegate;\n  }\n\n  get isRegisterOperation(): boolean {\n    return this.delegate === this.source;\n  }\n\n  get fee() {\n    return this.params.fee;\n  }\n\n  get gasLimit() {\n    return this.params.gas_limit;\n  }\n\n  get storageLimit() {\n    return this.params.storage_limit;\n  }\n\n  get consumedGas() {\n    const consumedGas = this.operationResults && this.operationResults.consumed_gas;\n    return consumedGas ? consumedGas : undefined;\n  }\n\n  get errors() {\n    return this.operationResults && this.operationResults.errors;\n  }\n}\n","import { OperationContentsAndResult, OperationContentsAndResultOrigination } from '@taquito/rpc';\nimport { Context } from '../context';\nimport { DefaultContractType } from '../contract/contract';\nimport { RpcContractProvider } from '../contract/rpc-contract-provider';\nimport { Operation } from './operations';\nimport {\n  FeeConsumingOperation,\n  ForgedBytes,\n  GasConsumingOperation,\n  hasMetadataWithResult,\n  RPCOriginationOperation,\n  StorageConsumingOperation,\n} from './types';\n\n/**\n * @description Origination operation provide utility function to fetch newly originated contract\n *\n * @warn Currently support only one origination per operation\n */\nexport class OriginationOperation<TContract extends DefaultContractType = DefaultContractType> \n  extends Operation\n  implements GasConsumingOperation, StorageConsumingOperation, FeeConsumingOperation {\n  /**\n   * @description Contract address of the newly originated contract\n   */\n  public readonly contractAddress?: string;\n\n  constructor(\n    hash: string,\n    private readonly params: RPCOriginationOperation,\n    raw: ForgedBytes,\n    results: OperationContentsAndResult[],\n    context: Context,\n    private contractProvider: RpcContractProvider\n  ) {\n    super(hash, raw, results, context);\n\n    const originatedContracts = this.operationResults && this.operationResults.originated_contracts;\n    if (Array.isArray(originatedContracts)) {\n      this.contractAddress = originatedContracts[0];\n    }\n  }\n\n  get status() {\n    const operationResults = this.operationResults;\n    if (operationResults) {\n      return operationResults.status;\n    } else {\n      return 'unknown';\n    }\n  }\n\n  get operationResults() {\n    const originationOp =\n      Array.isArray(this.results) &&\n      (this.results.find((op) => op.kind === 'origination') as\n        | OperationContentsAndResultOrigination\n        | undefined);\n\n    const result =\n      originationOp &&\n      hasMetadataWithResult(originationOp) &&\n      originationOp.metadata.operation_result;\n    return result ? result : undefined;\n  }\n\n  get fee() {\n    return this.params.fee;\n  }\n\n  get gasLimit() {\n    return this.params.gas_limit;\n  }\n\n  get storageLimit() {\n    return this.params.storage_limit;\n  }\n\n  get consumedGas() {\n    const consumedGas = this.operationResults && this.operationResults.consumed_gas;\n    return consumedGas ? consumedGas : undefined;\n  }\n\n  get storageDiff() {\n    const storageDiff = this.operationResults && this.operationResults.paid_storage_size_diff;\n    return storageDiff ? storageDiff : undefined;\n  }\n\n  get storageSize() {\n    const storageSize = this.operationResults && this.operationResults.storage_size;\n    return storageSize ? storageSize : undefined;\n  }\n\n  get errors() {\n    return this.operationResults && this.operationResults.errors;\n  }\n\n  /**\n   * @description Provide the contract abstract of the newly originated contract\n   */\n  async contract(confirmations?: number, interval?: number, timeout?: number) {\n    if (!this.contractAddress) {\n      throw new Error('No contract was originated in this operation');\n    }\n\n    await this.confirmation(confirmations, interval, timeout);\n    return this.contractProvider.at<TContract>(this.contractAddress);\n  }\n}\n","import { OperationContentsAndResult, OperationContentsAndResultRegisterGlobalConstant } from '@taquito/rpc';\nimport { Context } from '../context';\nimport { Operation } from './operations';\nimport {\n    FeeConsumingOperation,\n    ForgedBytes,\n    GasConsumingOperation,\n    RPCRegisterGlobalConstantOperation,\n    StorageConsumingOperation,\n} from './types';\n\n/**\n * @description RegisterGlobalConstantOperation provides utility functions to fetch a newly issued operation of kind register_global_constant\n */\nexport class RegisterGlobalConstantOperation extends Operation\n    implements GasConsumingOperation, StorageConsumingOperation, FeeConsumingOperation {\n\n    /**\n     * @description Hash (index) of the newly registered constant\n     */\n    public readonly globalConstantHash?: string;\n    constructor(\n        hash: string,\n        private readonly params: RPCRegisterGlobalConstantOperation,\n        public readonly source: string,\n        raw: ForgedBytes,\n        results: OperationContentsAndResult[],\n        context: Context\n    ) {\n        super(hash, raw, results, context);\n\n        this.globalConstantHash = this.operationResults && this.operationResults.global_address;\n    }\n\n    get operationResults() {\n        const registerGlobalConstantOp =\n            Array.isArray(this.results) &&\n            (this.results.find(op => op.kind === 'register_global_constant') as OperationContentsAndResultRegisterGlobalConstant);\n        const result = registerGlobalConstantOp && registerGlobalConstantOp.metadata && registerGlobalConstantOp.metadata.operation_result;\n        return result ? result : undefined;\n    }\n\n    get status() {\n        const operationResults = this.operationResults;\n        if (operationResults) {\n            return operationResults.status;\n        } else {\n            return 'unknown';\n        }\n    }\n\n    get registeredExpression() {\n        return this.params.value;\n    }\n\n    get fee() {\n        return this.params.fee;\n    }\n\n    get gasLimit() {\n        return this.params.gas_limit;\n    }\n\n    get storageLimit() {\n        return this.params.storage_limit;\n    }\n\n    get errors() {\n        return this.operationResults && this.operationResults.errors;\n    }\n}\n","import { OperationContentsAndResult, OperationContentsAndResultReveal } from '@taquito/rpc';\nimport { Context } from '../context';\nimport { flattenErrors, flattenOperationResult } from './operation-errors';\nimport { Operation } from './operations';\nimport {\n  FeeConsumingOperation,\n  ForgedBytes,\n  GasConsumingOperation,\n  RPCRevealOperation,\n  StorageConsumingOperation,\n} from './types';\n\n/**\n * @description Reveal operation provides utility functions to fetch a newly issued revelation\n */\nexport class RevealOperation extends Operation\n  implements GasConsumingOperation, StorageConsumingOperation, FeeConsumingOperation {\n  constructor(\n    hash: string,\n    private readonly params: RPCRevealOperation,\n    public readonly source: string,\n    raw: ForgedBytes,\n    results: OperationContentsAndResult[],\n    context: Context\n  ) {\n    super(hash, raw, results, context);\n  }\n\n  get operationResults() {\n    const revealOp =\n      Array.isArray(this.results) &&\n      (this.results.find(op => op.kind === 'reveal') as OperationContentsAndResultReveal);\n    return revealOp ? [revealOp] : [];\n  }\n\n  get status() {\n    const operationResults = this.operationResults;\n    const txResult = operationResults[0];\n    if (txResult) {\n      return txResult.metadata.operation_result.status;\n    } else {\n      return 'unknown';\n    }\n  }\n\n  get fee() {\n    return this.params.fee;\n  }\n\n  get gasLimit() {\n    return this.params.gas_limit;\n  }\n\n  get storageLimit() {\n    return this.params.storage_limit;\n  }\n\n  get publicKey() {\n    return this.params.public_key;\n  }\n\n  private sumProp(arr: any[], prop: string) {\n    return arr.reduce((prev, current) => {\n      return prop in current ? Number(current[prop]) + prev : prev;\n    }, 0);\n  }\n\n  get consumedGas() {\n    return String(\n      this.sumProp(flattenOperationResult({ contents: this.operationResults }), 'consumed_gas')\n    );\n  }\n\n  get storageDiff() {\n    return String(\n      this.sumProp(\n        flattenOperationResult({ contents: this.operationResults }),\n        'paid_storage_size_diff'\n      )\n    );\n  }\n\n  get storageSize() {\n    return String(\n      this.sumProp(flattenOperationResult({ contents: this.operationResults }), 'storage_size')\n    );\n  }\n\n  get errors() {\n    return flattenErrors({ contents: this.operationResults });\n  }\n}\n","import { OperationContentsAndResult, OperationContentsAndResultTransaction } from '@taquito/rpc';\nimport BigNumber from 'bignumber.js';\nimport { Context } from '../context';\nimport { flattenErrors, flattenOperationResult } from './operation-errors';\nimport { Operation } from './operations';\nimport {\n  FeeConsumingOperation,\n  ForgedBytes,\n  GasConsumingOperation,\n  RPCTransferOperation,\n  StorageConsumingOperation,\n} from './types';\n\n/**\n * @description Transaction operation provides utility functions to fetch a newly issued transaction\n *\n * @warn Currently supports one transaction per operation\n */\nexport class TransactionOperation extends Operation\n  implements GasConsumingOperation, StorageConsumingOperation, FeeConsumingOperation {\n  constructor(\n    hash: string,\n    private readonly params: RPCTransferOperation,\n    public readonly source: string,\n    raw: ForgedBytes,\n    results: OperationContentsAndResult[],\n    context: Context\n  ) {\n    super(hash, raw, results, context);\n  }\n\n  get operationResults() {\n    const transactionOp =\n      Array.isArray(this.results) &&\n      (this.results.find(op => op.kind === 'transaction') as OperationContentsAndResultTransaction);\n    return transactionOp ? [transactionOp] : [];\n  }\n\n  get status() {\n    const operationResults = this.operationResults;\n    const txResult = operationResults[0];\n    if (txResult) {\n      return txResult.metadata.operation_result.status;\n    } else {\n      return 'unknown';\n    }\n  }\n\n  get amount() {\n    return new BigNumber(this.params.amount);\n  }\n\n  get destination() {\n    return this.params.destination;\n  }\n\n  get fee() {\n    return this.params.fee;\n  }\n\n  get gasLimit() {\n    return this.params.gas_limit;\n  }\n\n  get storageLimit() {\n    return this.params.storage_limit;\n  }\n\n  private sumProp(arr: any[], prop: string) {\n    return arr.reduce((prev, current) => {\n      return prop in current ? Number(current[prop]) + prev : prev;\n    }, 0);\n  }\n\n  get consumedGas() {\n    return String(\n      this.sumProp(flattenOperationResult({ contents: this.operationResults }), 'consumed_gas')\n    );\n  }\n\n  get storageDiff() {\n    return String(\n      this.sumProp(\n        flattenOperationResult({ contents: this.operationResults }),\n        'paid_storage_size_diff'\n      )\n    );\n  }\n\n  get storageSize() {\n    return String(\n      this.sumProp(flattenOperationResult({ contents: this.operationResults }), 'storage_size')\n    );\n  }\n\n  get errors() {\n    return flattenErrors({ contents: this.operationResults });\n  }\n}\n","const setDelegate = (key: string) => {\n  return [\n    { prim: 'DROP' },\n    { prim: 'NIL', args: [{ prim: 'operation' }] },\n    {\n      prim: 'PUSH',\n      args: [{ prim: 'key_hash' }, { string: key }],\n    },\n    { prim: 'SOME' },\n    { prim: 'SET_DELEGATE' },\n    { prim: 'CONS' },\n  ];\n};\n\nconst transferImplicit = (key: string, mutez: number) => {\n  return [\n    { prim: 'DROP' },\n    { prim: 'NIL', args: [{ prim: 'operation' }] },\n    {\n      prim: 'PUSH',\n      args: [{ prim: 'key_hash' }, { string: key }],\n    },\n    { prim: 'IMPLICIT_ACCOUNT' },\n    {\n      prim: 'PUSH',\n      args: [{ prim: 'mutez' }, { int: `${mutez}` }],\n    },\n    { prim: 'UNIT' },\n    { prim: 'TRANSFER_TOKENS' },\n    { prim: 'CONS' },\n  ];\n};\n\nconst removeDelegate = () => {\n  return [\n    { prim: 'DROP' },\n    { prim: 'NIL', args: [{ prim: 'operation' }] },\n    { prim: 'NONE', args: [{ prim: 'key_hash' }] },\n    { prim: 'SET_DELEGATE' },\n    { prim: 'CONS' },\n  ];\n};\n\nconst transferToContract = (key: string, amount: number) => {\n  return [\n    { prim: 'DROP' },\n    { prim: 'NIL', args: [{ prim: 'operation' }] },\n    {\n      prim: 'PUSH',\n      args: [{ prim: 'address' }, { string: key }],\n    },\n    { prim: 'CONTRACT', args: [{ prim: 'unit' }] },\n    [\n      {\n        prim: 'IF_NONE',\n        args: [[[{ prim: 'UNIT' }, { prim: 'FAILWITH' }]], []],\n      },\n    ],\n    {\n      prim: 'PUSH',\n      args: [{ prim: 'mutez' }, { int: `${amount}` }],\n    },\n    { prim: 'UNIT' },\n    { prim: 'TRANSFER_TOKENS' },\n    { prim: 'CONS' },\n  ];\n};\n\nexport const MANAGER_LAMBDA = {\n  setDelegate,\n  removeDelegate,\n  transferImplicit,\n  transferToContract,\n};\n","const code = [\n  {\n    prim: 'parameter',\n    args: [\n      {\n        prim: 'lambda',\n        args: [\n          { prim: 'unit' },\n          {\n            prim: 'pair',\n            args: [{ prim: 'list', args: [{ prim: 'operation' }] }, { prim: 'unit' }],\n          },\n        ],\n      },\n    ],\n  },\n  { prim: 'storage', args: [{ prim: 'unit' }] },\n  { prim: 'code', args: [[{ prim: 'CAR' }, { prim: 'UNIT' }, { prim: 'EXEC' }]] },\n];\n\nconst storage = 'Unit';\n\nexport const VIEW_LAMBDA = {\n  code,\n  storage\n}\n","import { Wallet } from '../wallet/wallet';\nimport { Context } from '../context';\nimport { ContractAbstraction } from './contract';\nimport { ContractProvider } from './interface';\n\nexport function compose<\n    ContractAbsComposer1 extends ContractAbstraction<ContractProvider | Wallet>,\n    ContractAbsComposer2 extends ContractAbstraction<ContractProvider | Wallet>,\n    ContractAbstractionComposed\n>(\n    functioncomposer1: (abs: ContractAbsComposer1, context: Context) => ContractAbsComposer2,\n    functioncomposer2: (abs: ContractAbsComposer2, context: Context) => ContractAbstractionComposed\n): (abs: ContractAbsComposer1, context: Context) => ContractAbstractionComposed {\n    return (contractAbstraction, context) =>\n        functioncomposer2(functioncomposer1(contractAbstraction, context), context);\n}\n","import { TransactionOperation } from '../../operations/transaction-operation';\nimport { TransferParams } from '../../operations/types';\nimport { ContractProvider } from '../interface';\nimport { TransactionWalletOperation, Wallet } from '../../wallet';\nimport { ParameterSchema } from '@taquito/michelson-encoder';\nimport {\n  ContractMethodInterface,\n  ExplicitTransferParams,\n  SendParams,\n} from './contract-method-interface';\nimport { DEFAULT_SMART_CONTRACT_METHOD_NAME } from '../contract';\nimport { InvalidParameterError } from '../errors';\n\n/**\n * @description Utility class to send smart contract operation\n * The format for the arguments is the flattened representation\n */\nexport class ContractMethod<T extends ContractProvider | Wallet>\n  implements ContractMethodInterface\n{\n  constructor(\n    private provider: T,\n    private address: string,\n    private parameterSchema: ParameterSchema,\n    private name: string,\n    private args: any[],\n    private isMultipleEntrypoint = true,\n    private isAnonymous = false\n  ) {}\n\n  private validateArgs(args: any[], schema: ParameterSchema, name: string) {\n    const sigs = schema.ExtractSignatures();\n\n    if (!sigs.find((x: any[]) => x.length === args.length)) {\n      throw new InvalidParameterError(name, sigs, args);\n    }\n  }\n\n  /**\n   * @description Get the schema of the smart contract method\n   */\n  get schema() {\n    return this.isAnonymous\n      ? this.parameterSchema.ExtractSchema()[this.name]\n      : this.parameterSchema.ExtractSchema();\n  }\n\n  /**\n   * @description Get the signature of the smart contract method\n   */\n  getSignature() {\n    if (this.isAnonymous) {\n      const sig = this.parameterSchema.ExtractSignatures().find((x: any[]) => x[0] === this.name);\n      if (sig) {\n        sig.shift();\n        return sig;\n      }\n    } else {\n      const sig = this.parameterSchema.ExtractSignatures();\n      return sig.length == 1 ? sig[0] : sig;\n    }\n  }\n\n  /**\n   *\n   * @description Send the smart contract operation\n   *\n   * @param Options generic operation parameter\n   */\n  send(\n    params: Partial<SendParams> = {}\n  ): Promise<T extends Wallet ? TransactionWalletOperation : TransactionOperation> {\n    if (this.provider instanceof Wallet) {\n      return (this.provider as unknown as Wallet)\n        .transfer(this.toTransferParams(params))\n        .send() as any;\n    } else {\n      return this.provider.transfer(this.toTransferParams(params)) as any;\n    }\n  }\n\n  /**\n   *\n   * @description Create transfer params to be used with TezosToolkit.contract.transfer methods\n   *\n   * @param Options generic transfer operation parameters\n   */\n  toTransferParams({\n    fee,\n    gasLimit,\n    storageLimit,\n    source,\n    amount = 0,\n    mutez = false,\n  }: Partial<SendParams> = {}): TransferParams {\n    const fullTransferParams: ExplicitTransferParams = {\n      to: this.address,\n      amount,\n      fee,\n      mutez,\n      source,\n      gasLimit,\n      storageLimit,\n      parameter: {\n        entrypoint: this.isMultipleEntrypoint ? this.name : DEFAULT_SMART_CONTRACT_METHOD_NAME,\n        value: this.isAnonymous\n          ? this.parameterSchema.Encode(this.name, ...this.args)\n          : this.parameterSchema.Encode(...this.args),\n      },\n    };\n    return fullTransferParams;\n  }\n}\n","import { Protocols } from '../constants';\nimport { Context } from '../context';\nimport { ContractAbstraction, ContractStorageType, DefaultWalletType } from '../contract';\nimport { ContractMethod } from '../contract/contract-methods/contract-method-flat-param';\nimport { ContractMethodObject } from '../contract/contract-methods/contract-method-object-param';\nimport { OpKind, withKind } from '../operations/types';\nimport { OriginationWalletOperation } from './origination-operation';\nimport {\n  WalletDelegateParams,\n  WalletOriginateParams,\n  WalletProvider,\n  WalletTransferParams,\n} from './interface';\n\nimport { \n  validateAddress,\n  validateContractAddress,\n  InvalidContractAddressError,\n  InvalidAddressError, \n  ValidationResult \n} from '@taquito/utils'\n\nexport interface PKHOption {\n  forceRefetch?: boolean;\n}\n\nexport type WalletParamsWithKind =\n  | withKind<WalletTransferParams, OpKind.TRANSACTION>\n  | withKind<WalletOriginateParams, OpKind.ORIGINATION>\n  | withKind<WalletDelegateParams, OpKind.DELEGATION>;\n\nexport class WalletOperationBatch {\n  private operations: WalletParamsWithKind[] = [];\n\n  constructor(private walletProvider: WalletProvider, private context: Context) {}\n\n  /**\n   *\n   * @description Add a transaction operation to the batch\n   *\n   * @param params Transfer operation parameter\n   */\n  withTransfer(params: WalletTransferParams) {\n    if (validateAddress(params.to) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid 'to' address: ${params.to}`)\n    }\n    this.operations.push({ kind: OpKind.TRANSACTION, ...params });\n    return this;\n  }\n\n  /**\n   *\n   * @description Add a transaction operation to the batch\n   *\n   * @param params Transfer operation parameter\n   */\n  withContractCall(params: ContractMethod<Wallet> | ContractMethodObject<Wallet>) {\n    return this.withTransfer(params.toTransferParams());\n  }\n\n  /**\n   *\n   * @description Add a delegation operation to the batch\n   *\n   * @param params Delegation operation parameter\n   */\n  withDelegation(params: WalletDelegateParams) {\n    if (params.delegate && validateAddress(params.delegate) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid delegate address: ${params.delegate}`);\n    }\n    this.operations.push({ kind: OpKind.DELEGATION, ...params });\n    return this;\n  }\n\n  /**\n   *\n   * @description Add an origination operation to the batch\n   *\n   * @param params Origination operation parameter\n   */\n  withOrigination<TWallet extends DefaultWalletType = DefaultWalletType>(params: WalletOriginateParams<ContractStorageType<TWallet>>) {\n    this.operations.push({ kind: OpKind.ORIGINATION, ...params });\n    return this;\n  }\n\n  private async mapOperation(param: WalletParamsWithKind) {\n    switch (param.kind) {\n      case OpKind.TRANSACTION:\n        return this.walletProvider.mapTransferParamsToWalletParams(async () => param);\n      case OpKind.ORIGINATION:\n        return this.walletProvider.mapOriginateParamsToWalletParams(async () =>\n          this.context.parser.prepareCodeOrigination({\n            ...param,\n          })\n        );\n      case OpKind.DELEGATION:\n        return this.walletProvider.mapDelegateParamsToWalletParams(async () => param);\n      default:\n        throw new Error(`Unsupported operation kind: ${(param as any).kind}`);\n    }\n  }\n\n  /**\n   *\n   * @description Add a group operation to the batch. Operation will be applied in the order they are in the params array\n   *\n   * @param params Operations parameter\n   */\n  with(params: WalletParamsWithKind[]) {\n    for (const param of params) {\n      switch (param.kind) {\n        case OpKind.TRANSACTION:\n          this.withTransfer(param);\n          break;\n        case OpKind.ORIGINATION:\n          this.withOrigination(param);\n          break;\n        case OpKind.DELEGATION:\n          this.withDelegation(param);\n          break;\n        default:\n          throw new Error(`Unsupported operation kind: ${(param as any).kind}`);\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   *\n   * @description Submit batch operation to wallet\n   *\n   */\n  async send() {\n    const ops: WalletParamsWithKind[] = [];\n\n    for (const op of this.operations) {\n      ops.push(await this.mapOperation(op));\n    }\n\n    const opHash = await this.walletProvider.sendOperations(ops);\n\n    return this.context.operationFactory.createBatchOperation(opHash);\n  }\n}\n\nexport class Wallet {\n  constructor(private context: Context) {}\n\n  private get walletProvider() {\n    return this.context.walletProvider;\n  }\n\n  private _pkh?: string;\n\n  /**\n   * @description Retrieve the PKH of the account that is currently in use by the wallet\n   *\n   * @param option Option to use while fetching the PKH.\n   * If forceRefetch is specified the wallet provider implementation will refetch the PKH from the wallet\n   */\n  async pkh({ forceRefetch }: PKHOption = {}) {\n    if (!this._pkh || forceRefetch) {\n      this._pkh = await this.walletProvider.getPKH();\n    }\n\n    return this._pkh;\n  }\n\n  private walletCommand = <T>(send: () => Promise<T>) => {\n    return {\n      send,\n    };\n  };\n\n  /**\n   *\n   * @description Originate a new contract according to the script in parameters.\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param originateParams Originate operation parameter\n   */\n  originate<TWallet extends DefaultWalletType = DefaultWalletType>(\n    params: WalletOriginateParams<ContractStorageType<TWallet>>\n  ): { send: () => Promise<OriginationWalletOperation<TWallet>> } {\n    return this.walletCommand(async () => {\n      const mappedParams = await this.walletProvider.mapOriginateParamsToWalletParams(() =>\n        this.context.parser.prepareCodeOrigination({\n          ...params as WalletOriginateParams,\n        })\n      );\n      const opHash = await this.walletProvider.sendOperations([mappedParams]);\n      if (!this.context.proto) {\n        this.context.proto = (await this.context.rpc.getBlock()).protocol as Protocols;\n      }\n      return this.context.operationFactory.createOriginationOperation(opHash) as Promise<OriginationWalletOperation<TWallet>>;\n    });\n  }\n\n  /**\n   *\n   * @description Set the delegate for a contract.\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param delegateParams operation parameter\n   */\n  setDelegate(params: WalletDelegateParams) {\n    if (params.delegate && validateAddress(params.delegate) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid address error: ${params.delegate}`);\n    }\n    return this.walletCommand(async () => {\n      const mappedParams = await this.walletProvider.mapDelegateParamsToWalletParams(\n        async () => params\n      );\n      const opHash = await this.walletProvider.sendOperations([mappedParams]);\n      return this.context.operationFactory.createDelegationOperation(opHash);\n    });\n  }\n\n  /**\n   *\n   * @description Register the current address as delegate.\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   */\n  registerDelegate() {\n    return this.walletCommand(async () => {\n      const mappedParams = await this.walletProvider.mapDelegateParamsToWalletParams(async () => {\n        const delegate = await this.pkh();\n        return { delegate };\n      });\n      const opHash = await this.walletProvider.sendOperations([mappedParams]);\n      return this.context.operationFactory.createDelegationOperation(opHash);\n    });\n  }\n\n  /**\n   *\n   * @description Transfer tezos tokens from current address to a specific address or call a smart contract.\n   *\n   * @returns A wallet command from which we can send the operation to the wallet\n   *\n   * @param params operation parameter\n   */\n  transfer(params: WalletTransferParams) {\n    if (validateAddress(params.to) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid 'to' address: ${params.to}`);\n    }\n    return this.walletCommand(async () => {\n      const mappedParams = await this.walletProvider.mapTransferParamsToWalletParams(\n        async () => params\n      );\n      const opHash = await this.walletProvider.sendOperations([mappedParams]);\n      return this.context.operationFactory.createTransactionOperation(opHash);\n    });\n  }\n\n  /**\n   *\n   * @description Create a batch of operation\n   *\n   * @returns A batch object from which we can add more operation or send a command to the wallet to execute the batch\n   *\n   * @param params List of operation to initialize the batch with\n   */\n  batch(params?: Parameters<WalletOperationBatch['with']>[0]) {\n    const batch = new WalletOperationBatch(this.walletProvider, this.context);\n\n    if (Array.isArray(params)) {\n      batch.with(params);\n    }\n\n    return batch;\n  }\n\n  /**\n   *\n   * @description Create an smart contract abstraction for the address specified. Calling entrypoints with the returned\n   * smart contract abstraction will leverage the wallet provider to make smart contract calls\n   *\n   * @param address Smart contract address\n   */\n  async at<T extends ContractAbstraction<Wallet>>(\n    address: string,\n    contractAbstractionComposer: (abs: ContractAbstraction<Wallet>, context: Context) => T = (x) =>\n      x as any\n  ): Promise<T> {\n    if (validateContractAddress(address) !== ValidationResult.VALID) {\n      throw new InvalidContractAddressError(`Invalid contract address: ${address}`);\n    }\n    const rpc = this.context.withExtensions().rpc;\n    const script = await rpc.getNormalizedScript(address);\n    const entrypoints = await rpc.getEntrypoints(address);\n    const blockHeader = await this.context.rpc.getBlockHeader();\n    const chainId = blockHeader.chain_id;\n    const abs = new ContractAbstraction(\n      address,\n      script,\n      this,\n      this.context.contract,\n      entrypoints,\n      chainId,\n      rpc\n    );\n    return contractAbstractionComposer(abs, this.context);\n  }\n}\n","import { Context } from '../context';\nimport { attachKind, OpKind } from '../operations/types';\nimport {\n  WalletDelegateParams,\n  WalletOriginateParams,\n  WalletProvider,\n  WalletTransferParams,\n} from './interface';\nimport { WalletParamsWithKind } from './wallet';\n\nexport class LegacyWalletProvider implements WalletProvider {\n  constructor(private context: Context) {}\n\n  async getPKH(): Promise<string> {\n    return this.context.signer.publicKeyHash();\n  }\n\n  async mapTransferParamsToWalletParams(params: () => Promise<WalletTransferParams>) {\n    return attachKind(await params(), OpKind.TRANSACTION);\n  }\n\n  async mapOriginateParamsToWalletParams(params: () => Promise<WalletOriginateParams>) {\n    return attachKind(await params(), OpKind.ORIGINATION);\n  }\n\n  async mapDelegateParamsToWalletParams(params: () => Promise<WalletDelegateParams>) {\n    return attachKind(await params(), OpKind.DELEGATION);\n  }\n\n  async sendOperations(params: WalletParamsWithKind[]) {\n    const op = await this.context.batch.batch(params as any).send();\n    return op.hash;\n  }\n}\n","import { TransactionOperation } from '../../operations/transaction-operation';\nimport { TransferParams } from '../../operations/types';\nimport { ContractProvider } from '../interface';\nimport { TransactionWalletOperation, Wallet } from '../../wallet';\nimport { ParameterSchema } from \"@taquito/michelson-encoder\";\nimport { ContractMethodInterface, ExplicitTransferParams, SendParams } from './contract-method-interface';\nimport { DEFAULT_SMART_CONTRACT_METHOD_NAME } from '../contract';\n\n/**\n * @description Utility class to send smart contract operation\n * The format for the arguments is the object representation\n */\nexport class ContractMethodObject<T extends ContractProvider | Wallet> implements ContractMethodInterface {\n    constructor(\n        private provider: T,\n        private address: string,\n        private parameterSchema: ParameterSchema,\n        private name: string,\n        private args: any = 'unit',\n        private isMultipleEntrypoint = true,\n        private isAnonymous = false\n    ) { }\n\n    /**\n     * @description Get the signature of the smart contract method\n     */\n    getSignature() {\n        return this.isAnonymous\n            ? this.parameterSchema.ExtractSchema()[this.name]\n            : this.parameterSchema.ExtractSchema();\n    }\n\n    /**\n     *\n     * @description Send the smart contract operation\n     *\n     * @param Options generic operation parameter\n     */\n    send(\n        params: Partial<SendParams> = {}\n    ): Promise<T extends Wallet ? TransactionWalletOperation : TransactionOperation> {\n        if (this.provider instanceof Wallet) {\n            return (this.provider as unknown as Wallet).transfer(this.toTransferParams(params)).send() as any;\n        } else {\n            return this.provider.transfer(this.toTransferParams(params)) as any;\n        }\n    }\n\n    /**\n     *\n     * @description Create transfer params to be used with TezosToolkit.contract.transfer methods\n     *\n     * @param Options generic transfer operation parameters\n     */\n    toTransferParams({\n        fee,\n        gasLimit,\n        storageLimit,\n        source,\n        amount = 0,\n        mutez = false,\n    }: Partial<SendParams> = {}): TransferParams {\n        const fullTransferParams: ExplicitTransferParams = {\n            to: this.address,\n            amount,\n            fee,\n            mutez,\n            source,\n            gasLimit,\n            storageLimit,\n            parameter: {\n                entrypoint: this.isMultipleEntrypoint ? this.name : DEFAULT_SMART_CONTRACT_METHOD_NAME,\n                value: this.isAnonymous\n                    ? this.parameterSchema.EncodeObject({ [this.name]: this.args })\n                    : this.parameterSchema.EncodeObject(this.args),\n            },\n        };\n        return fullTransferParams;\n    }\n}","import { ViewSchema } from '@taquito/michelson-encoder';\nimport {\n  MichelsonV1Expression,\n  MichelsonV1ExpressionExtended,\n  RpcClientInterface,\n  RPCRunCodeParam,\n} from '@taquito/rpc';\nimport { validateAddress, ValidationResult } from '@taquito/utils';\nimport {\n  InvalidViewSimulationContext,\n  InvalidViewParameterError,\n  ViewSimulationError,\n  validateAndExtractFailwith,\n} from '../errors';\n\nconst runCodeHelper = (\n  viewArgsType: MichelsonV1ExpressionExtended,\n  viewReturnType: MichelsonV1ExpressionExtended,\n  contractStorageType: MichelsonV1Expression,\n  viewInstructions: MichelsonV1ExpressionExtended[],\n  viewArgs: MichelsonV1Expression,\n  contractStorageValue: MichelsonV1Expression,\n  balance: string,\n  chain_id: string,\n  source?: string,\n  amount = '0'\n): RPCRunCodeParam => {\n  return {\n    script: [\n      { prim: 'parameter', args: [{ prim: 'pair', args: [viewArgsType, contractStorageType] }] },\n      { prim: 'storage', args: [{ prim: 'option', args: [viewReturnType] }] },\n      {\n        prim: 'code',\n        args: [\n          [\n            { prim: 'CAR' },\n            viewInstructions,\n            { prim: 'SOME' },\n            { prim: 'NIL', args: [{ prim: 'operation' }] },\n            { prim: 'PAIR' },\n          ],\n        ],\n      },\n    ],\n    storage: { prim: 'None' },\n    input: { prim: 'Pair', args: [viewArgs, contractStorageValue] },\n    amount,\n    balance,\n    chain_id,\n    source,\n  };\n};\n\nexport interface ExecutionContextParams {\n  source?: string;\n  viewCaller: string;\n}\n\nexport class OnChainView {\n  constructor(\n    private _rpc: RpcClientInterface,\n    private _contractAddress: string,\n    private _smartContractViewSchema: ViewSchema,\n    private _contractStorageType: MichelsonV1Expression,\n    private _contractStorageValue: MichelsonV1Expression,\n    private _args: any = 'Unit'\n  ) {}\n\n  /**\n   * @description Get the signature of the smart contract view\n   */\n  getSignature() {\n    return {\n      parameter: this._smartContractViewSchema.extractArgsSchema(),\n      result: this._smartContractViewSchema.extractResultSchema(),\n    };\n  }\n\n  /**\n   * @description Get the result of the view simulation\n   * @param executionContext.source the public key hash of the account who initialized this view execution.\n   * @param executionContext.viewCaller the contract address which is the caller of view.\n   */\n  async executeView(executionContext: ExecutionContextParams) {\n    this.verifyContextExecution(executionContext);\n    const balance = (await this._rpc.getBalance(this._contractAddress)).toString();\n    const chainId = await this._rpc.getChainId();\n    return this.executeViewAndDecodeResult(\n      runCodeHelper(\n        this._smartContractViewSchema.viewArgsType,\n        this._smartContractViewSchema.viewReturnType,\n        this._contractStorageType,\n        this.adaptViewCodeToContext(\n          this._smartContractViewSchema.instructions,\n          executionContext.viewCaller,\n          balance\n        ),\n        this.transformArgsToMichelson(),\n        this._contractStorageValue,\n        balance,\n        chainId,\n        executionContext.source\n      )\n    );\n  }\n\n  private verifyContextExecution(executionContext: ExecutionContextParams) {\n    if (\n      executionContext.source &&\n      validateAddress(executionContext.source) !== ValidationResult.VALID\n    ) {\n      throw new InvalidViewSimulationContext(\n        `The source account who initialized the view execution is invalid: ${executionContext.source}.`\n      );\n    }\n    if (\n      !executionContext.viewCaller ||\n      validateAddress(executionContext.viewCaller) !== ValidationResult.VALID\n    ) {\n      throw new InvalidViewSimulationContext(\n        `The contract which is the caller of view is invalid: ${executionContext.viewCaller}.`\n      );\n    }\n  }\n\n  private transformArgsToMichelson() {\n    try {\n      return this._smartContractViewSchema.encodeViewArgs(this._args);\n    } catch (error) {\n      throw new InvalidViewParameterError(\n        this._smartContractViewSchema.viewName,\n        this.getSignature(),\n        this._args,\n        error\n      );\n    }\n  }\n  /**\n   * @description Loops through the view's instructions and replace BALANCE, SENDER, SELF_ADDRESS and AMOUNT with Michelson expressions that match the current context, if applicable.\n   *\n   * Certain specific instructions have different semantics in view:\n   * BALANCE represents the current amount of mutez held by the contract where view is;\n   * SENDER represents the contract which is the caller of view;\n   * SELF_ADDRESS represents the contract where view is;\n   * AMOUNT is always 0 mutez.\n   *\n   */\n  private adaptViewCodeToContext(\n    instructions: MichelsonV1ExpressionExtended[],\n    viewCaller: string,\n    contractBalance: string\n  ) {\n    const instructionsToReplace = {\n      BALANCE: [{ prim: 'PUSH', args: [{ prim: 'mutez' }, { int: contractBalance }] }],\n      SENDER: [{ prim: 'PUSH', args: [{ prim: 'address' }, { string: viewCaller }] }],\n      SELF_ADDRESS: [\n        { prim: 'PUSH', args: [{ prim: 'address' }, { string: this._contractAddress }] },\n      ],\n      AMOUNT: [{ prim: 'PUSH', args: [{ prim: 'mutez' }, { int: '0' }] }],\n    };\n\n    instructions.forEach((inst: any, i: number) => {\n      if (inst.prim in instructionsToReplace) {\n        instructions[i] = Object(instructionsToReplace)[inst.prim];\n      }\n      if (inst.args && inst.args.length !== 0) {\n        this.adaptViewCodeToContext(inst.args, viewCaller, contractBalance);\n      } else if (Array.isArray(inst)) {\n        this.adaptViewCodeToContext(inst, viewCaller, contractBalance);\n      }\n    });\n    return instructions;\n  }\n\n  private async executeViewAndDecodeResult(viewScript: RPCRunCodeParam) {\n    let storage: MichelsonV1ExpressionExtended;\n    try {\n      storage = (await this._rpc.runCode(viewScript)).storage as MichelsonV1ExpressionExtended;\n    } catch (error: any) {\n      const failWith = validateAndExtractFailwith(error);\n      throw failWith\n        ? new ViewSimulationError(\n            `The simulation of the on-chain view named ${\n              this._smartContractViewSchema.viewName\n            } failed with: ${JSON.stringify(failWith)}`,\n            this._smartContractViewSchema.viewName,\n            failWith,\n            error\n          )\n        : error;\n    }\n    if (!storage.args) {\n      throw new ViewSimulationError(\n        `View simulation failed with an invalid result: ${storage}`,\n        this._smartContractViewSchema.viewName\n      );\n    }\n    return this._smartContractViewSchema.decodeViewResult(storage.args[0]);\n  }\n}\n","import { Wallet } from '../../wallet';\nimport { ContractProvider } from '../../contract';\nimport { ContractMethodObject } from './contract-method-object-param';\nimport { ContractMethod } from './contract-method-flat-param';\nimport { ParameterSchema, ViewSchema } from '@taquito/michelson-encoder';\nimport { RpcClientInterface, MichelsonV1Expression } from '@taquito/rpc';\nimport { OnChainView } from './contract-on-chain-view';\n\nexport class ContractMethodFactory<T extends ContractProvider | Wallet> {\n  constructor(private provider: T, private contractAddress: string) {}\n\n  createContractMethodFlatParams(\n    smartContractMethodSchema: ParameterSchema,\n    smartContractMethodName: string,\n    args: any[],\n    isMultipleEntrypoint = true,\n    isAnonymous = false\n  ) {\n    return new ContractMethod<T>(\n      this.provider,\n      this.contractAddress,\n      smartContractMethodSchema,\n      smartContractMethodName,\n      args,\n      isMultipleEntrypoint,\n      isAnonymous\n    );\n  }\n\n  createContractMethodObjectParam(\n    smartContractMethodSchema: ParameterSchema,\n    smartContractMethodName: string,\n    args: any[],\n    isMultipleEntrypoint = true,\n    isAnonymous = false\n  ) {\n    return new ContractMethodObject<T>(\n      this.provider,\n      this.contractAddress,\n      smartContractMethodSchema,\n      smartContractMethodName,\n      args,\n      isMultipleEntrypoint,\n      isAnonymous\n    );\n  }\n\n  createContractViewObjectParam(\n    rpc: RpcClientInterface,\n    smartContractViewSchema: ViewSchema,\n    contractStorageType: MichelsonV1Expression,\n    contractStorageValue: MichelsonV1Expression,\n    viewArgs: any\n  ) {\n    return new OnChainView(\n      rpc,\n      this.contractAddress,\n      smartContractViewSchema,\n      contractStorageType,\n      contractStorageValue,\n      viewArgs\n    );\n  }\n}\n","import { MichelsonV1Expression } from '@taquito/rpc';\nimport { Contract, ContractAbstraction, WalletContract } from './contract';\nimport { TezosOperationError } from '../operations/operation-errors';\nimport { ContractProvider } from './interface';\nimport { Wallet } from '../wallet';\n\nexport default class LambdaView {\n  public readonly voidLambda: object;\n\n  constructor(\n    private lambdaContract: Contract | WalletContract,\n    private viewContract: ContractAbstraction<ContractProvider | Wallet>,\n    public readonly viewMethod: string = 'default',\n    private contractParameter: MichelsonV1Expression = { prim: 'Unit' }\n  ) {\n    this.voidLambda = this.createVoidLambda();\n  }\n\n  async execute(): Promise<any> {\n    try {\n      await this.lambdaContract.methods.default(this.voidLambda).send();\n    } catch (ex) {\n      if (ex instanceof TezosOperationError) {\n        const lastError: any = ex.errors[ex.errors.length - 1];\n\n        const failedWith = lastError.with;\n        return failedWith;\n      } else {\n        throw ex;\n      }\n    }\n  }\n\n  private createVoidLambda(): object {\n    const [parameter, callback] = this.getView();\n\n    let contractArgs: MichelsonV1Expression[] = [\n      {\n        prim: 'pair',\n        args: [parameter, { prim: 'contract', args: [callback] }],\n      },\n    ];\n\n    if (this.viewMethod === 'default') {\n      contractArgs = ([{ string: '%default' }] as MichelsonV1Expression[]).concat(contractArgs);\n    }\n\n    return [\n      { prim: 'PUSH', args: [{ prim: 'mutez' }, { int: '0' }] },\n      { prim: 'NONE', args: [{ prim: 'key_hash' }] },\n      {\n        prim: 'CREATE_CONTRACT',\n        args: [\n          [\n            { prim: 'parameter', args: [callback] },\n            { prim: 'storage', args: [{ prim: 'unit' }] },\n            {\n              prim: 'code',\n              args: [[{ prim: 'CAR' }, { prim: 'FAILWITH' }]],\n            },\n          ],\n        ],\n      },\n      {\n        prim: 'DIP',\n        args: [\n          [\n            {\n              prim: 'DIP',\n              args: [\n                [\n                  {\n                    prim: 'LAMBDA',\n                    args: [\n                      {\n                        prim: 'pair',\n                        args: [{ prim: 'address' }, { prim: 'unit' }],\n                      },\n                      {\n                        prim: 'pair',\n                        args: [{ prim: 'list', args: [{ prim: 'operation' }] }, { prim: 'unit' }],\n                      },\n                      [\n                        { prim: 'CAR' },\n                        { prim: 'CONTRACT', args: [callback] },\n                        {\n                          prim: 'IF_NONE',\n                          args: [\n                            [\n                              {\n                                prim: 'PUSH',\n                                args: [{ prim: 'string' }, { string: `Callback type unmatched` }],\n                              },\n                              { prim: 'FAILWITH' },\n                            ],\n                            [],\n                          ],\n                        },\n                        {\n                          prim: 'PUSH',\n                          args: [parameter, this.contractParameter],\n                        },\n                        { prim: 'PAIR' },\n                        {\n                          prim: 'DIP',\n                          args: [\n                            [\n                              {\n                                prim: 'PUSH',\n                                args: [\n                                  { prim: 'address' },\n                                  { string: `${this.viewContract.address}%${this.viewMethod}` },\n                                ],\n                              },\n                              { prim: 'DUP' },\n                              { prim: 'CONTRACT', args: contractArgs },\n                              {\n                                prim: 'IF_NONE',\n                                args: [\n                                  [\n                                    {\n                                      prim: 'PUSH',\n                                      args: [\n                                        { prim: 'string' },\n                                        { string: `Contract does not exist` },\n                                      ],\n                                    },\n                                    { prim: 'FAILWITH' },\n                                  ],\n                                  [{ prim: 'DIP', args: [[{ prim: 'DROP' }]] }],\n                                ],\n                              },\n                              {\n                                prim: 'PUSH',\n                                args: [{ prim: 'mutez' }, { int: '0' }],\n                              },\n                            ],\n                          ],\n                        },\n                        { prim: 'TRANSFER_TOKENS' },\n                        {\n                          prim: 'DIP',\n                          args: [[{ prim: 'NIL', args: [{ prim: 'operation' }] }]],\n                        },\n                        { prim: 'CONS' },\n                        { prim: 'DIP', args: [[{ prim: 'UNIT' }]] },\n                        { prim: 'PAIR' },\n                      ],\n                    ],\n                  },\n                ],\n              ],\n            },\n            { prim: 'APPLY' },\n            {\n              prim: 'DIP',\n              args: [\n                [\n                  {\n                    prim: 'PUSH',\n                    args: [{ prim: 'address' }, { string: this.lambdaContract.address }],\n                  },\n                  { prim: 'DUP' },\n                  {\n                    prim: 'CONTRACT',\n                    args: [\n                      {\n                        prim: 'lambda',\n                        args: [\n                          { prim: 'unit' },\n                          {\n                            prim: 'pair',\n                            args: [\n                              { prim: 'list', args: [{ prim: 'operation' }] },\n                              { prim: 'unit' },\n                            ],\n                          },\n                        ],\n                      },\n                    ],\n                  },\n                  {\n                    prim: 'IF_NONE',\n                    args: [\n                      [\n                        {\n                          prim: 'PUSH',\n                          args: [{ prim: 'string' }, { string: `Contract does not exists` }],\n                        },\n                        { prim: 'FAILWITH' },\n                      ],\n                      [{ prim: 'DIP', args: [[{ prim: 'DROP' }]] }],\n                    ],\n                  },\n                  { prim: 'PUSH', args: [{ prim: 'mutez' }, { int: '0' }] },\n                ],\n              ],\n            },\n            { prim: 'TRANSFER_TOKENS' },\n            {\n              prim: 'DIP',\n              args: [[{ prim: 'NIL', args: [{ prim: 'operation' }] }]],\n            },\n            { prim: 'CONS' },\n          ],\n        ],\n      },\n      { prim: 'CONS' },\n      { prim: 'DIP', args: [[{ prim: 'UNIT' }]] },\n      { prim: 'PAIR' },\n    ];\n  }\n\n  private getView(): [MichelsonV1Expression, MichelsonV1Expression] {\n    const entrypoints = this.viewContract.entrypoints.entrypoints;\n    const entrypoint = entrypoints[this.viewMethod] as MichelsonV1Expression;\n\n    if (!entrypoint) {\n      throw Error(\n        `Contract at ${this.viewContract.address} does not have entrypoint: ${this.viewMethod}`\n      );\n    }\n\n    if (!('prim' in entrypoint) || !entrypoint.args) {\n      // TODO: Enhance this error message to be more descriptive\n      throw Error('Entrypoint args undefined');\n    }\n\n    const args = Array.from(entrypoint.args) as [MichelsonV1Expression, MichelsonV1Expression];\n    const [parameter, callbackContract] = args;\n    if ('annots' in parameter) {\n      delete parameter['annots'];\n    }\n\n    if (!('prim' in callbackContract) || !callbackContract.args) {\n      // TODO: Enhance this error message to be more descriptive\n      throw Error('Callback contract args undefined');\n    }\n\n    let message;\n    if (entrypoint.prim !== 'pair') {\n      message = `Expected {'prim': 'pair', ..} but found {'prim': ${entrypoint.prim}, ..}`;\n    } else if (args.length !== 2) {\n      message = `Expected an Array of length 2, but found: ${args}`;\n    } else if (callbackContract.prim !== 'contract') {\n      message = `Expected a {prim: 'contract', ...}, but found: ${callbackContract.prim}`;\n    } else if (callbackContract.args && callbackContract.args.length !== 1) {\n      message = `Expected a single argument to 'contract', but found: ${callbackContract.args}`;\n    }\n\n    if (message) throw Error(message);\n\n    return [parameter, callbackContract.args[0]] as [MichelsonV1Expression, MichelsonV1Expression];\n  }\n}\n","import { ParameterSchema, Schema, ViewSchema } from '@taquito/michelson-encoder';\nimport {\n  EntrypointsResponse,\n  MichelsonV1Expression,\n  RpcClientInterface,\n  ScriptResponse,\n} from '@taquito/rpc';\nimport { ChainIds, DefaultLambdaAddresses } from '../constants';\nimport { Wallet } from '../wallet';\nimport { ContractMethodFactory } from './contract-methods/contract-method-factory';\nimport { ContractMethod } from './contract-methods/contract-method-flat-param';\nimport { ContractMethodObject } from './contract-methods/contract-method-object-param';\nimport { OnChainView } from './contract-methods/contract-on-chain-view';\nimport { InvalidParameterError, UndefinedLambdaContractError } from './errors';\nimport { ContractProvider, StorageProvider } from './interface';\nimport LambdaView from './lambda-view';\n\nexport const DEFAULT_SMART_CONTRACT_METHOD_NAME = 'default';\n\n/**\n * @description Utility class to retrieve data from a smart contract's storage without incurring fees via a contract's view method\n */\nexport class ContractView {\n  constructor(\n    private currentContract: ContractAbstraction<ContractProvider | Wallet>,\n    private provider: ContractProvider,\n    private name: string,\n    private chainId: string,\n    private callbackParametersSchema: ParameterSchema,\n    private parameterSchema: ParameterSchema,\n    private args: any[]\n  ) {}\n\n  /**\n   *\n   * @description Find which lambda contract to use based on the current network,\n   * encode parameters to Michelson,\n   * create an instance of Lambdaview to retrieve data, and\n   * Decode Michelson response\n   *\n   * @param Options Address of a lambda contract (sandbox users)\n   */\n  async read(customLambdaAddress?: string) {\n    let lambdaAddress;\n\n    // TODO Verify if the 'customLambdaAdress' is a valid originated contract and if not, return an appropriate error message.  \n    if (customLambdaAddress) {\n      lambdaAddress = customLambdaAddress;\n    } else if (this.chainId === ChainIds.GRANADANET) {\n      lambdaAddress = DefaultLambdaAddresses.GRANADANET;\n    } else if (this.chainId === ChainIds.HANGZHOUNET) {\n      lambdaAddress = DefaultLambdaAddresses.HANGZHOUNET;\n    } else if (this.chainId === ChainIds.ITHACANET) {\n      lambdaAddress = DefaultLambdaAddresses.ITHACANET;\n    } else if (this.chainId === ChainIds.ITHACANET2) {\n      lambdaAddress = DefaultLambdaAddresses.ITHACANET2;\n    } else if (this.chainId === ChainIds.MAINNET) {\n      lambdaAddress = DefaultLambdaAddresses.MAINNET;\n    } else {\n      throw new UndefinedLambdaContractError();\n    }\n\n    const lambdaContract = await this.provider.at(lambdaAddress);\n    const arg = this.parameterSchema.Encode(...this.args);\n    const lambdaView = new LambdaView(lambdaContract, this.currentContract, this.name, arg);\n    const failedWith = await lambdaView.execute();\n    const response = this.callbackParametersSchema.Execute(failedWith);\n    return response;\n  }\n}\n\nconst validateArgs = (args: any[], schema: ParameterSchema, name: string) => {\n  const sigs = schema.ExtractSignatures();\n\n  if (!sigs.find((x: any[]) => x.length === args.length)) {\n    throw new InvalidParameterError(name, sigs, args);\n  }\n};\n\n// lambda view tzip4\nconst isView = (entrypoint: MichelsonV1Expression): boolean => {\n  let isView = false;\n  if ('prim' in entrypoint && entrypoint.prim === 'pair' && entrypoint.args) {\n    const lastElement = entrypoint.args[entrypoint.args.length - 1];\n    if ('prim' in lastElement && lastElement.prim === 'contract') {\n      isView = true;\n    }\n  }\n  return isView;\n};\n\nexport type Contract = ContractAbstraction<ContractProvider>;\nexport type WalletContract = ContractAbstraction<Wallet>;\n\nconst isContractProvider = (variableToCheck: any): variableToCheck is ContractProvider =>\n  variableToCheck.contractProviderTypeSymbol !== undefined;\n\n\ntype DefaultMethods<T extends ContractProvider | Wallet> = Record<string, (...args: any[]) => ContractMethod<T>>;\ntype DefaultMethodsObject<T extends ContractProvider | Wallet> = Record<string, (args?: any) => ContractMethodObject<T>>;\ntype DefaultViews = Record<string, (...args: any[]) => ContractView>;\ntype DefaultContractViews = Record<string, (args?: any) => OnChainView>;\ntype DefaultStorage = unknown; // Record<string, unknown>;\n\ntype PromiseReturnType<T extends (...args: any) => any> = T extends (...args: any) => Promise<infer R> ? R : any;\nexport type ContractStorageType<T extends ContractAbstraction<ContractProvider|Wallet>> = PromiseReturnType<T['storage']>;\nexport type DefaultContractType = ContractAbstraction<ContractProvider>;\nexport type DefaultWalletType = ContractAbstraction<Wallet>;\n\n/**\n * @description Smart contract abstraction\n */\nexport class ContractAbstraction<T extends ContractProvider | Wallet,\n  TMethods extends DefaultMethods<T> = DefaultMethods<T>,\n  TMethodsObject extends DefaultMethodsObject<T> = DefaultMethodsObject<T>,\n  TViews extends DefaultViews = DefaultViews,\n  TContractViews extends DefaultContractViews = DefaultContractViews,\n  TStorage extends DefaultStorage = DefaultStorage\n> {\n  private contractMethodFactory: ContractMethodFactory<T>;\n  /**\n   * @description Contains methods that are implemented by the target Tezos Smart Contract, and offers the user to call the Smart Contract methods as if they were native TS/JS methods.\n   * NB: if the contract contains annotation it will include named properties; if not it will be indexed by a number.\n   *\n   */\n  public methods: TMethods = {} as TMethods;\n  /**\n   * @description Contains methods that are implemented by the target Tezos Smart Contract, and offers the user to call the Smart Contract methods as if they were native TS/JS methods.\n   * `methodsObject` serves the exact same purpose as the `methods` member. The difference is that it allows passing the parameter in an object format when calling the smart contract method (instead of the flattened representation)\n   * NB: if the contract contains annotation it will include named properties; if not it will be indexed by a number.\n   *\n   */\n  public methodsObject: TMethodsObject = {} as TMethodsObject;\n  /**\n   * @description Contains lamda views (tzip4) that are implemented by the target Tezos Smart Contract, and offers the user to call the lambda views as if they were native TS/JS methods.\n   * NB: These are the view defined in the tzip4 standard, not the views introduced by the Hangzhou protocol.\n   */\n  public views: TViews = {} as TViews;\n  /**\n   * @description Contains on-chain views that are defined by the target Tezos Smart Contract, and offers the user to simulate the views execution as if they were native TS/JS methods.\n   * NB: the expected format for the parameter when calling a smart contract view is the object format (same format as for the storage) and not the flattened representation.\n   *\n   */\n  public contractViews: TContractViews = {} as TContractViews;\n\n  public readonly schema: Schema;\n\n  public readonly parameterSchema: ParameterSchema;\n  public readonly viewSchema: ViewSchema[];\n\n  constructor(\n    public readonly address: string,\n    public readonly script: ScriptResponse,\n    provider: T,\n    private storageProvider: StorageProvider,\n    public readonly entrypoints: EntrypointsResponse,\n    private chainId: string,\n    rpc: RpcClientInterface\n  ) {\n    this.contractMethodFactory = new ContractMethodFactory(provider, address);\n    this.schema = Schema.fromRPCResponse({ script: this.script });\n    this.parameterSchema = ParameterSchema.fromRPCResponse({ script: this.script });\n\n    this.viewSchema = ViewSchema.fromRPCResponse({ script: this.script });\n    if (this.viewSchema.length !== 0) {\n      this._initializeOnChainViews(this, rpc, this.viewSchema);\n    }\n    this._initializeMethods(this, provider, this.entrypoints.entrypoints, this.chainId);\n  }\n\n  private _initializeMethods(\n    currentContract: ContractAbstraction<T>,\n    provider: T,\n    entrypoints: {\n      [key: string]: object;\n    },\n    chainId: string\n  ) {\n    const parameterSchema = this.parameterSchema;\n    const keys = Object.keys(entrypoints);\n    if (parameterSchema.isMultipleEntryPoint) {\n      keys.forEach((smartContractMethodName) => {\n        const smartContractMethodSchema = new ParameterSchema(entrypoints[smartContractMethodName]);\n\n        (this.methods as DefaultMethods<T>)[smartContractMethodName] = function (...args: any[]) {\n          return currentContract.contractMethodFactory.createContractMethodFlatParams(\n            smartContractMethodSchema,\n            smartContractMethodName,\n            args\n          );\n        };\n\n        (this.methodsObject as DefaultMethodsObject<T>)[smartContractMethodName] = function (args: any) {\n          return currentContract.contractMethodFactory.createContractMethodObjectParam(\n            smartContractMethodSchema,\n            smartContractMethodName,\n            args\n          );\n        };\n\n        if (isContractProvider(provider)) {\n          if (isView(entrypoints[smartContractMethodName])) {\n            const view = function (...args: any[]) {\n              const entrypointParamWithoutCallback = (entrypoints[smartContractMethodName] as any)\n                .args[0];\n              const smartContractMethodSchemaWithoutCallback = new ParameterSchema(\n                entrypointParamWithoutCallback\n              );\n              const parametersCallback = (entrypoints[smartContractMethodName] as any).args[1]\n                .args[0];\n              const smartContractMethodCallbackSchema = new ParameterSchema(parametersCallback);\n\n              validateArgs(args, smartContractMethodSchemaWithoutCallback, smartContractMethodName);\n              return new ContractView(\n                currentContract,\n                provider,\n                smartContractMethodName,\n                chainId,\n                smartContractMethodCallbackSchema,\n                smartContractMethodSchemaWithoutCallback,\n                args\n              );\n            };\n            (this.views as DefaultViews)[smartContractMethodName] = view;\n          }\n        }\n      });\n\n      // Deal with methods with no annotations which were not discovered by the RPC endpoint\n      // Methods with no annotations are discovered using parameter schema\n      const anonymousMethods = Object.keys(parameterSchema.ExtractSchema()).filter(\n        (key) => Object.keys(entrypoints).indexOf(key) === -1\n      );\n\n      anonymousMethods.forEach((smartContractMethodName) => {\n        (this.methods as DefaultMethods<T>)[smartContractMethodName] = function (...args: any[]) {\n          return currentContract.contractMethodFactory.createContractMethodFlatParams(\n            parameterSchema,\n            smartContractMethodName,\n            args,\n            false,\n            true\n          );\n        };\n\n        (this.methodsObject as DefaultMethodsObject<T>)[smartContractMethodName] = function (args: any) {\n          return currentContract.contractMethodFactory.createContractMethodObjectParam(\n            parameterSchema,\n            smartContractMethodName,\n            args,\n            false,\n            true\n          );\n        };\n      });\n    } else {\n      const smartContractMethodSchema = this.parameterSchema;\n      (this.methods as DefaultMethods<T>)[DEFAULT_SMART_CONTRACT_METHOD_NAME] = function (...args: any[]) {\n        return currentContract.contractMethodFactory.createContractMethodFlatParams(\n          smartContractMethodSchema,\n          DEFAULT_SMART_CONTRACT_METHOD_NAME,\n          args,\n          false\n        );\n      };\n\n      (this.methodsObject as DefaultMethodsObject<T>)[DEFAULT_SMART_CONTRACT_METHOD_NAME] = function (args: any) {\n        return currentContract.contractMethodFactory.createContractMethodObjectParam(\n          smartContractMethodSchema,\n          DEFAULT_SMART_CONTRACT_METHOD_NAME,\n          args,\n          false\n        );\n      };\n    }\n  }\n\n  private _initializeOnChainViews(\n    currentContract: ContractAbstraction<T>,\n    rpc: RpcClientInterface,\n    allContractViews: ViewSchema[]\n  ) {\n    const storageType = this.schema.val;\n    const storageValue = this.script.storage;\n\n    allContractViews.forEach((viewSchema) => {\n      (this.contractViews as DefaultContractViews)[viewSchema.viewName] = function (args: any) {\n        return currentContract.contractMethodFactory.createContractViewObjectParam(\n          rpc,\n          viewSchema,\n          storageType,\n          storageValue,\n          args\n        );\n      };\n    });\n  }\n\n  /**\n   * @description Return a friendly representation of the smart contract storage\n   */\n  public storage<T extends TStorage = TStorage>() {\n    return this.storageProvider.getStorage<T>(this.address, this.schema);\n  }\n\n  /**\n   *\n   * @description Return a friendly representation of the smart contract big map value\n   *\n   * @param key BigMap key to fetch\n   *\n   * @deprecated getBigMapKey has been deprecated in favor of getBigMapKeyByID\n   *\n   * @see https://tezos.gitlab.io/api/rpc.html#post-block-id-context-contracts-contract-id-big-map-get\n   */\n  public bigMap(key: string) {\n    return this.storageProvider.getBigMapKey(this.address, key, this.schema);\n  }\n}\n","import { Schema, BigMapKeyType } from '@taquito/michelson-encoder';\nimport BigNumber from 'bignumber.js';\nimport { ContractProvider } from './interface';\nimport { HttpResponseError, STATUS_CODE } from '@taquito/http-utils';\n\nexport class BigMapAbstraction {\n  constructor(private id: BigNumber, private schema: Schema, private provider: ContractProvider) {}\n\n  /**\n   *\n   * @description Fetch one value in a big map\n   *\n   * @param keysToEncode Key to query (will be encoded properly according to the schema)\n   * @param block optional block level to fetch the values from (head will be use by default)\n   * @returns Return a well formatted json object of a big map value or undefined if the key is not found in the big map\n   *\n   */\n  async get<T>(keyToEncode: BigMapKeyType, block?: number) {\n    try {\n      const id = await this.provider.getBigMapKeyByID<T>(\n        this.id.toString(),\n        keyToEncode,\n        this.schema,\n        block\n      );\n      return id;\n    } catch (e) {\n      if (e instanceof HttpResponseError && e.status === STATUS_CODE.NOT_FOUND) {\n        return undefined;\n      } else {\n        throw e;\n      }\n    }\n  }\n\n  /**\n   *\n   * @description Fetch multiple values in a big map\n   * All values will be fetched on the same block level. If a block is specified in the request, the values will be fetched at it.\n   * Otherwise, a first request will be done to the node to fetch the level of the head and all values will be fetched at this level.\n   * If one of the keys does not exist in the big map, its value will be set to undefined.\n   *\n   * @param keysToEncode Array of keys to query (will be encoded properly according to the schema)\n   * @param block optional block level to fetch the values from\n   * @param batchSize optional batch size representing the number of requests to execute in parallel\n   * @returns A MichelsonMap containing the keys queried in the big map and their value in a well-formatted JSON object format\n   *\n   */\n  async getMultipleValues<T>(keysToEncode: Array<BigMapKeyType>, block?: number, batchSize = 5) {\n    return this.provider.getBigMapKeysByID<T>(\n      this.id.toString(),\n      keysToEncode,\n      this.schema,\n      block,\n      batchSize\n    );\n  }\n\n  toJSON() {\n    return this.id.toString();\n  }\n\n  toString() {\n    return this.id.toString();\n  }\n}\n","import BigNumber from 'bignumber.js';\nimport { ContractProvider } from './interface';\n\nexport class SaplingStateAbstraction {\n    constructor(private id: BigNumber, private provider: ContractProvider) { }\n\n    /**\n     *\n     * @description Fetch the sapling state\n     * \n     * @param block optional block level to fetch the values from (head will be use by default)\n     * @returns Return a json object of the sapling_state\n     *\n     */\n    async getSaplingDiff(block?: number) {\n        return this.provider.getSaplingDiffByID(this.id.toString(), block);\n    }\n\n    getId() {\n        return this.id.toString();\n    }\n}\n","import { Schema, Semantic } from '@taquito/michelson-encoder';\nimport { BigMapAbstraction } from './big-map';\nimport { ContractProvider } from './interface';\nimport BigNumber from 'bignumber.js';\nimport { MichelsonV1Expression } from '@taquito/rpc';\nimport { SaplingStateAbstraction } from './sapling-state-abstraction';\n\n// Override the default michelson encoder semantic to provide richer abstraction over storage properties\nexport const smartContractAbstractionSemantic: (p: ContractProvider) => Semantic = (\n  provider: ContractProvider\n) => ({\n  // Provide a specific abstraction for BigMaps\n  big_map: (val: MichelsonV1Expression, code: MichelsonV1Expression) => {\n    if (!val || !('int' in val) || val.int === undefined) {\n      // Return an empty object in case of missing big map ID\n      return {};\n    } else {\n      const schema = new Schema(code);\n      return new BigMapAbstraction(new BigNumber(val.int), schema, provider);\n    }\n  },\n  sapling_state: (val: MichelsonV1Expression) => {\n    if (!val || !('int' in val) || val.int === undefined) {\n      // Return an empty object in case of missing sapling state ID\n      return {};\n    } else {\n      return new SaplingStateAbstraction(new BigNumber(val.int), provider);\n    }\n  }\n  /*\n  // TODO: embed useful other abstractions\n  'contract':  () => {},\n  'address':  () => {}\n  */\n});\n","import { HttpResponseError, STATUS_CODE } from '@taquito/http-utils';\nimport { BigMapKeyType, MichelsonMap, MichelsonMapKey, Schema } from '@taquito/michelson-encoder';\nimport { OpKind, ScriptResponse } from '@taquito/rpc';\nimport { encodeExpr } from '@taquito/utils';\nimport { OperationBatch } from '../batch/rpc-batch-provider';\nimport { Context } from '../context';\nimport { DelegateOperation } from '../operations/delegate-operation';\nimport { OperationEmitter } from '../operations/operation-emitter';\nimport { OriginationOperation } from '../operations/origination-operation';\nimport { RegisterGlobalConstantOperation } from '../operations/register-global-constant-operation';\nimport { RevealOperation } from '../operations/reveal-operation';\nimport { TransactionOperation } from '../operations/transaction-operation';\nimport {\n  DelegateParams,\n  isOpRequireReveal,\n  OriginateParams,\n  ParamsWithKind,\n  RegisterDelegateParams,\n  RegisterGlobalConstantParams,\n  RevealParams,\n  RPCOperation,\n  TransferParams,\n  withKind,\n} from '../operations/types';\nimport { DefaultContractType, ContractStorageType, ContractAbstraction } from './contract';\nimport { InvalidDelegationSource } from './errors';\nimport { ContractProvider, ContractSchema, EstimationProvider, StorageProvider } from './interface';\nimport {\n  createOriginationOperation,\n  createRegisterDelegateOperation,\n  createRegisterGlobalConstantOperation,\n  createRevealOperation,\n  createSetDelegateOperation,\n  createTransferOperation,\n} from './prepare';\nimport { smartContractAbstractionSemantic } from './semantic';\nimport { \n  validateAddress,\n  validateContractAddress,\n  InvalidContractAddressError,\n  InvalidAddressError, \n  ValidationResult \n} from '@taquito/utils';\nexport class RpcContractProvider\n  extends OperationEmitter\n  implements ContractProvider, StorageProvider\n{\n  constructor(context: Context, private estimator: EstimationProvider) {\n    super(context);\n  }\n  contractProviderTypeSymbol = Symbol.for('taquito--provider-type-symbol');\n\n  /**\n   *\n   * @description Return a well formatted json object of the contract storage\n   *\n   * @param contract contract address you want to get the storage from\n   * @param schema optional schema can either be the contract script rpc response or a michelson-encoder schema\n   *\n   * @see https://tezos.gitlab.io/api/rpc.html#get-block-id-context-contracts-contract-id-script\n   */\n  async getStorage<T>(contract: string, schema?: ContractSchema): Promise<T> {\n    if (validateContractAddress(contract) !== ValidationResult.VALID) {\n      throw new InvalidContractAddressError(`Invalid contract address: ${contract}`);\n    }\n    if (!schema) {\n      schema = await this.rpc.getNormalizedScript(contract);\n    }\n\n    let contractSchema: Schema;\n    if (Schema.isSchema(schema)) {\n      contractSchema = schema;\n    } else {\n      contractSchema = Schema.fromRPCResponse({ script: schema as ScriptResponse });\n    }\n\n    const storage = await this.rpc.getStorage(contract);\n\n    return contractSchema.Execute(storage, smartContractAbstractionSemantic(this)) as T; // Cast into T because only the caller can know the true type of the storage\n  }\n\n  /**\n   *\n   * @description Return a well formatted json object of the contract big map storage\n   *\n   * @param contract contract address you want to get the storage from\n   * @param key contract big map key to fetch value from\n   * @param schema optional schema can either be the contract script rpc response or a michelson-encoder schema\n   *\n   * @deprecated Deprecated in favor of getBigMapKeyByID\n   *\n   * @see https://tezos.gitlab.io/api/rpc.html#post-block-id-context-contracts-contract-id-big-map-get\n   */\n  async getBigMapKey<T>(contract: string, key: string, schema?: ContractSchema): Promise<T> {\n    if (validateContractAddress(contract) !== ValidationResult.VALID) {\n      throw new InvalidContractAddressError(`Invalid contract address: ${contract}`);\n    }\n    if (!schema) {\n      schema = await this.rpc.getNormalizedScript(contract);\n    }\n\n    let contractSchema: Schema;\n    if (Schema.isSchema(schema)) {\n      contractSchema = schema;\n    } else {\n      contractSchema = Schema.fromRPCResponse({ script: schema as ScriptResponse });\n    }\n\n    const encodedKey = contractSchema.EncodeBigMapKey(key);\n\n    const val = await this.rpc.getBigMapKey(contract, encodedKey);\n\n    return contractSchema.ExecuteOnBigMapValue(val) as T; // Cast into T because only the caller can know the true type of the storage\n  }\n\n  /**\n   *\n   * @description Return a well formatted json object of a big map value\n   *\n   * @param id Big Map ID\n   * @param keyToEncode key to query (will be encoded properly according to the schema)\n   * @param schema Big Map schema (can be determined using your contract type)\n   * @param block optional block level to fetch the values from\n   *\n   * @see https://tezos.gitlab.io/api/rpc.html#get-block-id-context-big-maps-big-map-id-script-expr\n   */\n  async getBigMapKeyByID<T>(\n    id: string,\n    keyToEncode: BigMapKeyType,\n    schema: Schema,\n    block?: number\n  ): Promise<T> {\n    const { key, type } = schema.EncodeBigMapKey(keyToEncode);\n    const { packed } = await this.context.packer.packData({ data: key, type });\n\n    const encodedExpr = encodeExpr(packed);\n\n    const bigMapValue = block\n      ? await this.context.rpc.getBigMapExpr(id.toString(), encodedExpr, { block: String(block) })\n      : await this.context.rpc.getBigMapExpr(id.toString(), encodedExpr);\n\n    return schema.ExecuteOnBigMapValue(bigMapValue, smartContractAbstractionSemantic(this)) as T;\n  }\n\n  /**\n   *\n   * @description Fetch multiple values in a big map\n   * All values will be fetched on the same block level. If a block is specified in the request, the values will be fetched at it.\n   * Otherwise, a first request will be done to the node to fetch the level of the head and all values will be fetched at this level.\n   * If one of the keys does not exist in the big map, its value will be set to undefined.\n   *\n   * @param id Big Map ID\n   * @param keys Array of keys to query (will be encoded properly according to the schema)\n   * @param schema Big Map schema (can be determined using your contract type)\n   * @param block optional block level to fetch the values from\n   * @param batchSize optional batch size representing the number of requests to execute in parallel\n   * @returns A MichelsonMap containing the keys queried in the big map and their value in a well-formatted JSON object format\n   *\n   */\n  async getBigMapKeysByID<T>(\n    id: string,\n    keys: Array<BigMapKeyType>,\n    schema: Schema,\n    block?: number,\n    batchSize = 5\n  ): Promise<MichelsonMap<MichelsonMapKey, T | undefined>> {\n    const level = await this.getBlockForRequest(keys, block);\n    const bigMapValues = new MichelsonMap<MichelsonMapKey, T | undefined>();\n\n    // Execute batch of promises in series\n    let position = 0;\n    let results: Array<T | undefined> = [];\n\n    while (position < keys.length) {\n      const keysBatch = keys.slice(position, position + batchSize);\n      const batch = keysBatch.map((keyToEncode) =>\n        this.getBigMapValueOrUndefined<T>(keyToEncode, id, schema, level)\n      );\n      results = [...results, ...(await Promise.all(batch))];\n      position += batchSize;\n    }\n\n    for (let i = 0; i < results.length; i++) {\n      bigMapValues.set(keys[i], results[i]);\n    }\n\n    return bigMapValues;\n  }\n\n  private async getBlockForRequest(keys: Array<BigMapKeyType>, block?: number) {\n    return keys.length === 1 || typeof block !== 'undefined'\n      ? block\n      : (await this.rpc.getBlock())?.header.level;\n  }\n\n  private async getBigMapValueOrUndefined<T>(\n    keyToEncode: BigMapKeyType,\n    id: string,\n    schema: Schema,\n    level?: number\n  ) {\n    try {\n      return await this.getBigMapKeyByID<T>(id, keyToEncode, schema, level);\n    } catch (ex) {\n      if (ex instanceof HttpResponseError && ex.status === STATUS_CODE.NOT_FOUND) {\n        return;\n      } else {\n        throw ex;\n      }\n    }\n  }\n\n  /**\n   *\n   * @description Return a well formatted json object of a sapling state\n   *\n   * @param id Sapling state ID\n   * @param block optional block level to fetch the value from\n   *\n   */\n  async getSaplingDiffByID(id: string, block?: number) {\n    const saplingState = block\n      ? await this.context.rpc.getSaplingDiffById(id.toString(), { block: String(block) })\n      : await this.context.rpc.getSaplingDiffById(id.toString());\n    return saplingState;\n  }\n\n  private async addRevealOperationIfNeeded(operation: RPCOperation, publicKeyHash: string) {\n    if (isOpRequireReveal(operation)) {\n      const ops: RPCOperation[] = [operation];\n      const publicKey = await this.signer.publicKey();\n      const estimateReveal = await this.estimator.reveal();\n      if (estimateReveal) {\n        const reveal: withKind<RevealParams, OpKind.REVEAL> = { kind: OpKind.REVEAL };\n        const estimatedReveal = await this.estimate(reveal, async () => estimateReveal);\n        ops.unshift(await createRevealOperation({ ...estimatedReveal }, publicKeyHash, publicKey));\n        return ops;\n      }\n    }\n    return operation;\n  }\n\n  /**\n   *\n   * @description Originate a new contract according to the script in parameters. Will sign and inject an operation using the current context\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @warn You cannot specify storage and init at the same time (use init to pass the raw michelson representation of storage)\n   *\n   * @param OriginationOperation Originate operation parameter\n   */\n  async originate<TContract extends DefaultContractType = DefaultContractType>(params: OriginateParams<ContractStorageType<TContract>>) {\n    const estimate = await this.estimate(params, this.estimator.originate.bind(this.estimator));\n\n    const publicKeyHash = await this.signer.publicKeyHash();\n    const operation = await createOriginationOperation(\n      await this.context.parser.prepareCodeOrigination({\n        ...params,\n        ...estimate,\n      })\n    );\n    const ops = await this.addRevealOperationIfNeeded(operation, publicKeyHash);\n    const preparedOrigination = await this.prepareOperation({\n      operation: ops,\n      source: publicKeyHash,\n    });\n    const forgedOrigination = await this.forge(preparedOrigination);\n    const { hash, context, forgedBytes, opResponse } = await this.signAndInject(forgedOrigination);\n    return new OriginationOperation<TContract>(hash, operation, forgedBytes, opResponse, context, this);\n  }\n\n  /**\n   *\n   * @description Set the delegate for a contract. Will sign and inject an operation using the current context\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param SetDelegate operation parameter\n   */\n  async setDelegate(params: DelegateParams) {\n    if ( params.source && validateAddress(params.source) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid source Address: ${params.source}`);\n    }\n    if (params.delegate && validateAddress(params.delegate) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid delegate Address: ${params.delegate}`);\n    }\n\n    // Since babylon delegation source cannot smart contract\n    if (/kt1/i.test(params.source)) {\n      throw new InvalidDelegationSource(params.source);\n    }\n\n    const estimate = await this.estimate(params, this.estimator.setDelegate.bind(this.estimator));\n    const publicKeyHash = await this.signer.publicKeyHash();\n    const operation = await createSetDelegateOperation({ ...params, ...estimate });\n    const sourceOrDefault = params.source || publicKeyHash;\n    const ops = await this.addRevealOperationIfNeeded(operation, publicKeyHash);\n    const prepared = await this.prepareOperation({\n      operation: ops,\n      source: sourceOrDefault,\n    });\n    const opBytes = await this.forge(prepared);\n    const { hash, context, forgedBytes, opResponse } = await this.signAndInject(opBytes);\n    return new DelegateOperation(\n      hash,\n      operation,\n      sourceOrDefault,\n      forgedBytes,\n      opResponse,\n      context\n    );\n  }\n\n  /**\n   *\n   * @description Register the current address as delegate. Will sign and inject an operation using the current context\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param RegisterDelegate operation parameter\n   */\n  async registerDelegate(params: RegisterDelegateParams) {\n    const estimate = await this.estimate(\n      params,\n      this.estimator.registerDelegate.bind(this.estimator)\n    );\n    const source = await this.signer.publicKeyHash();\n    const operation = await createRegisterDelegateOperation({ ...params, ...estimate }, source);\n    const ops = await this.addRevealOperationIfNeeded(operation, source);\n    const prepared = await this.prepareOperation({ operation: ops });\n    const opBytes = await this.forge(prepared);\n    const { hash, context, forgedBytes, opResponse } = await this.signAndInject(opBytes);\n    return new DelegateOperation(hash, operation, source, forgedBytes, opResponse, context);\n  }\n\n  /**\n   *\n   * @description Transfer tz from current address to a specific address. Will sign and inject an operation using the current context\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param Transfer operation parameter\n   */\n  async transfer(params: TransferParams) {\n    if (validateAddress(params.to) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid address passed in 'to' parameter: ${params.to}`);\n    }\n    if (params.source && validateAddress(params.source) !== ValidationResult.VALID) {\n      throw new InvalidAddressError(`Invalid address passed in 'source' parameter: ${params.source}`);\n    }\n\n    const publickKeyHash = await this.signer.publicKeyHash();\n    const estimate = await this.estimate(params, this.estimator.transfer.bind(this.estimator));\n    const operation = await createTransferOperation({\n      ...params,\n      ...estimate,\n    });\n    const source = params.source || publickKeyHash;\n    const ops = await this.addRevealOperationIfNeeded(operation, publickKeyHash);\n    const prepared = await this.prepareOperation({ operation: ops, source: params.source });\n    const opBytes = await this.forge(prepared);\n    const { hash, context, forgedBytes, opResponse } = await this.signAndInject(opBytes);\n    return new TransactionOperation(hash, operation, source, forgedBytes, opResponse, context);\n  }\n\n  /**\n   *\n   * @description Reveal the current address. Will throw an error if the address is already revealed.\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param RevealParams operation parameter\n   */\n  async reveal(params: RevealParams) {\n    const publicKeyHash = await this.signer.publicKeyHash();\n    const estimateReveal = await this.estimator.reveal(params);\n    if (estimateReveal) {\n      const estimated = await this.estimate(params, async () => estimateReveal);\n      const operation = await createRevealOperation(\n        {\n          ...estimated,\n        },\n        publicKeyHash,\n        await this.signer.publicKey()\n      );\n      const prepared = await this.prepareOperation({ operation, source: publicKeyHash });\n      const opBytes = await this.forge(prepared);\n      const { hash, context, forgedBytes, opResponse } = await this.signAndInject(opBytes);\n      return new RevealOperation(hash, operation, publicKeyHash, forgedBytes, opResponse, context);\n    } else {\n      throw new Error('The current address is already revealed.');\n    }\n  }\n\n  /**\n   *\n   * @description Register a Micheline expression in a global table of constants. Will sign and inject an operation using the current context\n   *\n   * @returns An operation handle with the result from the rpc node\n   *\n   * @param params registerGlobalConstant operation parameter\n   */\n  async registerGlobalConstant(params: RegisterGlobalConstantParams) {\n    const publickKeyHash = await this.signer.publicKeyHash();\n    const estimate = await this.estimate(\n      params,\n      this.estimator.registerGlobalConstant.bind(this.estimator)\n    );\n    const operation = await createRegisterGlobalConstantOperation({\n      ...params,\n      ...estimate,\n    });\n    const ops = await this.addRevealOperationIfNeeded(operation, publickKeyHash);\n    const prepared = await this.prepareOperation({ operation: ops, source: publickKeyHash });\n    const opBytes = await this.forge(prepared);\n    const { hash, context, forgedBytes, opResponse } = await this.signAndInject(opBytes);\n    return new RegisterGlobalConstantOperation(\n      hash,\n      operation,\n      publickKeyHash,\n      forgedBytes,\n      opResponse,\n      context\n    );\n  }\n\n  async at<T extends DefaultContractType = DefaultContractType>(\n    address: string,\n    contractAbstractionComposer: ContractAbstractionComposer<T> = (x) => x as any\n  ): Promise<T> {\n    if (validateContractAddress(address) !== ValidationResult.VALID) {\n      throw new InvalidContractAddressError(`Invalid contract address: ${address}`);\n    }\n    const rpc = this.context.withExtensions().rpc;\n    const script = await rpc.getNormalizedScript(address);\n    const entrypoints = await rpc.getEntrypoints(address);\n    const blockHeader = await this.rpc.getBlockHeader();\n    const chainId = blockHeader.chain_id;\n    const abs = new ContractAbstraction(address, script, this, this, entrypoints, chainId, rpc);\n    return contractAbstractionComposer(abs, this.context);\n  }\n\n  /**\n   *\n   * @description Batch a group of operation together. Operations will be applied in the order in which they are added to the batch\n   *\n   * @returns A batch object from which we can add more operation or send a command to execute the batch\n   *\n   * @param params List of operation to batch together\n   */\n  batch(params?: ParamsWithKind[]) {\n    const batch = new OperationBatch(this.context, this.estimator);\n\n    if (Array.isArray(params)) {\n      batch.with(params);\n    }\n\n    return batch;\n  }\n}\n\ntype ContractAbstractionComposer<T> = (\n  abs: ContractAbstraction<ContractProvider>,\n  context: Context\n) => T;\n","import { Context } from '../context';\nimport { ParserProvider } from './interface';\nimport { Expr, GlobalConstantHashAndValue, Parser, Prim, ProtocolID } from '@taquito/michel-codec';\nimport { OriginateParams } from '../operations/types';\nimport { InvalidInitParameter, InvalidCodeParameter } from '../contract/errors';\nimport { Schema } from '@taquito/michelson-encoder';\nimport { MichelsonV1Expression } from '@taquito/rpc';\n\nexport class MichelCodecParser implements ParserProvider {\n  constructor(private context: Context) {}\n\n  private async getNextProto(): Promise<ProtocolID> {\n    const { next_protocol } = await this.context.rpc.getBlockMetadata();\n    return next_protocol as ProtocolID;\n  }\n\n  async parseScript(src: string): Promise<Expr[] | null> {\n    const parser = new Parser({ protocol: await this.getNextProto() });\n    return parser.parseScript(src);\n  }\n\n  async parseMichelineExpression(src: string): Promise<Expr | null> {\n    const parser = new Parser({ protocol: await this.getNextProto() });\n    return parser.parseMichelineExpression(src);\n  }\n\n  async parseJSON(src: object): Promise<Expr> {\n    const parser = new Parser({ protocol: await this.getNextProto() });\n    return parser.parseJSON(src);\n  }\n\n  async prepareCodeOrigination(params: OriginateParams): Promise<OriginateParams> {\n    const parsedParams = params;\n    parsedParams.code = await this.formatCodeParam(params.code);\n    if (params.init) {\n      parsedParams.init = await this.formatInitParam(params.init);\n    } else if (params.storage) {\n      const storageType = (parsedParams.code as Expr[]).find(\n        (p): p is Prim => 'prim' in p && p.prim === 'storage'\n      );\n      if (!storageType?.args) {\n        throw new InvalidCodeParameter(\n          'The storage section is missing from the script',\n          params.code\n        );\n      }\n      const schema = new Schema(storageType.args[0] as MichelsonV1Expression);\n      const globalconstantsHashAndValue = await this.findGlobalConstantsHashAndValue(schema);\n\n      if (Object.keys(globalconstantsHashAndValue).length !== 0) {\n        // If there are global constants in the storage part of the contract code,\n        // they need to be locally expanded in order to encode the storage arguments\n        const p = new Parser({ expandGlobalConstant: globalconstantsHashAndValue });\n        const storageTypeNoGlobalConst = p.parseJSON(storageType.args[0]);\n        const schemaNoGlobalConst = new Schema(storageTypeNoGlobalConst);\n        parsedParams.init = schemaNoGlobalConst.Encode(params.storage);\n      } else {\n        parsedParams.init = schema.Encode(params.storage);\n      }\n      delete parsedParams.storage;\n    }\n    return parsedParams;\n  }\n\n  private async formatCodeParam(code: string | object[]) {\n    let parsedCode: Expr[];\n    if (typeof code === 'string') {\n      const c = await this.parseScript(code);\n      if (c === null) {\n        throw new InvalidCodeParameter('Invalid code parameter', code);\n      }\n      parsedCode = c;\n    } else {\n      const c = await this.parseJSON(code);\n      const order = ['parameter', 'storage', 'code'];\n      // Ensure correct ordering for RPC\n      parsedCode = (c as Prim[]).sort((a, b) => order.indexOf(a.prim) - order.indexOf(b.prim));\n    }\n    return parsedCode;\n  }\n\n  private async formatInitParam(init: string | object) {\n    let parsedInit: Expr;\n    if (typeof init === 'string') {\n      const c = await this.parseMichelineExpression(init);\n      if (c === null) {\n        throw new InvalidInitParameter('Invalid init parameter', init);\n      }\n      parsedInit = c;\n    } else {\n      parsedInit = await this.parseJSON(init);\n    }\n    return parsedInit;\n  }\n\n  private async findGlobalConstantsHashAndValue(schema: Schema) {\n    const globalConstantTokens = schema.findToken('constant');\n    const globalConstantsHashAndValue: GlobalConstantHashAndValue = {};\n\n    if (globalConstantTokens.length !== 0) {\n      for (const token of globalConstantTokens) {\n        const tokenArgs = token.tokenVal.args;\n        if (tokenArgs) {\n          const hash: string = tokenArgs[0]['string'];\n          const michelineValue = await this.context.globalConstantsProvider.getGlobalConstantByHash(\n            hash\n          );\n          Object.assign(globalConstantsHashAndValue, {\n            [hash]: michelineValue,\n          });\n        }\n      }\n    }\n    return globalConstantsHashAndValue;\n  }\n}\n","import { Packer } from './interface';\nimport { Context } from '../context';\nimport { PackDataParams, PackDataResponse } from '@taquito/rpc';\n\nexport class RpcPacker implements Packer {\n  constructor(private context: Context) {}\n  \n  async packData(data: PackDataParams): Promise<PackDataResponse> {\n    return this.context.rpc.packData(data);\n  }\n}\n","export class GlobalConstantNotFound extends Error {\n  name = 'GlobalConstantNotFound';\n\n  constructor(public hash: string) {\n    super(\n      `Please load the value associated with the constant ${hash} using the loadGlobalConstant method of the DefaultGlobalConstantsProvider.`\n    );\n  }\n}\n\nexport class UnconfiguredGlobalConstantsProviderError extends Error {\n  name = 'UnconfiguredGlobalConstantsProviderError';\n\n  constructor() {\n    super(\n      'No global constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance.'\n    );\n  }\n}\n","import { Expr } from \"@taquito/michel-codec\";\nimport { UnconfiguredGlobalConstantsProviderError } from \"./error\";\nimport { GlobalConstantHash, GlobalConstantsProvider } from \"./interface-global-constants-provider\";\n\nexport class NoopGlobalConstantsProvider implements GlobalConstantsProvider {\n    async getGlobalConstantByHash(_hash: GlobalConstantHash): Promise<Expr> {\n        throw new UnconfiguredGlobalConstantsProviderError();\n    }\n}","import { RpcClient, RpcClientInterface } from '@taquito/rpc';\nimport { Protocols } from './constants';\nimport { Forger } from './forger/interface';\nimport { RpcForger } from './forger/rpc-forger';\nimport { Injector } from './injector/interface';\nimport { RpcInjector } from './injector/rpc-injector';\nimport { Signer } from './signer/interface';\nimport { NoopSigner } from './signer/noop';\nimport { OperationFactory } from './wallet/operation-factory';\nimport { RpcTzProvider } from './tz/rpc-tz-provider';\nimport { RPCEstimateProvider } from './contract/rpc-estimate-provider';\nimport { RpcContractProvider } from './contract/rpc-contract-provider';\nimport { RPCBatchProvider } from './batch/rpc-batch-provider';\n\nimport { Wallet, LegacyWalletProvider, WalletProvider } from './wallet';\nimport { ParserProvider } from './parser/interface';\nimport { MichelCodecParser } from './parser/michel-codec-parser';\nimport { Packer } from './packer/interface';\nimport { RpcPacker } from './packer/rpc-packer';\nimport BigNumber from 'bignumber.js';\nimport { retry } from 'rxjs/operators';\nimport { BehaviorSubject, OperatorFunction } from 'rxjs';\nimport { GlobalConstantsProvider } from './global-constants/interface-global-constants-provider';\nimport { NoopGlobalConstantsProvider } from './global-constants/noop-global-constants-provider';\n\nexport interface TaquitoProvider<T, K extends Array<any>> {\n  new (context: Context, ...rest: K): T;\n}\n\nexport interface ConfigConfirmation {\n  confirmationPollingIntervalSecond?: number;\n  confirmationPollingTimeoutSecond: number;\n  defaultConfirmationCount: number;\n}\n\nexport const defaultConfigConfirmation: ConfigConfirmation = {\n  defaultConfirmationCount: 1,\n  confirmationPollingTimeoutSecond: 180,\n};\n\n// The shouldObservableSubscriptionRetry parameter is related to the observable in ObservableSubsription class.\n// When set to true, the observable won't die when getBlock rpc call fails; the error will be reported via the error callback,\n// and it will continue to poll for new blocks.\nexport interface ConfigStreamer {\n  streamerPollingIntervalMilliseconds: number;\n  shouldObservableSubscriptionRetry: boolean;\n  observableSubscriptionRetryFunction: OperatorFunction<any, any>;\n}\n\nexport const defaultConfigStreamer: ConfigStreamer = {\n  streamerPollingIntervalMilliseconds: 20000,\n  shouldObservableSubscriptionRetry: false,\n  observableSubscriptionRetryFunction: retry(),\n};\n\n/**\n * @description Encapsulate common service used throughout different part of the library\n */\nexport class Context {\n  private _rpcClient: RpcClientInterface;\n  private _forger: Forger;\n  private _parser: ParserProvider;\n  private _injector: Injector;\n  private _walletProvider: WalletProvider;\n  public readonly operationFactory: OperationFactory;\n  private _packer: Packer;\n  private providerDecorator: Array<(context: Context) => Context> = [];\n  private _globalConstantsProvider: GlobalConstantsProvider;\n  public readonly tz = new RpcTzProvider(this);\n  public readonly estimate = new RPCEstimateProvider(this);\n  public readonly contract = new RpcContractProvider(this, this.estimate);\n  public readonly batch = new RPCBatchProvider(this, this.estimate);\n  public readonly wallet = new Wallet(this);\n\n  constructor(\n    private _rpc: RpcClientInterface | string,\n    private _signer: Signer = new NoopSigner(),\n    private _proto?: Protocols,\n    public readonly _config = new BehaviorSubject({\n      ...defaultConfigStreamer,\n      ...defaultConfigConfirmation,\n    }),\n    forger?: Forger,\n    injector?: Injector,\n    packer?: Packer,\n    wallet?: WalletProvider,\n    parser?: ParserProvider,\n    globalConstantsProvider?: GlobalConstantsProvider\n  ) {\n    if (typeof this._rpc === 'string') {\n      this._rpcClient = new RpcClient(this._rpc);\n    } else {\n      this._rpcClient = this._rpc;\n    }\n    this._forger = forger ? forger : new RpcForger(this);\n    this._injector = injector ? injector : new RpcInjector(this);\n    this.operationFactory = new OperationFactory(this);\n    this._walletProvider = wallet ? wallet : new LegacyWalletProvider(this);\n    this._parser = parser ? parser : new MichelCodecParser(this);\n    this._packer = packer ? packer : new RpcPacker(this);\n    this._globalConstantsProvider = globalConstantsProvider\n      ? globalConstantsProvider\n      : new NoopGlobalConstantsProvider();\n  }\n\n  get config(): ConfigConfirmation & ConfigStreamer {\n    return this._config.getValue();\n  }\n\n  set config(value: ConfigConfirmation & ConfigStreamer) {\n    this._config.next({\n      ...value,\n    });\n  }\n\n  setPartialConfig(value: Partial<ConfigConfirmation> & Partial<ConfigStreamer>) {\n    this._config.next({\n      ...this._config.getValue(),\n      ...value,\n    });\n  }\n\n  get rpc(): RpcClientInterface {\n    return this._rpcClient;\n  }\n\n  set rpc(value: RpcClientInterface) {\n    this._rpcClient = value;\n  }\n\n  get injector() {\n    return this._injector;\n  }\n\n  set injector(value: Injector) {\n    this._injector = value;\n  }\n\n  get forger() {\n    return this._forger;\n  }\n\n  set forger(value: Forger) {\n    this._forger = value;\n  }\n\n  get signer() {\n    return this._signer;\n  }\n\n  set signer(value: Signer) {\n    this._signer = value;\n  }\n\n  get walletProvider() {\n    return this._walletProvider;\n  }\n\n  set walletProvider(value: WalletProvider) {\n    this._walletProvider = value;\n  }\n\n  set proto(value: Protocols | undefined) {\n    this._proto = value;\n  }\n\n  get proto() {\n    return this._proto;\n  }\n\n  get parser() {\n    return this._parser;\n  }\n\n  set parser(value: ParserProvider) {\n    this._parser = value;\n  }\n\n  get packer() {\n    return this._packer;\n  }\n\n  set packer(value: Packer) {\n    this._packer = value;\n  }\n\n  get globalConstantsProvider() {\n    return this._globalConstantsProvider;\n  }\n\n  set globalConstantsProvider(value: GlobalConstantsProvider) {\n    this._globalConstantsProvider = value;\n  }\n\n  async isAnyProtocolActive(protocol: string[] = []) {\n    if (this._proto) {\n      return protocol.includes(this._proto);\n    } else {\n      const { next_protocol } = await this.rpc.getBlockMetadata();\n      return protocol.includes(next_protocol);\n    }\n  }\n\n  async getConfirmationPollingInterval() {\n    // Granada will generally halve the time between blocks, from 60 seconds to 30 seconds (mainnet).\n    // We reduce the default value in the same proportion, from 10 to 5.\n    const defaultInterval = 5;\n    try {\n      const constants = await this.rpc.getConstants();\n      let blockTime = constants.time_between_blocks[0];\n      if (constants.minimal_block_delay !== undefined) {\n        blockTime = constants.minimal_block_delay;\n      }\n      let confirmationPollingInterval = BigNumber.sum(\n        blockTime,\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        new BigNumber(constants.delay_per_missing_endorsement!).multipliedBy(\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          Math.max(0, constants.initial_endorsers! - constants.endorsers_per_block)\n        )\n      );\n\n      // Divide the polling interval by a constant 3\n      // to improvise for polling time to work in prod,\n      // testnet and sandbox enviornment.\n      confirmationPollingInterval = confirmationPollingInterval.dividedBy(3);\n\n      this.config.confirmationPollingIntervalSecond =\n        confirmationPollingInterval.toNumber() === 0 ? 0.1 : confirmationPollingInterval.toNumber();\n      return this.config.confirmationPollingIntervalSecond;\n    } catch (exception) {\n      // Return default value if there is\n      // an issue returning from constants\n      // file.\n      return defaultInterval;\n    }\n  }\n\n  /**\n   * @description Create a copy of the current context. Useful when you have long running operation and you do not want a context change to affect the operation\n   */\n  clone(): Context {\n    return new Context(\n      this.rpc,\n      this.signer,\n      this.proto,\n      this._config,\n      this.forger,\n      this._injector,\n      this.packer\n    );\n  }\n\n  /**\n   * @description Allows extensions set on the TezosToolkit to inject logic into the context\n   */\n  registerProviderDecorator(fx: (context: Context) => Context) {\n    this.providerDecorator.push(fx);\n  }\n\n  /**\n   * @description Applies the decorators on a cloned instance of the context and returned this cloned instance.\n   * The decorators are functions that inject logic into the context.\n   * They are provided by the extensions set on the TezosToolkit by calling the registerProviderDecorator method.\n   */\n  withExtensions = (): Context => {\n    let clonedContext = this.clone();\n    this.providerDecorator.forEach((decorator) => {\n      clonedContext = decorator(clonedContext);\n    });\n\n    return clonedContext;\n  };\n}\n","import { OpFilter, FilterExpression, Filter, OpHashFilter, SourceFilter, KindFilter, DestinationFilter, OperationContent } from './interface';\n\nconst opHashFilter = (op: OperationContent, filter: OpHashFilter) => op.hash === filter.opHash;\n\nconst sourceFilter = (x: OperationContent, filter: SourceFilter) => {\n  switch (x.kind) {\n    case 'endorsement':\n      return 'metadata' in x && x.metadata.delegate === filter.source\n    case 'activate_account':\n      return 'metadata' in x && x.pkh === filter.source\n    default:\n      return 'source' in x && x.source === filter.source\n  }\n}\n\nconst kindFilter = (x: OperationContent, filter: KindFilter) => 'kind' in x && x.kind === filter.kind;\n\nconst destinationFilter = (x: OperationContent, filter: DestinationFilter) => {\n  switch (x.kind) {\n    case 'delegation':\n      return x.delegate === filter.destination;\n    case 'origination':\n      if (\n        'metadata' in x &&\n        'operation_result' in x.metadata &&\n        'originated_contracts' in x.metadata.operation_result &&\n        Array.isArray(x.metadata.operation_result.originated_contracts)\n      ) {\n        return x.metadata.operation_result.originated_contracts.some(\n          contract => contract === filter.destination\n        );\n      }\n      break;\n    case 'transaction':\n      return x.destination === filter.destination;\n    default:\n      return false;\n  }\n};\n\nexport const evaluateOpFilter = (op: OperationContent, filter: OpFilter) => {\n  if ('opHash' in filter) {\n    return opHashFilter(op, filter);\n  } else if ('source' in filter) {\n    return sourceFilter(op, filter)\n  } else if ('kind' in filter) {\n    return kindFilter(op, filter);\n  } else if ('destination' in filter) {\n    return destinationFilter(op, filter)\n  }\n\n  return false;\n};\n\nexport const evaluateExpression = (op: OperationContent, exp: FilterExpression): boolean => {\n  if (Array.isArray(exp.and)) {\n    return exp.and.every((x: OpFilter | FilterExpression) => evaluateFilter(op, x));\n  } else if (Array.isArray(exp.or)) {\n    return exp.or.some((x: OpFilter | FilterExpression) => evaluateFilter(op, x));\n  } else {\n    throw new Error('Filter expression must contains either and/or property');\n  }\n};\n\nexport const evaluateFilter = (op: OperationContent, filter: Filter): boolean => {\n  const filters: OpFilter[] | FilterExpression[] = [];\n  if (!Array.isArray(filter)) {\n    filters.push(filter as any);\n  } else {\n    filters.push(...(filter as any));\n  }\n\n  return (filters as any[]).every((filterOrExp: OpFilter | FilterExpression) => {\n    if ('and' in filterOrExp || 'or' in filterOrExp) {\n      return evaluateExpression(op, filterOrExp);\n    } else {\n      return evaluateOpFilter(op, filterOrExp as OpFilter);\n    }\n  });\n};\n","/* eslint-disable no-dupe-class-members */\nimport { Observable, Subject, NEVER, OperatorFunction } from 'rxjs';\nimport { Subscription } from './interface';\nimport { takeUntil, tap, catchError, retry } from 'rxjs/operators';\n\nexport class ObservableSubscription<T> implements Subscription<T> {\n  private errorListeners: Array<(error: Error) => void> = [];\n  private messageListeners: Array<(data: T) => void> = [];\n  private closeListeners: Array<() => void> = [];\n  private completed$ = new Subject();\n\n  constructor(\n    obs: Observable<T>,\n    private shouldRetry: boolean = false,\n    private operatorFunction: OperatorFunction<T, T> = retry<T>()\n  ) {\n    obs\n      .pipe(\n        takeUntil(this.completed$),\n        tap(\n          (data: T) => {\n            this.call(this.messageListeners, data);\n          },\n          (error) => {\n            this.call(this.errorListeners, error);\n          },\n          () => {\n            this.call(this.closeListeners);\n          }\n        ),\n        this.shouldRetry ? operatorFunction : tap(),\n        catchError(() => NEVER)\n      )\n      .subscribe();\n  }\n\n  private call<K>(listeners: Array<(val: K) => void>, value?: K) {\n    for (const l of listeners) {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        l(value!);\n      } catch (ex) {\n        console.error(ex);\n      }\n    }\n  }\n\n  private remove(listeners: Array<any>, value: any) {\n    const idx = listeners.indexOf(value);\n    if (idx !== -1) {\n      listeners.splice(idx, 1);\n    }\n  }\n\n  public on(type: 'error', cb: (error: Error) => void): void;\n  public on(type: 'data', cb: (data: T) => void): void;\n  public on(type: 'close', cb: () => void): void;\n\n  public on(type: 'data' | 'error' | 'close', cb: any): void {\n    switch (type) {\n      case 'data':\n        this.messageListeners.push(cb);\n        break;\n      case 'error':\n        this.errorListeners.push(cb);\n        break;\n      case 'close':\n        this.closeListeners.push(cb);\n        break;\n      default:\n        throw new Error(`Trying to register on an unsupported event: ${type}`);\n    }\n  }\n\n  public off(type: 'error', cb: (error: Error) => void): void;\n  public off(type: 'data', cb: (data: T) => void): void;\n  public off(type: 'close', cb: () => void): void;\n\n  public off(type: 'data' | 'error' | 'close', cb: any): void {\n    switch (type) {\n      case 'data':\n        this.remove(this.messageListeners, cb);\n        break;\n      case 'error':\n        this.remove(this.errorListeners, cb);\n        break;\n      case 'close':\n        this.remove(this.closeListeners, cb);\n        break;\n      default:\n        throw new Error(`Trying to unregister on an unsupported event: ${type}`);\n    }\n  }\n\n  public close() {\n    this.completed$.next();\n  }\n}\n","import { BlockResponse } from '@taquito/rpc';\nimport { from, Observable, ObservableInput, timer } from 'rxjs';\nimport {\n  concatMap,\n  distinctUntilKeyChanged,\n  first,\n  map,\n  pluck,\n  publish,\n  refCount,\n  switchMap,\n} from 'rxjs/operators';\nimport { Context } from '../context';\nimport { evaluateFilter } from './filters';\nimport { Filter, SubscribeProvider, Subscription, OperationContent } from './interface';\nimport { ObservableSubscription } from './observable-subscription';\n\nconst getLastBlock = (context: Context) => {\n  return from(context.rpc.getBlock()).pipe(first());\n};\n\nconst applyFilter = (filter: Filter) =>\n  concatMap<BlockResponse, ObservableInput<OperationContent>>(block => {\n    return new Observable<OperationContent>(sub => {\n      for (const ops of block.operations) {\n        for (const op of ops) {\n          for (const content of op.contents) {\n            if (evaluateFilter({hash: op.hash, ...content}, filter)) {\n              sub.next({hash: op.hash, ...content});\n            }\n          }\n        }\n      }\n      sub.complete();\n    });\n  });\n\nexport class PollingSubscribeProvider implements SubscribeProvider {\n  // Map the changing polling interval to a timer, which will automatically terminate the previous timer when the next one starts.\n  private timer$ = this.context._config.pipe(\n    switchMap((val) => timer(0, val.streamerPollingIntervalMilliseconds)),\n  )\n\n  private newBlock$ = this.timer$.pipe(\n    map(() => this.context),\n    switchMap(getLastBlock),\n    distinctUntilKeyChanged('hash'),\n    publish(),\n    refCount()\n  );\n\n  constructor(private context: Context) { }\n\n  subscribe(_filter: 'head'): Subscription<string> {\n    return new ObservableSubscription(this.newBlock$.pipe(pluck('hash')), \n                                      this.context.config.shouldObservableSubscriptionRetry,\n                                      this.context.config.observableSubscriptionRetryFunction);\n  }\n\n  subscribeOperation(filter: Filter): Subscription<OperationContent> {\n    return new ObservableSubscription(this.newBlock$.pipe(applyFilter(filter)),\n                                      this.context.config.shouldObservableSubscriptionRetry,\n                                      this.context.config.observableSubscriptionRetryFunction);\n  }\n}\n","\n// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\nexport const VERSION = {\n    \"commitHash\": \"81f0a5b103f867f57fbe5d526315c375a3788346\",\n    \"version\": \"11.2.0\"\n};\n","import { Forger, ForgeParams, ForgeResponse } from './interface';\n\nexport class ForgingMismatchError extends Error {\n  name = 'ForgingMismatchError';\n  constructor(public results: string[]) {\n    super('Forging mismatch error');\n  }\n}\n\nexport class CompositeForger implements Forger {\n  constructor(private forgers: Forger[]) {\n    if (forgers.length === 0) {\n      throw new Error('At least one forger must be specified');\n    }\n  }\n\n  async forge({ branch, contents }: ForgeParams): Promise<ForgeResponse> {\n    const results = await Promise.all(\n      this.forgers.map((forger) => {\n        return forger.forge({ branch, contents });\n      })\n    );\n\n    if (results.length === 0) {\n      throw new Error('At least one forger must be specified');\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    let lastResult: string = results.pop()!; // Assumed to be more than one since we\n    while (results.length) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const currentResult = results.pop()!;\n\n      if (currentResult !== lastResult) {\n        throw new ForgingMismatchError([lastResult, currentResult]);\n      }\n      lastResult = currentResult;\n    }\n\n    return lastResult;\n  }\n}\n","import { OriginateParams } from \"../operations/types\";\nimport { ParserProvider } from \"./interface\";\n\nexport class NoopParser implements ParserProvider {\n    async prepareCodeOrigination(params: OriginateParams): Promise<OriginateParams> {\n        return params;\n    }\n}","import { Packer } from './interface';\nimport { packDataBytes, MichelsonData, MichelsonType } from '@taquito/michel-codec'\nimport { PackDataResponse, PackDataParams } from '@taquito/rpc';\n\nexport class MichelCodecPacker implements Packer {\n\n  async packData(data: PackDataParams): Promise<PackDataResponse> {\n    const { bytes } = packDataBytes(data.data as MichelsonData, data.type as MichelsonType);\n    return { packed: bytes }\n  }\n}\n","import { GlobalConstantHashAndValue } from '@taquito/michel-codec';\nimport { GlobalConstantNotFound } from './error';\nimport { GlobalConstantHash, GlobalConstantsProvider } from './interface-global-constants-provider';\n\nexport class DefaultGlobalConstantsProvider implements GlobalConstantsProvider {\n  private _globalConstantsLibrary: GlobalConstantHashAndValue = {};\n\n  /**\n   *\n   * @description Allows to load global constant hashes and their corresponding Michelson JSON values\n   */\n  loadGlobalConstant(globalConstant: GlobalConstantHashAndValue) {\n    for (const hash in globalConstant) {\n      Object.assign(this._globalConstantsLibrary, {\n        [hash]: globalConstant[hash],\n      });\n    }\n  }\n\n  /**\n   *\n   * @description Retrieve the Michelson value of a global constant based on its hash\n   *\n   * @param hash a string representing the global constant hash\n   * @returns Expr, the JSON Michelson value\n   */\n  async getGlobalConstantByHash(hash: GlobalConstantHash) {\n    const value = this._globalConstantsLibrary[hash];\n    if (!value) {\n      throw new GlobalConstantNotFound(hash);\n    }\n    return value;\n  }\n}\n","/**\n * @packageDocumentation\n * @module @taquito/taquito\n */\n\nimport { RpcClient, RpcClientInterface } from '@taquito/rpc';\nimport { RPCBatchProvider } from './batch/rpc-batch-provider';\nimport { Protocols } from './constants';\nimport { ConfigConfirmation, ConfigStreamer, Context, TaquitoProvider } from './context';\nimport { ContractProvider, EstimationProvider } from './contract/interface';\nimport { Extension } from './extension/extension';\nimport { Forger } from './forger/interface';\nimport { RpcForger } from './forger/rpc-forger';\nimport { format } from './format';\nimport { GlobalConstantsProvider } from './global-constants/interface-global-constants-provider';\nimport { NoopGlobalConstantsProvider } from './global-constants/noop-global-constants-provider';\nimport { Packer } from './packer/interface';\nimport { RpcPacker } from './packer/rpc-packer';\nimport { Signer } from './signer/interface';\nimport { NoopSigner } from './signer/noop';\nimport { SubscribeProvider } from './subscribe/interface';\nimport { PollingSubscribeProvider } from './subscribe/polling-provider';\nimport { TzProvider } from './tz/interface';\nimport { VERSION } from './version';\nimport { LegacyWalletProvider, Wallet, WalletProvider } from './wallet';\nimport { OperationFactory } from './wallet/operation-factory';\n\nexport { MichelsonMap, UnitValue } from '@taquito/michelson-encoder';\nexport * from './constants';\nexport * from './context';\nexport { TaquitoProvider } from './context';\nexport * from './contract';\nexport * from './contract/big-map';\nexport { CompositeForger } from './forger/composite-forger';\nexport * from './forger/interface';\nexport { RpcForger } from './forger/rpc-forger';\nexport * from './operations';\nexport { OperationBatch } from './batch/rpc-batch-provider';\nexport * from './signer/interface';\nexport * from './subscribe/interface';\nexport { SubscribeProvider } from './subscribe/interface';\nexport { PollingSubscribeProvider } from './subscribe/polling-provider';\nexport { ObservableSubscription } from './subscribe/observable-subscription';\nexport * from './tz/interface';\nexport * from './wallet';\nexport { Extension } from './extension/extension';\nexport * from './parser/interface';\nexport * from './parser/michel-codec-parser';\nexport * from './parser/noop-parser';\nexport * from './packer/interface';\nexport * from './packer/michel-codec-packer';\nexport * from './packer/rpc-packer';\nexport * from './global-constants/default-global-constants-provider';\nexport * from './global-constants/error';\nexport * from './global-constants/interface-global-constants-provider';\n\nexport interface SetProviderOptions {\n  forger?: Forger;\n  wallet?: WalletProvider;\n  rpc?: string | RpcClientInterface;\n  stream?: string | SubscribeProvider;\n  signer?: Signer;\n  protocol?: Protocols;\n  config?: Partial<ConfigConfirmation> & Partial<ConfigStreamer>;\n  packer?: Packer;\n  globalConstantsProvider?: GlobalConstantsProvider;\n}\n\nexport interface VersionInfo {\n  commitHash: string;\n  version: string;\n}\n\n/**\n * @description Facade class that surfaces all of the libraries capability and allow it's configuration\n *\n * @param _rpc The RPC server to use\n */\nexport class TezosToolkit {\n  private _stream!: SubscribeProvider;\n  private _options: SetProviderOptions = {};\n  private _rpcClient: RpcClientInterface;\n  private _wallet: Wallet;\n  private _context: Context;\n  /**\n   * @deprecated TezosToolkit.batch has been deprecated in favor of TezosToolkit.contract.batch\n   *\n   */\n  public batch: RPCBatchProvider['batch'];\n\n  public readonly format = format;\n\n  constructor(private _rpc: RpcClientInterface | string) {\n    if (typeof this._rpc === 'string') {\n      this._rpcClient = new RpcClient(this._rpc);\n    } else {\n      this._rpcClient = this._rpc;\n    }\n    this._context = new Context(_rpc);\n    this._wallet = new Wallet(this._context);\n    this.setProvider({ rpc: this._rpcClient });\n    this.batch = this._context.batch.batch.bind(this._context.batch);\n  }\n\n  /**\n   * @description Sets configuration on the Tezos Taquito instance. Allows user to choose which signer, rpc client, rpc url, forger and so forth\n   *\n   * @param options rpc url or rpcClient to use to interact with the Tezos network\n   *\n   * @example Tezos.setProvider({rpc: 'https://mainnet.api.tez.ie/', signer: new InMemorySigner.fromSecretKey(“edsk...”)})\n   * @example Tezos.setProvider({ config: { confirmationPollingTimeoutSecond: 300 }})\n   *\n   */\n\n  setProvider({\n    rpc,\n    stream,\n    signer,\n    protocol,\n    config,\n    forger,\n    wallet,\n    packer,\n    globalConstantsProvider,\n  }: SetProviderOptions) {\n    this.setRpcProvider(rpc);\n    this.setStreamProvider(stream);\n    this.setSignerProvider(signer);\n    this.setForgerProvider(forger);\n    this.setWalletProvider(wallet);\n    this.setPackerProvider(packer);\n    this.setGlobalConstantsProvider(globalConstantsProvider);\n\n    this._context.proto = protocol;\n    if (config) {\n      this._context.setPartialConfig(config);\n    }\n  }\n\n  /**\n   * @description Sets signer provider on the Tezos Taquito instance.\n   *\n   * @param options signer to use to interact with the Tezos network\n   *\n   * @example Tezos.setSignerProvider(new InMemorySigner.fromSecretKey('edsk...'))\n   *\n   */\n  setSignerProvider(signer?: SetProviderOptions['signer']) {\n    if (!this._options.signer && typeof signer === 'undefined') {\n      this._context.signer = new NoopSigner();\n      this._options.signer = signer;\n    } else if (typeof signer !== 'undefined') {\n      this._context.signer = signer;\n      this._options.signer = signer;\n    }\n  }\n\n  /**\n   * @description Sets rpc provider on the Tezos Taquito instance\n   *\n   * @param options rpc url or rpcClient to use to interact with the Tezos network\n   *\n   * @example Tezos.setRpcProvider('https://mainnet.api.tez.ie/')\n   *\n   */\n  setRpcProvider(rpc?: SetProviderOptions['rpc']) {\n    if (typeof rpc === 'string') {\n      this._rpcClient = new RpcClient(rpc);\n    } else if (rpc === undefined) {\n      // do nothing, RPC is required in the constructor, do not override it\n    } else {\n      this._rpcClient = rpc;\n    }\n    this._options.rpc = this._rpcClient;\n    this._context.rpc = this._rpcClient;\n  }\n\n  /**\n   * @description Sets forger provider on the Tezos Taquito instance\n   *\n   * @param options forger to use to interact with the Tezos network\n   *\n   * @example Tezos.setForgerProvider(localForger)\n   *\n   */\n  setForgerProvider(forger?: SetProviderOptions['forger']) {\n    const f = typeof forger === 'undefined' ? this.getFactory(RpcForger)() : forger;\n    this._options.forger = f;\n    this._context.forger = f;\n  }\n\n  /**\n   * @description Sets stream provider on the Tezos Taquito instance\n   *\n   * @param options stream to use to interact with the Tezos network\n   *\n   * @example Tezos.setStreamProvider(...)\n   *\n   */\n  setStreamProvider(stream?: SetProviderOptions['stream']) {\n    if (typeof stream === 'string') {\n      this._stream = new PollingSubscribeProvider(new Context(new RpcClient(stream)));\n    } else if (typeof stream !== 'undefined') {\n      this._stream = stream;\n    } else if (this._options.stream === undefined) {\n      this._stream = this.getFactory(PollingSubscribeProvider)();\n    }\n    this._options.stream = stream;\n  }\n\n  /**\n   * @description Sets wallet provider on the Tezos Taquito instance\n   *\n   * @param options wallet to use to interact with the Tezos network\n   *\n   * @example Tezos.setWalletProvider(...)\n   *\n   */\n  setWalletProvider(wallet?: SetProviderOptions['wallet']) {\n    if (!this._options.wallet && typeof wallet === 'undefined') {\n      const w = this.getFactory(LegacyWalletProvider)();\n      this._options.wallet = w;\n      this._context.walletProvider = w;\n    } else if (typeof wallet !== 'undefined') {\n      this._options.wallet = wallet;\n      this._context.walletProvider = wallet;\n    }\n  }\n\n  /**\n   * @description Sets Packer provider on the Tezos Taquito instance\n   *\n   * @param options packer to use to interact with the Tezos network\n   *\n   * @example Tezos.setPackerProvider(new MichelCodecPacker())\n   *\n   */\n  setPackerProvider(packer?: SetProviderOptions['packer']) {\n    const p = typeof packer === 'undefined' ? this.getFactory(RpcPacker)() : packer;\n    this._options.packer = p;\n    this._context.packer = p;\n  }\n\n  /**\n   * @description Sets global constants provider on the Tezos Taquito instance\n   *\n   * @param options globalConstantsProvider to use to interact with the Tezos network\n   *\n   * @example\n   * ```\n   * const globalConst = new DefaultGlobalConstantsProvider();\n   * globalConst.loadGlobalConstant({\n   *  \"expruu5BTdW7ajqJ9XPTF3kgcV78pRiaBW3Gq31mgp3WSYjjUBYxre\": { prim: \"int\" },\n   *  // ...\n   * })\n   * Tezos.setGlobalConstantsProvider(globalConst);\n   * ```\n   *\n   */\n  setGlobalConstantsProvider(\n    globalConstantsProvider?: SetProviderOptions['globalConstantsProvider']\n  ) {\n    const g =\n      typeof globalConstantsProvider === 'undefined'\n        ? new NoopGlobalConstantsProvider()\n        : globalConstantsProvider;\n    this._options.globalConstantsProvider = g;\n    this._context.globalConstantsProvider = g;\n  }\n\n  /**\n   * @description Provide access to tezos account management\n   */\n  get tz(): TzProvider {\n    return this._context.tz;\n  }\n\n  /**\n   * @description Provide access to smart contract utilities\n   */\n  get contract(): ContractProvider {\n    return this._context.contract;\n  }\n\n  get wallet(): Wallet {\n    return this._wallet;\n  }\n\n  get operation(): OperationFactory {\n    return this._context.operationFactory;\n  }\n\n  /**\n   * @description Provide access to operation estimation utilities\n   */\n  get estimate(): EstimationProvider {\n    return this._context.estimate;\n  }\n\n  /**\n   * @description Provide access to streaming utilities backed by an streamer implementation\n   */\n  get stream(): SubscribeProvider {\n    return this._stream;\n  }\n\n  /**\n   * @description Provide access to the currently used rpc client\n   */\n  get rpc(): RpcClientInterface {\n    return this._context.rpc;\n  }\n\n  /**\n   * @description Provide access to the currently used signer\n   */\n  get signer() {\n    return this._context.signer;\n  }\n\n  /**\n   * @description Provide access to the currently used globalConstantsProvider\n   */\n  get globalConstants() {\n    return this._context.globalConstantsProvider;\n  }\n\n  /**\n   * @description Allow to add a module to the TezosToolkit instance. This method adds the appropriate Providers(s) required by the module to the internal context.\n   *\n   * @param module extension to add to the TezosToolkit instance\n   *\n   * @example Tezos.addExtension(new Tzip16Module());\n   */\n  addExtension(module: Extension | Extension[]) {\n    if (Array.isArray(module)) {\n      module.forEach((extension) => extension.configureContext(this._context));\n    } else {\n      module.configureContext(this._context);\n    }\n  }\n\n  getFactory<T, K extends Array<any>>(ctor: TaquitoProvider<T, K>) {\n    return (...args: K) => {\n      return new ctor(this._context, ...args);\n    };\n  }\n\n  /**\n   * @description Gets an object containing the version of Taquito library and git sha of the commit this library is compiled from\n   */\n  getVersionInfo(): VersionInfo {\n    return VERSION;\n  }\n}\n"],"names":["DEFAULT_GAS_LIMIT","DEFAULT_FEE","DEFAULT_STORAGE_LIMIT","Protocols","DefaultLambdaAddresses","ChainIds","BigNumber","Schema","OpKind","ReplaySubject","defer","timer","first","from","tap","map","switchMap","mapTo","switchMapTo","filter","shareReplay","validateOperation","ValidationResult","InvalidOperationHashError","catchError","of","EMPTY","validateAddress","InvalidAddressError","validateKeyHash","InvalidKeyHashError","combineLatest","distinctUntilChanged","takeWhile","distinctUntilKeyChanged","timeoutWith","throwError","range","startWith","concatMap","concat","validateContractAddress","InvalidContractAddressError","ParameterSchema","ViewSchema","HttpResponseError","STATUS_CODE","encodeExpr","MichelsonMap","Parser","retry","BehaviorSubject","RpcClient","Subject","takeUntil","NEVER","Observable","publish","refCount","pluck","packDataBytes","rpc"],"mappings":"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"}